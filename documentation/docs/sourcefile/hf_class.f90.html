<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	 
	 <meta name="description" content="The eT coupled cluster program">
    
    <meta name="author" content="Eirik F. KjÃ¸nstad and Sarai D. Folkestad" >
    <link rel="icon" href="../favicon.png">

    <title>hf_class.F90 &ndash; The eT program</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">The eT program </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
				
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
		 aria-expanded="false">Contents <span class="caret"></span></a>
	      <ul class="dropdown-menu">
              
            <li><a href="../lists/files.html">Source Files</a></li>
				
				
            <li><a href="../lists/modules.html">Modules</a></li>
				
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
				
								
            <li><a href="../lists/types.html">Derived Types</a></li>
				
				
            <li><a href="../program/et_program.html">Program</a></li>
	    
            </ul>
            </li>

<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../program/et_program.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>hf_class.F90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
	  data-placement="bottom" data-html="true"
	  title=" 2.4% of total for source files.">539 statements</a>
     </li> 
     
     
    <li><i class="fa fa-code"></i><a href="../src/hf_class.F90"> Source File</a></li>
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
     <li class="active">hf_class.F90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  






<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/hf_class.html">hf_class</a>
      
    </div>
  </div>
</div>















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/hf_class.f90.html#src">hf_class.F90</a>
  </div>
</div>


  <hr>
  

<div class="panel panel-default">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#allfiles-0">All Source Files</a></h3></div>
  <div id="allfiles-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../sourcefile/batching_index_class.f90.html">batching_index_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/calc_procedures_class.f90.html">calc_procedures_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/calc_settings_class.f90.html">calc_settings_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/calc_tasks_class.f90.html">calc_tasks_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/cc2_class.f90.html">cc2_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/cc3_class.f90.html">cc3_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/ccs_class.f90.html">ccs_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/ccsd_class.f90.html">ccsd_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/ccsdpt_class.f90.html">ccsdpt_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/cholesky_submodule.f90.html">cholesky_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/cholesky_submodule.f90%7E2.html">cholesky_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/core_excited_state_specs_class.f90.html">core_excited_state_specs_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/cvs_submodule.f90.html">cvs_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/cvs_submodule.f90%7E2.html">cvs_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/et_program.f90.html">eT_program.F90</a>
      
      <a class="list-group-item" href="../sourcefile/excited_state_specs_class.f90.html">excited_state_specs_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/excited_state_submodule.f90.html">excited_state_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/excited_state_submodule.f90%7E2.html">excited_state_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/excited_state_submodule.f90%7E3.html">excited_state_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/excited_state_submodule.f90%7E4.html">excited_state_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/excited_state_submodule.f90%7E5.html">excited_state_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/fock_submodule.f90.html">fock_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/ground_state_specs_class.f90.html">ground_state_specs_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/ground_state_submodule.f90.html">ground_state_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/ground_state_submodule.f90%7E2.html">ground_state_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/ground_state_submodule.f90%7E3.html">ground_state_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/ground_state_submodule.f90%7E4.html">ground_state_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/hf_class.f90.html">hf_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/input_output.f90.html">input_output.F90</a>
      
      <a class="list-group-item" href="../sourcefile/input_reader.f90.html">input_reader.F90</a>
      
      <a class="list-group-item" href="../sourcefile/input_reader_submodule.f90.html">input_reader_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/input_reader_submodule.f90%7E2.html">input_reader_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/input_reader_submodule.f90%7E3.html">input_reader_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/integrals_submodule.f90.html">integrals_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/ionized_state_submodule.f90.html">ionized_state_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/ionized_state_submodule.f90%7E2.html">ionized_state_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/jacobian_submodule.f90.html">jacobian_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/jacobian_submodule.f90%7E2.html">jacobian_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/jacobian_submodule.f90%7E3.html">jacobian_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/jacobian_submodule.f90%7E4.html">jacobian_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/jacobian_submodule.f90%7E5.html">jacobian_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/jacobian_transpose_submodule.f90.html">jacobian_transpose_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/jacobian_transpose_submodule.f90%7E2.html">jacobian_transpose_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/memory_manager_class.f90.html">memory_manager_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/mlcc2_class.f90.html">mlcc2_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/mlcc_calculation_settings_class.f90.html">mlcc_calculation_settings_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/mlcc_orbitals_class.f90.html">mlcc_orbitals_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/mlccsd_class.f90.html">mlccsd_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/mp2_class.f90.html">mp2_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/omega_submodule.f90.html">omega_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/omega_submodule.f90%7E2.html">omega_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/omega_submodule.f90%7E3.html">omega_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/omega_submodule.f90%7E4.html">omega_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/omega_submodule.f90%7E5.html">omega_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/omega_submodule.f90%7E6.html">omega_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/orbital_partitioning_submodule.f90.html">orbital_partitioning_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/orbital_partitioning_submodule.f90%7E2.html">orbital_partitioning_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/response_calc_specs_class.f90.html">response_calc_specs_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/response_submodule.f90.html">response_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/types.f90.html">types.F90</a>
      
      <a class="list-group-item" href="../sourcefile/utils.f90.html">utils.F90</a>
      
      <a class="list-group-item" href="../sourcefile/workspace.f90.html">workspace.F90</a>
      
    </div>
  </div>
</div>


</div>  

    </div>
    <div class="col-md-9" id='text'>
    
    
    <h3>This File Depends On</h3>
    
                <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.36.0 (20140111.2315)
 -->
<!-- Title: sourcefile~~hf_class.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefilehf_classf90EfferentGraph" width="641pt" height="326pt"
 viewBox="0.00 0.00 641.00 326.04" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~hf_class.f90~~EfferentGraph" class="graph" transform="scale(0.809343 0.809343) rotate(0) translate(4 398.844)">
<title>sourcefile~~hf_class.f90~~EfferentGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-398.844 788,-398.844 788,4 -4,4"/>
<!-- sourcefile~hf_class.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_node1" class="node"><title>sourcefile~hf_class.f90</title>
<polygon fill="none" stroke="black" points="784,-208 712,-208 712,-184 784,-184 784,-208"/>
<text text-anchor="middle" x="748" y="-193.6" font-family="Helvetica,sans-Serif" font-size="10.50">hf_class.F90</text>
</g>
<!-- sourcefile~calc_tasks_class.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_node2" class="node"><title>sourcefile~calc_tasks_class.f90</title>
<g id="a_sourcefile~~hf_class.f90~~EfferentGraph_node2"><a xlink:href="../sourcefile/calc_tasks_class.f90.html" xlink:title="calc_tasks_class.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="453,-388 341,-388 341,-364 453,-364 453,-388"/>
<text text-anchor="middle" x="397" y="-373.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">calc_tasks_class.F90</text>
</a>
</g>
</g>
<!-- sourcefile~calc_tasks_class.f90&#45;&gt;sourcefile~hf_class.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_edge18" class="edge"><title>sourcefile~calc_tasks_class.f90&#45;&gt;sourcefile~hf_class.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M453.092,-387.797C513.474,-397.455 610.461,-402.987 676,-357 722.458,-324.402 738.878,-254.326 744.391,-218.336"/>
<polygon fill="#000000" stroke="#000000" points="747.87,-218.726 745.773,-208.341 740.936,-217.767 747.87,-218.726"/>
</g>
<!-- sourcefile~response_calc_specs_class.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_node3" class="node"><title>sourcefile~response_calc_specs_class.f90</title>
<g id="a_sourcefile~~hf_class.f90~~EfferentGraph_node3"><a xlink:href="../sourcefile/response_calc_specs_class.f90.html" xlink:title="response_calc_specs_class.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="676,-348 512,-348 512,-324 676,-324 676,-348"/>
<text text-anchor="middle" x="594" y="-333.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">response_calc_specs_class.F90</text>
</a>
</g>
</g>
<!-- sourcefile~response_calc_specs_class.f90&#45;&gt;sourcefile~hf_class.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_edge19" class="edge"><title>sourcefile~response_calc_specs_class.f90&#45;&gt;sourcefile~hf_class.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M650.764,-323.87C659.756,-320.343 668.545,-315.812 676,-310 707.192,-285.682 728.221,-243.539 738.859,-217.869"/>
<polygon fill="#000000" stroke="#000000" points="742.227,-218.873 742.665,-208.287 735.721,-216.289 742.227,-218.873"/>
</g>
<!-- sourcefile~types.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_node4" class="node"><title>sourcefile~types.f90</title>
<g id="a_sourcefile~~hf_class.f90~~EfferentGraph_node4"><a xlink:href="../sourcefile/types.f90.html" xlink:title="types.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="59.5,-108 0.5,-108 0.5,-84 59.5,-84 59.5,-108"/>
<text text-anchor="middle" x="30" y="-93.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">types.F90</text>
</a>
</g>
</g>
<!-- sourcefile~types.f90&#45;&gt;sourcefile~hf_class.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_edge20" class="edge"><title>sourcefile~types.f90&#45;&gt;sourcefile~hf_class.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M190,-296C273.901,-336.732 302.826,-331.86 396,-336"/>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M398,-336C409.048,-336.491 582.391,-299.123 593,-296"/>
</g>
<!-- sourcefile~types.f90&#45;&gt;sourcefile~calc_tasks_class.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_edge1" class="edge"><title>sourcefile~types.f90&#45;&gt;sourcefile~calc_tasks_class.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M190,-296C245.661,-322.725 260.224,-328.221 318,-350 327.617,-353.625 337.994,-357.268 347.943,-360.631"/>
<polygon fill="#000000" stroke="#000000" points="347.112,-364.044 357.706,-363.891 349.329,-357.404 347.112,-364.044"/>
</g>
<!-- sourcefile~types.f90&#45;&gt;sourcefile~response_calc_specs_class.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_edge2" class="edge"><title>sourcefile~types.f90&#45;&gt;sourcefile~response_calc_specs_class.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M398,-336C431.868,-337.505 469.078,-337.833 501.833,-337.674"/>
<polygon fill="#000000" stroke="#000000" points="501.869,-341.173 511.847,-337.609 501.824,-334.174 501.869,-341.173"/>
</g>
<!-- sourcefile~workspace.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_node5" class="node"><title>sourcefile~workspace.f90</title>
<g id="a_sourcefile~~hf_class.f90~~EfferentGraph_node5"><a xlink:href="../sourcefile/workspace.f90.html" xlink:title="workspace.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="439,-266 355,-266 355,-242 439,-242 439,-266"/>
<text text-anchor="middle" x="397" y="-251.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">workspace.F90</text>
</a>
</g>
</g>
<!-- sourcefile~types.f90&#45;&gt;sourcefile~workspace.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_edge3" class="edge"><title>sourcefile~types.f90&#45;&gt;sourcefile~workspace.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M190,-296C203.852,-302.651 288.61,-282.38 345,-267.727"/>
<polygon fill="#000000" stroke="#000000" points="346.041,-271.073 354.829,-265.155 344.269,-264.301 346.041,-271.073"/>
</g>
<!-- sourcefile~ground_state_specs_class.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_node6" class="node"><title>sourcefile~ground_state_specs_class.f90</title>
<g id="a_sourcefile~~hf_class.f90~~EfferentGraph_node6"><a xlink:href="../sourcefile/ground_state_specs_class.f90.html" xlink:title="ground_state_specs_class.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="476,-308 318,-308 318,-284 476,-284 476,-308"/>
<text text-anchor="middle" x="397" y="-293.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">ground_state_specs_class.F90</text>
</a>
</g>
</g>
<!-- sourcefile~types.f90&#45;&gt;sourcefile~ground_state_specs_class.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_edge5" class="edge"><title>sourcefile~types.f90&#45;&gt;sourcefile~ground_state_specs_class.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M190,-296C234.622,-317.425 291.207,-315.683 333.778,-309.562"/>
<polygon fill="#000000" stroke="#000000" points="334.388,-313.01 343.732,-308.016 333.314,-306.093 334.388,-313.01"/>
</g>
<!-- sourcefile~memory_manager_class.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_node7" class="node"><title>sourcefile~memory_manager_class.f90</title>
<g id="a_sourcefile~~hf_class.f90~~EfferentGraph_node7"><a xlink:href="../sourcefile/memory_manager_class.f90.html" xlink:title="memory_manager_class.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="668,-148 520,-148 520,-124 668,-124 668,-148"/>
<text text-anchor="middle" x="594" y="-133.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">memory_manager_class.F90</text>
</a>
</g>
</g>
<!-- sourcefile~types.f90&#45;&gt;sourcefile~memory_manager_class.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_edge8" class="edge"><title>sourcefile~types.f90&#45;&gt;sourcefile~memory_manager_class.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M398,-96C423.781,-97.2404 485.867,-110.652 533.113,-121.609"/>
<polygon fill="#000000" stroke="#000000" points="532.417,-125.04 542.951,-123.904 534.008,-118.223 532.417,-125.04"/>
</g>
<!-- sourcefile~utils.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_node8" class="node"><title>sourcefile~utils.f90</title>
<g id="a_sourcefile~~hf_class.f90~~EfferentGraph_node8"><a xlink:href="../sourcefile/utils.f90.html" xlink:title="utils.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="621,-228 567,-228 567,-204 621,-204 621,-228"/>
<text text-anchor="middle" x="594" y="-213.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">utils.F90</text>
</a>
</g>
</g>
<!-- sourcefile~types.f90&#45;&gt;sourcefile~utils.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_edge13" class="edge"><title>sourcefile~types.f90&#45;&gt;sourcefile~utils.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M35.8431,-108.104C51.3313,-144.918 103.638,-255.494 188,-296"/>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M190,-296C247.159,-323.444 256.718,-249.273 318,-233 401.217,-210.902 503.366,-211.475 556.683,-213.762"/>
<polygon fill="#000000" stroke="#000000" points="556.52,-217.259 566.675,-214.237 556.852,-210.266 556.52,-217.259"/>
</g>
<!-- sourcefile~calc_settings_class.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_node9" class="node"><title>sourcefile~calc_settings_class.f90</title>
<g id="a_sourcefile~~hf_class.f90~~EfferentGraph_node9"><a xlink:href="../sourcefile/calc_settings_class.f90.html" xlink:title="calc_settings_class.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="656,-106 532,-106 532,-82 656,-82 656,-106"/>
<text text-anchor="middle" x="594" y="-91.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">calc_settings_class.F90</text>
</a>
</g>
</g>
<!-- sourcefile~types.f90&#45;&gt;sourcefile~calc_settings_class.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_edge14" class="edge"><title>sourcefile~types.f90&#45;&gt;sourcefile~calc_settings_class.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M59.6686,-95.1767C91.1585,-94.4644 143.214,-93.8518 188,-96"/>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M190,-96C281.45,-100.387 304.55,-91.6002 396,-96"/>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M398,-96C438.957,-97.9705 484.806,-97.6289 521.751,-96.7218"/>
<polygon fill="#000000" stroke="#000000" points="522.02,-100.216 531.924,-96.4524 521.834,-93.2185 522.02,-100.216"/>
</g>
<!-- sourcefile~input_output.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_node10" class="node"><title>sourcefile~input_output.f90</title>
<g id="a_sourcefile~~hf_class.f90~~EfferentGraph_node10"><a xlink:href="../sourcefile/input_output.f90.html" xlink:title="input_output.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="234.5,-168 143.5,-168 143.5,-144 234.5,-144 234.5,-168"/>
<text text-anchor="middle" x="189" y="-153.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">input_output.F90</text>
</a>
</g>
</g>
<!-- sourcefile~types.f90&#45;&gt;sourcefile~input_output.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_edge15" class="edge"><title>sourcefile~types.f90&#45;&gt;sourcefile~input_output.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M59.7962,-107.005C84.1585,-116.315 119.371,-129.772 146.731,-140.228"/>
<polygon fill="#000000" stroke="#000000" points="145.83,-143.631 156.421,-143.931 148.329,-137.092 145.83,-143.631"/>
</g>
<!-- sourcefile~core_excited_state_specs_class.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_node11" class="node"><title>sourcefile~core_excited_state_specs_class.f90</title>
<g id="a_sourcefile~~hf_class.f90~~EfferentGraph_node11"><a xlink:href="../sourcefile/core_excited_state_specs_class.f90.html" xlink:title="core_excited_state_specs_class.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="281.5,-66 96.5,-66 96.5,-42 281.5,-42 281.5,-66"/>
<text text-anchor="middle" x="189" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">core_excited_state_specs_class.F90</text>
</a>
</g>
</g>
<!-- sourcefile~types.f90&#45;&gt;sourcefile~core_excited_state_specs_class.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_edge16" class="edge"><title>sourcefile~types.f90&#45;&gt;sourcefile~core_excited_state_specs_class.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M59.7962,-88.2966C80.2589,-82.8225 108.376,-75.3007 133.065,-68.6959"/>
<polygon fill="#000000" stroke="#000000" points="134.29,-71.9913 143.046,-66.0258 132.481,-65.2291 134.29,-71.9913"/>
</g>
<!-- sourcefile~excited_state_specs_class.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_node12" class="node"><title>sourcefile~excited_state_specs_class.f90</title>
<g id="a_sourcefile~~hf_class.f90~~EfferentGraph_node12"><a xlink:href="../sourcefile/excited_state_specs_class.f90.html" xlink:title="excited_state_specs_class.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="268,-24 110,-24 110,-0 268,-0 268,-24"/>
<text text-anchor="middle" x="189" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">excited_state_specs_class.F90</text>
</a>
</g>
</g>
<!-- sourcefile~types.f90&#45;&gt;sourcefile~excited_state_specs_class.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_edge17" class="edge"><title>sourcefile~types.f90&#45;&gt;sourcefile~excited_state_specs_class.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M40.1276,-83.7609C51.5589,-69.3415 72.5172,-45.7403 96,-33 99.5438,-31.0774 103.256,-29.3303 107.073,-27.7428"/>
<polygon fill="#000000" stroke="#000000" points="108.603,-30.9071 116.735,-24.1165 106.143,-24.3534 108.603,-30.9071"/>
</g>
<!-- sourcefile~batching_index_class.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_node13" class="node"><title>sourcefile~batching_index_class.f90</title>
<g id="a_sourcefile~~hf_class.f90~~EfferentGraph_node13"><a xlink:href="../sourcefile/batching_index_class.f90.html" xlink:title="batching_index_class.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="464,-148 330,-148 330,-124 464,-124 464,-148"/>
<text text-anchor="middle" x="397" y="-133.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">batching_index_class.F90</text>
</a>
</g>
</g>
<!-- sourcefile~types.f90&#45;&gt;sourcefile~batching_index_class.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_edge6" class="edge"><title>sourcefile~types.f90&#45;&gt;sourcefile~batching_index_class.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M190,-96C242.78,-98.5317 301.879,-111.035 343.194,-121.397"/>
<polygon fill="#000000" stroke="#000000" points="342.483,-124.828 353.038,-123.91 344.214,-118.045 342.483,-124.828"/>
</g>
<!-- sourcefile~workspace.f90&#45;&gt;sourcefile~hf_class.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_edge21" class="edge"><title>sourcefile~workspace.f90&#45;&gt;sourcefile~hf_class.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M595,-296C648,-280.399 699.532,-239.436 726.861,-215.05"/>
<polygon fill="#000000" stroke="#000000" points="729.501,-217.38 734.54,-208.06 724.789,-212.203 729.501,-217.38"/>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M439.395,-265.12C492.188,-278.959 578.424,-300.29 593,-296"/>
</g>
<!-- sourcefile~workspace.f90&#45;&gt;sourcefile~utils.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_edge12" class="edge"><title>sourcefile~workspace.f90&#45;&gt;sourcefile~utils.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M439.354,-245.941C474.158,-239.159 523.441,-229.555 556.728,-223.068"/>
<polygon fill="#000000" stroke="#000000" points="557.789,-226.427 566.935,-221.079 556.45,-219.557 557.789,-226.427"/>
</g>
<!-- sourcefile~ground_state_specs_class.f90&#45;&gt;sourcefile~hf_class.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_edge22" class="edge"><title>sourcefile~ground_state_specs_class.f90&#45;&gt;sourcefile~hf_class.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M476.313,-306.005C512.508,-308.11 555.652,-306.993 593,-296"/>
</g>
<!-- sourcefile~memory_manager_class.f90&#45;&gt;sourcefile~hf_class.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_edge23" class="edge"><title>sourcefile~memory_manager_class.f90&#45;&gt;sourcefile~hf_class.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M636.175,-148.024C649.058,-152.104 663.237,-156.923 676,-162 688.826,-167.102 702.583,-173.471 714.54,-179.312"/>
<polygon fill="#000000" stroke="#000000" points="713.177,-182.543 723.691,-183.849 716.287,-176.271 713.177,-182.543"/>
</g>
<!-- sourcefile~utils.f90&#45;&gt;sourcefile~hf_class.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_edge24" class="edge"><title>sourcefile~utils.f90&#45;&gt;sourcefile~hf_class.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M621.13,-212.562C643.235,-209.653 675.419,-205.419 701.709,-201.959"/>
<polygon fill="#000000" stroke="#000000" points="702.371,-205.402 711.829,-200.628 701.458,-198.462 702.371,-205.402"/>
</g>
<!-- sourcefile~calc_settings_class.f90&#45;&gt;sourcefile~hf_class.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_edge25" class="edge"><title>sourcefile~calc_settings_class.f90&#45;&gt;sourcefile~hf_class.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M656.347,-105.66C663.233,-108.19 669.94,-111.265 676,-115 700.761,-130.263 721.645,-156.882 734.221,-175.422"/>
<polygon fill="#000000" stroke="#000000" points="731.297,-177.347 739.708,-183.79 737.151,-173.508 731.297,-177.347"/>
</g>
<!-- sourcefile~input_output.f90&#45;&gt;sourcefile~hf_class.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_edge26" class="edge"><title>sourcefile~input_output.f90&#45;&gt;sourcefile~hf_class.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M398,-176C507.041,-181.23 635.153,-188.985 701.7,-193.134"/>
<polygon fill="#000000" stroke="#000000" points="701.641,-196.637 711.84,-193.768 702.078,-189.651 701.641,-196.637"/>
</g>
<!-- sourcefile~input_output.f90&#45;&gt;sourcefile~workspace.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_edge4" class="edge"><title>sourcefile~input_output.f90&#45;&gt;sourcefile~workspace.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M215.26,-168.017C251.939,-185.466 320.066,-217.876 361.392,-237.536"/>
<polygon fill="#000000" stroke="#000000" points="360,-240.75 370.534,-241.885 363.007,-234.428 360,-240.75"/>
</g>
<!-- sourcefile~input_output.f90&#45;&gt;sourcefile~memory_manager_class.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_edge10" class="edge"><title>sourcefile~input_output.f90&#45;&gt;sourcefile~memory_manager_class.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M398,-176C451.19,-178.551 510.995,-163.54 550.183,-151.184"/>
<polygon fill="#000000" stroke="#000000" points="551.492,-154.439 559.93,-148.03 549.338,-147.778 551.492,-154.439"/>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M234.513,-161.589C276.174,-166.519 340.19,-173.323 396,-176"/>
</g>
<!-- sourcefile~input_output.f90&#45;&gt;sourcefile~utils.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_edge11" class="edge"><title>sourcefile~input_output.f90&#45;&gt;sourcefile~utils.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M398,-176C454.404,-178.705 518.248,-194.253 557.055,-205.147"/>
<polygon fill="#000000" stroke="#000000" points="556.259,-208.56 566.836,-207.944 558.183,-201.829 556.259,-208.56"/>
</g>
<!-- sourcefile~input_output.f90&#45;&gt;sourcefile~batching_index_class.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_edge7" class="edge"><title>sourcefile~input_output.f90&#45;&gt;sourcefile~batching_index_class.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M234.699,-151.66C259.574,-149.245 291.214,-146.173 319.87,-143.391"/>
<polygon fill="#000000" stroke="#000000" points="320.251,-146.871 329.866,-142.421 319.575,-139.904 320.251,-146.871"/>
</g>
<!-- sourcefile~core_excited_state_specs_class.f90&#45;&gt;sourcefile~hf_class.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_edge27" class="edge"><title>sourcefile~core_excited_state_specs_class.f90&#45;&gt;sourcefile~hf_class.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M281.573,-52.0271C317.298,-51.7738 358.585,-52.116 396,-54"/>
</g>
<!-- sourcefile~excited_state_specs_class.f90&#45;&gt;sourcefile~hf_class.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_edge28" class="edge"><title>sourcefile~excited_state_specs_class.f90&#45;&gt;sourcefile~hf_class.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M398,-54C521.687,-60.228 570.926,-7.45095 676,-73 712.729,-95.9126 732.474,-145.25 741.255,-173.991"/>
<polygon fill="#000000" stroke="#000000" points="737.975,-175.251 744.096,-183.899 744.704,-173.322 737.975,-175.251"/>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M244.903,-24.0532C300.718,-36.1678 381.058,-53.1716 396,-54"/>
</g>
<!-- sourcefile~batching_index_class.f90&#45;&gt;sourcefile~memory_manager_class.f90 -->
<g id="sourcefile~~hf_class.f90~~EfferentGraph_edge9" class="edge"><title>sourcefile~batching_index_class.f90&#45;&gt;sourcefile~memory_manager_class.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M464.018,-136C478.561,-136 494.152,-136 509.289,-136"/>
<polygon fill="#000000" stroke="#000000" points="509.678,-139.5 519.678,-136 509.678,-132.5 509.678,-139.5"/>
</g>
</g>
</svg>
</div>
                <script>var pansourcefilehf_classf90EfferentGraph = svgPanZoom('#sourcefilehf_classf90EfferentGraph', {
                    zoomEnabled: true,
                    controlIconsEnabled: true,
                    fit: true,
                    center: true,});
                    </script>
                <div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div>
                <div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog">
                  <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="-graph-help-label">Graph Key</h4>
                      </div>
                      <div class="modal-body">
                        
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.36.0 (20140111.2315)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="188pt" height="32pt"
 viewBox="0.00 0.00 188.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 184,-28 184,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node"><title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="66,-24 0,-24 0,-0 66,-0 66,-24"/>
<text text-anchor="middle" x="33" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node"><title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="180,-24 84,-24 84,-0 180,-0 180,-24"/>
<text text-anchor="middle" x="132" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which depends upon it. A file 
    is dependent upon another if the latter must be compiled before the former
    can be.
    </p>
    
                      </div>
                    </div>
                  </div>
                </div>
                
    
      
      <h3>Files Dependent On This One</h3>
      
                <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.36.0 (20140111.2315)
 -->
<!-- Title: sourcefile~~hf_class.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefilehf_classf90AfferentGraph" width="641pt" height="532pt"
 viewBox="0.00 0.00 641.00 531.96" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~hf_class.f90~~AfferentGraph" class="graph" transform="scale(0.602444 0.602444) rotate(0) translate(4 879)">
<title>sourcefile~~hf_class.f90~~AfferentGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-879 1060,-879 1060,4 -4,4"/>
<!-- sourcefile~hf_class.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node1" class="node"><title>sourcefile~hf_class.f90</title>
<polygon fill="none" stroke="black" points="72,-85 0,-85 0,-61 72,-61 72,-85"/>
<text text-anchor="middle" x="36" y="-70.6" font-family="Helvetica,sans-Serif" font-size="10.50">hf_class.F90</text>
</g>
<!-- sourcefile~ccs_class.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node2" class="node"><title>sourcefile~ccs_class.f90</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node2"><a xlink:href="../sourcefile/ccs_class.f90.html" xlink:title="ccs_class.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="189.5,-417 110.5,-417 110.5,-393 189.5,-393 189.5,-417"/>
<text text-anchor="middle" x="150" y="-402.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">ccs_class.F90</text>
</a>
</g>
</g>
<!-- sourcefile~hf_class.f90&#45;&gt;sourcefile~ccs_class.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge51" class="edge"><title>sourcefile~hf_class.f90&#45;&gt;sourcefile~ccs_class.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M41.119,-85.2098C57.7549,-134.524 120.123,-319.401 141.644,-383.195"/>
<polygon fill="#000000" stroke="#000000" points="138.331,-384.323 144.844,-392.679 144.963,-382.085 138.331,-384.323"/>
</g>
<!-- sourcefile~et_program.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node3" class="node"><title>sourcefile~et_program.f90</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node3"><a xlink:href="../sourcefile/et_program.f90.html" xlink:title="eT_program.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1012.5,-461 921.5,-461 921.5,-437 1012.5,-437 1012.5,-461"/>
<text text-anchor="middle" x="967" y="-446.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">eT_program.F90</text>
</a>
</g>
</g>
<!-- sourcefile~hf_class.f90&#45;&gt;sourcefile~et_program.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge52" class="edge"><title>sourcefile~hf_class.f90&#45;&gt;sourcefile~et_program.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M72.0607,-72.1908C125.251,-71.1463 229.513,-69.815 318,-73"/>
</g>
<!-- sourcefile~mp2_class.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node4" class="node"><title>sourcefile~mp2_class.f90</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node4"><a xlink:href="../sourcefile/mp2_class.f90.html" xlink:title="mp2_class.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="192,-45 108,-45 108,-21 192,-21 192,-45"/>
<text text-anchor="middle" x="150" y="-30.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">mp2_class.F90</text>
</a>
</g>
</g>
<!-- sourcefile~hf_class.f90&#45;&gt;sourcefile~mp2_class.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge53" class="edge"><title>sourcefile~hf_class.f90&#45;&gt;sourcefile~mp2_class.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M70.6037,-60.9987C81.5776,-57.0794 93.9254,-52.6695 105.519,-48.529"/>
<polygon fill="#000000" stroke="#000000" points="106.793,-51.7906 115.033,-45.1311 104.438,-45.1984 106.793,-51.7906"/>
</g>
<!-- sourcefile~ccs_class.f90&#45;&gt;sourcefile~et_program.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge40" class="edge"><title>sourcefile~ccs_class.f90&#45;&gt;sourcefile~et_program.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M320,-697C362.685,-718.954 707.441,-714.847 752,-697"/>
</g>
<!-- sourcefile~mlcc2_class.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node5" class="node"><title>sourcefile~mlcc2_class.f90</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node5"><a xlink:href="../sourcefile/mlcc2_class.f90.html" xlink:title="mlcc2_class.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="582.5,-667 491.5,-667 491.5,-643 582.5,-643 582.5,-667"/>
<text text-anchor="middle" x="537" y="-652.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">mlcc2_class.F90</text>
</a>
</g>
</g>
<!-- sourcefile~ccs_class.f90&#45;&gt;sourcefile~mlcc2_class.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge35" class="edge"><title>sourcefile~ccs_class.f90&#45;&gt;sourcefile~mlcc2_class.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M150.372,-417.291C148.9,-460.273 150.134,-605.173 228,-678 257.858,-705.925 281.645,-678.301 318,-697"/>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M320,-697C334.211,-704.309 422.117,-684.122 481.315,-669.259"/>
<polygon fill="#000000" stroke="#000000" points="482.444,-672.584 491.281,-666.739 480.728,-665.797 482.444,-672.584"/>
</g>
<!-- sourcefile~fock_submodule.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node6" class="node"><title>sourcefile~fock_submodule.f90</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node6"><a xlink:href="../sourcefile/fock_submodule.f90.html" xlink:title="fock_submodule.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="374,-669 264,-669 264,-645 374,-645 374,-669"/>
<text text-anchor="middle" x="319" y="-654.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">fock_submodule.F90</text>
</a>
</g>
</g>
<!-- sourcefile~ccs_class.f90&#45;&gt;sourcefile~fock_submodule.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge36" class="edge"><title>sourcefile~ccs_class.f90&#45;&gt;sourcefile~fock_submodule.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M151.155,-417.228C152.339,-455.707 161.454,-575.343 228,-636 235.381,-642.728 244.495,-647.426 254.061,-650.683"/>
<polygon fill="#000000" stroke="#000000" points="253.152,-654.064 263.731,-653.482 255.098,-647.34 253.152,-654.064"/>
</g>
<!-- sourcefile~cc2_class.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node7" class="node"><title>sourcefile~cc2_class.f90</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node7"><a xlink:href="../sourcefile/cc2_class.f90.html" xlink:title="cc2_class.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="359,-627 279,-627 279,-603 359,-603 359,-627"/>
<text text-anchor="middle" x="319" y="-612.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">cc2_class.F90</text>
</a>
</g>
</g>
<!-- sourcefile~ccs_class.f90&#45;&gt;sourcefile~cc2_class.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge37" class="edge"><title>sourcefile~ccs_class.f90&#45;&gt;sourcefile~cc2_class.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M152.194,-417.396C156.148,-451.288 171.947,-546.154 228,-594 239.403,-603.733 254.471,-609.159 269.01,-612.125"/>
<polygon fill="#000000" stroke="#000000" points="268.496,-615.587 278.94,-613.808 269.666,-608.686 268.496,-615.587"/>
</g>
<!-- sourcefile~excited_state_submodule.f90~5 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node8" class="node"><title>sourcefile~excited_state_submodule.f90~5</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node8"><a xlink:href="../sourcefile/excited_state_submodule.f90%7E5.html" xlink:title="excited_state_submodule.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="395.5,-585 242.5,-585 242.5,-561 395.5,-561 395.5,-585"/>
<text text-anchor="middle" x="319" y="-570.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">excited_state_submodule.F90</text>
</a>
</g>
</g>
<!-- sourcefile~ccs_class.f90&#45;&gt;sourcefile~excited_state_submodule.f90~5 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge38" class="edge"><title>sourcefile~ccs_class.f90&#45;&gt;sourcefile~excited_state_submodule.f90~5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M153.69,-417.108C160.644,-445.446 181.981,-516.376 228,-552 229.856,-553.436 231.793,-554.777 233.796,-556.029"/>
<polygon fill="#000000" stroke="#000000" points="232.494,-559.303 242.958,-560.963 235.813,-553.14 232.494,-559.303"/>
</g>
<!-- sourcefile~input_reader_submodule.f90~3 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node9" class="node"><title>sourcefile~input_reader_submodule.f90~3</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node9"><a xlink:href="../sourcefile/input_reader_submodule.f90%7E3.html" xlink:title="input_reader_submodule.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="394,-543 244,-543 244,-519 394,-519 394,-543"/>
<text text-anchor="middle" x="319" y="-528.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">input_reader_submodule.F90</text>
</a>
</g>
</g>
<!-- sourcefile~ccs_class.f90&#45;&gt;sourcefile~input_reader_submodule.f90~3 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge39" class="edge"><title>sourcefile~ccs_class.f90&#45;&gt;sourcefile~input_reader_submodule.f90~3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M156.403,-417.268C166.841,-439.469 191.971,-486.207 228,-510 230.594,-511.713 233.311,-513.287 236.117,-514.733"/>
<polygon fill="#000000" stroke="#000000" points="234.791,-517.975 245.343,-518.931 237.691,-511.604 234.791,-517.975"/>
</g>
<!-- sourcefile~jacobian_transpose_submodule.f90~2 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node10" class="node"><title>sourcefile~jacobian_transpose_submodule.f90~2</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node10"><a xlink:href="../sourcefile/jacobian_transpose_submodule.f90%7E2.html" xlink:title="jacobian_transpose_submodule.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="410,-501 228,-501 228,-477 410,-477 410,-501"/>
<text text-anchor="middle" x="319" y="-486.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">jacobian_transpose_submodule.F90</text>
</a>
</g>
</g>
<!-- sourcefile~ccs_class.f90&#45;&gt;sourcefile~jacobian_transpose_submodule.f90~2 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge41" class="edge"><title>sourcefile~ccs_class.f90&#45;&gt;sourcefile~jacobian_transpose_submodule.f90~2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M162.312,-417.162C176.345,-431.505 201.656,-455.031 228,-468 232.273,-470.104 236.766,-472.002 241.37,-473.714"/>
<polygon fill="#000000" stroke="#000000" points="240.346,-477.063 250.94,-476.974 242.602,-470.437 240.346,-477.063"/>
</g>
<!-- sourcefile~ionized_state_submodule.f90~2 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node11" class="node"><title>sourcefile~ionized_state_submodule.f90~2</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node11"><a xlink:href="../sourcefile/ionized_state_submodule.f90%7E2.html" xlink:title="ionized_state_submodule.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="395.5,-459 242.5,-459 242.5,-435 395.5,-435 395.5,-459"/>
<text text-anchor="middle" x="319" y="-444.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">ionized_state_submodule.F90</text>
</a>
</g>
</g>
<!-- sourcefile~ccs_class.f90&#45;&gt;sourcefile~ionized_state_submodule.f90~2 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge42" class="edge"><title>sourcefile~ccs_class.f90&#45;&gt;sourcefile~ionized_state_submodule.f90~2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M189.703,-415.856C201.929,-419.205 215.507,-422.84 228,-426 236.589,-428.173 245.66,-430.385 254.606,-432.519"/>
<polygon fill="#000000" stroke="#000000" points="254.083,-435.992 264.62,-434.888 255.695,-429.18 254.083,-435.992"/>
</g>
<!-- sourcefile~integrals_submodule.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node12" class="node"><title>sourcefile~integrals_submodule.f90</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node12"><a xlink:href="../sourcefile/integrals_submodule.f90.html" xlink:title="integrals_submodule.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="384,-417 254,-417 254,-393 384,-393 384,-417"/>
<text text-anchor="middle" x="319" y="-402.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">integrals_submodule.F90</text>
</a>
</g>
</g>
<!-- sourcefile~ccs_class.f90&#45;&gt;sourcefile~integrals_submodule.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge43" class="edge"><title>sourcefile~ccs_class.f90&#45;&gt;sourcefile~integrals_submodule.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M189.733,-405C205.905,-405 225.257,-405 243.967,-405"/>
<polygon fill="#000000" stroke="#000000" points="243.971,-408.5 253.971,-405 243.971,-401.5 243.971,-408.5"/>
</g>
<!-- sourcefile~cholesky_submodule.f90~2 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node13" class="node"><title>sourcefile~cholesky_submodule.f90~2</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node13"><a xlink:href="../sourcefile/cholesky_submodule.f90%7E2.html" xlink:title="cholesky_submodule.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="385,-375 253,-375 253,-351 385,-351 385,-375"/>
<text text-anchor="middle" x="319" y="-360.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">cholesky_submodule.F90</text>
</a>
</g>
</g>
<!-- sourcefile~ccs_class.f90&#45;&gt;sourcefile~cholesky_submodule.f90~2 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge44" class="edge"><title>sourcefile~ccs_class.f90&#45;&gt;sourcefile~cholesky_submodule.f90~2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M189.703,-394.144C201.929,-390.795 215.507,-387.16 228,-384 236.589,-381.827 245.66,-379.615 254.606,-377.481"/>
<polygon fill="#000000" stroke="#000000" points="255.695,-380.82 264.62,-375.112 254.083,-374.008 255.695,-380.82"/>
</g>
<!-- sourcefile~jacobian_submodule.f90~5 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node14" class="node"><title>sourcefile~jacobian_submodule.f90~5</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node14"><a xlink:href="../sourcefile/jacobian_submodule.f90%7E5.html" xlink:title="jacobian_submodule.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="384,-333 254,-333 254,-309 384,-309 384,-333"/>
<text text-anchor="middle" x="319" y="-318.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">jacobian_submodule.F90</text>
</a>
</g>
</g>
<!-- sourcefile~ccs_class.f90&#45;&gt;sourcefile~jacobian_submodule.f90~5 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge45" class="edge"><title>sourcefile~ccs_class.f90&#45;&gt;sourcefile~jacobian_submodule.f90~5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M162.312,-392.838C176.345,-378.495 201.656,-354.969 228,-342 233.164,-339.458 238.648,-337.215 244.262,-335.239"/>
<polygon fill="#000000" stroke="#000000" points="245.357,-338.564 253.796,-332.158 243.204,-331.903 245.357,-338.564"/>
</g>
<!-- sourcefile~response_submodule.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node15" class="node"><title>sourcefile~response_submodule.f90</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node15"><a xlink:href="../sourcefile/response_submodule.f90.html" xlink:title="response_submodule.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="386,-291 252,-291 252,-267 386,-267 386,-291"/>
<text text-anchor="middle" x="319" y="-276.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">response_submodule.F90</text>
</a>
</g>
</g>
<!-- sourcefile~ccs_class.f90&#45;&gt;sourcefile~response_submodule.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge46" class="edge"><title>sourcefile~ccs_class.f90&#45;&gt;sourcefile~response_submodule.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M156.403,-392.732C166.841,-370.531 191.971,-323.793 228,-300 232.406,-297.091 237.166,-294.582 242.116,-292.42"/>
<polygon fill="#000000" stroke="#000000" points="243.758,-295.538 251.829,-288.673 241.239,-289.007 243.758,-295.538"/>
</g>
<!-- sourcefile~cvs_submodule.f90~2 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node16" class="node"><title>sourcefile~cvs_submodule.f90~2</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node16"><a xlink:href="../sourcefile/cvs_submodule.f90%7E2.html" xlink:title="cvs_submodule.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="372,-249 266,-249 266,-225 372,-225 372,-249"/>
<text text-anchor="middle" x="319" y="-234.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">cvs_submodule.F90</text>
</a>
</g>
</g>
<!-- sourcefile~ccs_class.f90&#45;&gt;sourcefile~cvs_submodule.f90~2 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge47" class="edge"><title>sourcefile~ccs_class.f90&#45;&gt;sourcefile~cvs_submodule.f90~2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M153.69,-392.892C160.644,-364.554 181.981,-293.624 228,-258 236.172,-251.674 245.93,-247.201 255.958,-244.051"/>
<polygon fill="#000000" stroke="#000000" points="256.886,-247.425 265.613,-241.417 255.044,-240.672 256.886,-247.425"/>
</g>
<!-- sourcefile~ccsd_class.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node17" class="node"><title>sourcefile~ccsd_class.f90</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node17"><a xlink:href="../sourcefile/ccsd_class.f90.html" xlink:title="ccsd_class.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="361.5,-207 276.5,-207 276.5,-183 361.5,-183 361.5,-207"/>
<text text-anchor="middle" x="319" y="-192.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">ccsd_class.F90</text>
</a>
</g>
</g>
<!-- sourcefile~ccs_class.f90&#45;&gt;sourcefile~ccsd_class.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge48" class="edge"><title>sourcefile~ccs_class.f90&#45;&gt;sourcefile~ccsd_class.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M152.194,-392.604C156.148,-358.712 171.947,-263.846 228,-216 238.704,-206.863 252.638,-201.522 266.332,-198.449"/>
<polygon fill="#000000" stroke="#000000" points="267.032,-201.878 276.212,-196.589 265.737,-194.999 267.032,-201.878"/>
</g>
<!-- sourcefile~ground_state_submodule.f90~4 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node18" class="node"><title>sourcefile~ground_state_submodule.f90~4</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node18"><a xlink:href="../sourcefile/ground_state_submodule.f90%7E4.html" xlink:title="ground_state_submodule.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="395,-165 243,-165 243,-141 395,-141 395,-165"/>
<text text-anchor="middle" x="319" y="-150.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">ground_state_submodule.F90</text>
</a>
</g>
</g>
<!-- sourcefile~ccs_class.f90&#45;&gt;sourcefile~ground_state_submodule.f90~4 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge49" class="edge"><title>sourcefile~ccs_class.f90&#45;&gt;sourcefile~ground_state_submodule.f90~4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M151.155,-392.772C152.339,-354.293 161.454,-234.657 228,-174 229.919,-172.25 231.956,-170.638 234.087,-169.153"/>
<polygon fill="#000000" stroke="#000000" points="235.911,-172.14 242.729,-164.031 232.342,-166.119 235.911,-172.14"/>
</g>
<!-- sourcefile~mp2_class.f90&#45;&gt;sourcefile~et_program.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge50" class="edge"><title>sourcefile~mp2_class.f90&#45;&gt;sourcefile~et_program.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M320,-73C435.876,-79.8327 748.649,-23.0115 842,-92 952.754,-173.85 965.251,-361.476 966.16,-426.399"/>
<polygon fill="#000000" stroke="#000000" points="962.661,-426.737 966.217,-436.717 969.661,-426.698 962.661,-426.737"/>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M184.042,-45.0371C217.346,-56.183 270.479,-71.2895 318,-73"/>
</g>
<!-- sourcefile~mlcc2_class.f90&#45;&gt;sourcefile~et_program.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge14" class="edge"><title>sourcefile~mlcc2_class.f90&#45;&gt;sourcefile~et_program.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M574.584,-667.12C626.903,-683.614 720.28,-709.705 752,-697"/>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M754,-697C791.144,-682.123 811.334,-703.702 842,-678 874.386,-650.856 858.744,-627.615 878,-590 900.819,-545.426 933.139,-496.49 951.593,-469.59"/>
<polygon fill="#000000" stroke="#000000" points="954.698,-471.253 957.504,-461.037 948.939,-467.273 954.698,-471.253"/>
</g>
<!-- sourcefile~mlccsd_class.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node19" class="node"><title>sourcefile~mlccsd_class.f90</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node19"><a xlink:href="../sourcefile/mlccsd_class.f90.html" xlink:title="mlccsd_class.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="801,-749 705,-749 705,-725 801,-725 801,-749"/>
<text text-anchor="middle" x="753" y="-734.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">mlccsd_class.F90</text>
</a>
</g>
</g>
<!-- sourcefile~mlcc2_class.f90&#45;&gt;sourcefile~mlccsd_class.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge9" class="edge"><title>sourcefile~mlcc2_class.f90&#45;&gt;sourcefile~mlccsd_class.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M562.704,-667.136C587.824,-679.201 628.057,-697.768 664,-711 674.638,-714.916 686.161,-718.664 697.255,-722.035"/>
<polygon fill="#000000" stroke="#000000" points="696.278,-725.396 706.861,-724.894 698.275,-718.687 696.278,-725.396"/>
</g>
<!-- sourcefile~orbital_partitioning_submodule.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node20" class="node"><title>sourcefile~orbital_partitioning_submodule.f90</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node20"><a xlink:href="../sourcefile/orbital_partitioning_submodule.f90.html" xlink:title="orbital_partitioning_submodule.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="841.5,-669 664.5,-669 664.5,-645 841.5,-645 841.5,-669"/>
<text text-anchor="middle" x="753" y="-654.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">orbital_partitioning_submodule.F90</text>
</a>
</g>
</g>
<!-- sourcefile~mlcc2_class.f90&#45;&gt;sourcefile~orbital_partitioning_submodule.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge10" class="edge"><title>sourcefile~mlcc2_class.f90&#45;&gt;sourcefile~orbital_partitioning_submodule.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M582.601,-655.417C603.38,-655.611 628.984,-655.85 653.936,-656.084"/>
<polygon fill="#000000" stroke="#000000" points="654.165,-659.586 664.198,-656.179 654.231,-652.586 654.165,-659.586"/>
</g>
<!-- sourcefile~omega_submodule.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node21" class="node"><title>sourcefile~omega_submodule.f90</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node21"><a xlink:href="../sourcefile/omega_submodule.f90.html" xlink:title="omega_submodule.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="814.5,-627 691.5,-627 691.5,-603 814.5,-603 814.5,-627"/>
<text text-anchor="middle" x="753" y="-612.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">omega_submodule.F90</text>
</a>
</g>
</g>
<!-- sourcefile~mlcc2_class.f90&#45;&gt;sourcefile~omega_submodule.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge11" class="edge"><title>sourcefile~mlcc2_class.f90&#45;&gt;sourcefile~omega_submodule.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M582.601,-646.663C611.131,-641.331 648.758,-634.298 681.302,-628.215"/>
<polygon fill="#000000" stroke="#000000" points="682.037,-631.638 691.223,-626.36 680.751,-624.757 682.037,-631.638"/>
</g>
<!-- sourcefile~input_reader_submodule.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node22" class="node"><title>sourcefile~input_reader_submodule.f90</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node22"><a xlink:href="../sourcefile/input_reader_submodule.f90.html" xlink:title="input_reader_submodule.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="828,-585 678,-585 678,-561 828,-561 828,-585"/>
<text text-anchor="middle" x="753" y="-570.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">input_reader_submodule.F90</text>
</a>
</g>
</g>
<!-- sourcefile~mlcc2_class.f90&#45;&gt;sourcefile~input_reader_submodule.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge12" class="edge"><title>sourcefile~mlcc2_class.f90&#45;&gt;sourcefile~input_reader_submodule.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M582.643,-645.302C597.65,-640.97 614.098,-634.993 628,-627 646.817,-616.182 644.83,-604.179 664,-594 667.746,-592.011 671.68,-590.208 675.722,-588.574"/>
<polygon fill="#000000" stroke="#000000" points="677.124,-591.788 685.309,-585.06 674.715,-585.216 677.124,-591.788"/>
</g>
<!-- sourcefile~excited_state_submodule.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node23" class="node"><title>sourcefile~excited_state_submodule.f90</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node23"><a xlink:href="../sourcefile/excited_state_submodule.f90.html" xlink:title="excited_state_submodule.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="829.5,-543 676.5,-543 676.5,-519 829.5,-519 829.5,-543"/>
<text text-anchor="middle" x="753" y="-528.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">excited_state_submodule.F90</text>
</a>
</g>
</g>
<!-- sourcefile~mlcc2_class.f90&#45;&gt;sourcefile~excited_state_submodule.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge13" class="edge"><title>sourcefile~mlcc2_class.f90&#45;&gt;sourcefile~excited_state_submodule.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M582.81,-648.638C598.515,-644.572 615.369,-637.911 628,-627 655.981,-602.83 635.221,-575.214 664,-552 665.788,-550.558 667.659,-549.212 669.597,-547.956"/>
<polygon fill="#000000" stroke="#000000" points="671.45,-550.93 678.482,-543.006 668.043,-544.815 671.45,-550.93"/>
</g>
<!-- sourcefile~jacobian_submodule.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node24" class="node"><title>sourcefile~jacobian_submodule.f90</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node24"><a xlink:href="../sourcefile/jacobian_submodule.f90.html" xlink:title="jacobian_submodule.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="818,-501 688,-501 688,-477 818,-477 818,-501"/>
<text text-anchor="middle" x="753" y="-486.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">jacobian_submodule.F90</text>
</a>
</g>
</g>
<!-- sourcefile~mlcc2_class.f90&#45;&gt;sourcefile~jacobian_submodule.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge15" class="edge"><title>sourcefile~mlcc2_class.f90&#45;&gt;sourcefile~jacobian_submodule.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M582.801,-649.856C598.879,-645.933 615.985,-639.052 628,-627 666.411,-588.469 624.314,-547.215 664,-510 668.331,-505.939 673.301,-502.62 678.627,-499.911"/>
<polygon fill="#000000" stroke="#000000" points="680.091,-503.091 687.877,-495.907 677.31,-496.667 680.091,-503.091"/>
</g>
<!-- sourcefile~cc2_class.f90&#45;&gt;sourcefile~et_program.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge18" class="edge"><title>sourcefile~cc2_class.f90&#45;&gt;sourcefile~et_program.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M359.188,-617.705C432.75,-621.936 587.741,-626.575 628,-594 673.276,-557.366 621.488,-507.809 664,-468 693.206,-440.651 712.324,-443.824 752,-449"/>
</g>
<!-- sourcefile~omega_submodule.f90~5 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node32" class="node"><title>sourcefile~omega_submodule.f90~5</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node32"><a xlink:href="../sourcefile/omega_submodule.f90%7E5.html" xlink:title="omega_submodule.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="598.5,-585 475.5,-585 475.5,-561 598.5,-561 598.5,-585"/>
<text text-anchor="middle" x="537" y="-570.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">omega_submodule.F90</text>
</a>
</g>
</g>
<!-- sourcefile~cc2_class.f90&#45;&gt;sourcefile~omega_submodule.f90~5 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge16" class="edge"><title>sourcefile~cc2_class.f90&#45;&gt;sourcefile~omega_submodule.f90~5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M359.116,-607.394C388.549,-601.671 429.697,-593.67 464.899,-586.825"/>
<polygon fill="#000000" stroke="#000000" points="465.985,-590.18 475.133,-584.835 464.649,-583.308 465.985,-590.18"/>
</g>
<!-- sourcefile~excited_state_submodule.f90~4 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node33" class="node"><title>sourcefile~excited_state_submodule.f90~4</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node33"><a xlink:href="../sourcefile/excited_state_submodule.f90%7E4.html" xlink:title="excited_state_submodule.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="613.5,-543 460.5,-543 460.5,-519 613.5,-519 613.5,-543"/>
<text text-anchor="middle" x="537" y="-528.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">excited_state_submodule.F90</text>
</a>
</g>
</g>
<!-- sourcefile~cc2_class.f90&#45;&gt;sourcefile~excited_state_submodule.f90~4 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge17" class="edge"><title>sourcefile~cc2_class.f90&#45;&gt;sourcefile~excited_state_submodule.f90~4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M359.261,-611.317C375.835,-608.419 394.777,-603.244 410,-594 431.015,-581.24 424.985,-564.76 446,-552 448.97,-550.197 452.082,-548.548 455.29,-547.041"/>
<polygon fill="#000000" stroke="#000000" points="456.68,-550.253 464.548,-543.158 453.972,-543.798 456.68,-550.253"/>
</g>
<!-- sourcefile~jacobian_submodule.f90~4 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node34" class="node"><title>sourcefile~jacobian_submodule.f90~4</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node34"><a xlink:href="../sourcefile/jacobian_submodule.f90%7E4.html" xlink:title="jacobian_submodule.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="602,-501 472,-501 472,-477 602,-477 602,-501"/>
<text text-anchor="middle" x="537" y="-486.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">jacobian_submodule.F90</text>
</a>
</g>
</g>
<!-- sourcefile~cc2_class.f90&#45;&gt;sourcefile~jacobian_submodule.f90~4 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge19" class="edge"><title>sourcefile~cc2_class.f90&#45;&gt;sourcefile~jacobian_submodule.f90~4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M359.414,-613.629C376.601,-611.199 395.982,-605.749 410,-594 441.129,-567.909 414.871,-536.091 446,-510 450.923,-505.874 456.506,-502.525 462.424,-499.811"/>
<polygon fill="#000000" stroke="#000000" points="463.936,-502.977 471.951,-496.048 461.365,-496.466 463.936,-502.977"/>
</g>
<!-- sourcefile~ccsd_class.f90&#45;&gt;sourcefile~et_program.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge29" class="edge"><title>sourcefile~ccsd_class.f90&#45;&gt;sourcefile~et_program.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M361.706,-195.035C378.921,-197.256 397.687,-202.911 410,-216 475.486,-285.609 375.138,-363.872 446,-428 496.538,-473.735 684.451,-439.891 752,-449"/>
</g>
<!-- sourcefile~excited_state_submodule.f90~3 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node35" class="node"><title>sourcefile~excited_state_submodule.f90~3</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node35"><a xlink:href="../sourcefile/excited_state_submodule.f90%7E3.html" xlink:title="excited_state_submodule.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="613.5,-419 460.5,-419 460.5,-395 613.5,-395 613.5,-419"/>
<text text-anchor="middle" x="537" y="-404.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">excited_state_submodule.F90</text>
</a>
</g>
</g>
<!-- sourcefile~ccsd_class.f90&#45;&gt;sourcefile~excited_state_submodule.f90~3 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge26" class="edge"><title>sourcefile~ccsd_class.f90&#45;&gt;sourcefile~excited_state_submodule.f90~3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M361.917,-195.335C378.961,-197.64 397.537,-203.278 410,-216 464.047,-271.169 391.953,-330.831 446,-386 447.688,-387.723 449.488,-389.316 451.38,-390.788"/>
<polygon fill="#000000" stroke="#000000" points="449.919,-394.011 460.218,-396.5 453.719,-388.132 449.919,-394.011"/>
</g>
<!-- sourcefile~cvs_submodule.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node36" class="node"><title>sourcefile~cvs_submodule.f90</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node36"><a xlink:href="../sourcefile/cvs_submodule.f90.html" xlink:title="cvs_submodule.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="590,-377 484,-377 484,-353 590,-353 590,-377"/>
<text text-anchor="middle" x="537" y="-362.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">cvs_submodule.F90</text>
</a>
</g>
</g>
<!-- sourcefile~ccsd_class.f90&#45;&gt;sourcefile~cvs_submodule.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge27" class="edge"><title>sourcefile~ccsd_class.f90&#45;&gt;sourcefile~cvs_submodule.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M361.522,-195.734C378.497,-198.11 397.127,-203.693 410,-216 452.715,-256.838 403.285,-303.162 446,-344 453.734,-351.394 463.546,-356.361 473.828,-359.663"/>
<polygon fill="#000000" stroke="#000000" points="473.212,-363.122 483.779,-362.344 475.034,-356.363 473.212,-363.122"/>
</g>
<!-- sourcefile~ionized_state_submodule.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node37" class="node"><title>sourcefile~ionized_state_submodule.f90</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node37"><a xlink:href="../sourcefile/ionized_state_submodule.f90.html" xlink:title="ionized_state_submodule.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="613.5,-335 460.5,-335 460.5,-311 613.5,-311 613.5,-335"/>
<text text-anchor="middle" x="537" y="-320.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">ionized_state_submodule.F90</text>
</a>
</g>
</g>
<!-- sourcefile~ccsd_class.f90&#45;&gt;sourcefile~ionized_state_submodule.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge28" class="edge"><title>sourcefile~ccsd_class.f90&#45;&gt;sourcefile~ionized_state_submodule.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M361.735,-196.652C378.346,-199.226 396.644,-204.709 410,-216 441.644,-242.751 414.356,-275.249 446,-302 447.742,-303.473 449.569,-304.847 451.464,-306.128"/>
<polygon fill="#000000" stroke="#000000" points="449.768,-309.191 460.175,-311.176 453.277,-303.134 449.768,-309.191"/>
</g>
<!-- sourcefile~jacobian_submodule.f90~3 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node38" class="node"><title>sourcefile~jacobian_submodule.f90~3</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node38"><a xlink:href="../sourcefile/jacobian_submodule.f90%7E3.html" xlink:title="jacobian_submodule.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="602,-293 472,-293 472,-269 602,-269 602,-293"/>
<text text-anchor="middle" x="537" y="-278.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">jacobian_submodule.F90</text>
</a>
</g>
</g>
<!-- sourcefile~ccsd_class.f90&#45;&gt;sourcefile~jacobian_submodule.f90~3 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge30" class="edge"><title>sourcefile~ccsd_class.f90&#45;&gt;sourcefile~jacobian_submodule.f90~3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M361.619,-198.918C377.653,-201.861 395.565,-207.007 410,-216 431.446,-229.36 424.554,-246.64 446,-260 451.06,-263.152 456.547,-265.832 462.231,-268.11"/>
<polygon fill="#000000" stroke="#000000" points="461.346,-271.51 471.941,-271.576 463.7,-264.918 461.346,-271.51"/>
</g>
<!-- sourcefile~ground_state_submodule.f90~2 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node39" class="node"><title>sourcefile~ground_state_submodule.f90~2</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node39"><a xlink:href="../sourcefile/ground_state_submodule.f90%7E2.html" xlink:title="ground_state_submodule.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="613,-251 461,-251 461,-227 613,-227 613,-251"/>
<text text-anchor="middle" x="537" y="-236.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">ground_state_submodule.F90</text>
</a>
</g>
</g>
<!-- sourcefile~ccsd_class.f90&#45;&gt;sourcefile~ground_state_submodule.f90~2 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge31" class="edge"><title>sourcefile~ccsd_class.f90&#45;&gt;sourcefile~ground_state_submodule.f90~2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M361.647,-203.484C391.438,-209.552 432.227,-217.861 466.863,-224.917"/>
<polygon fill="#000000" stroke="#000000" points="466.426,-228.399 476.924,-226.966 467.823,-221.54 466.426,-228.399"/>
</g>
<!-- sourcefile~jacobian_transpose_submodule.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node40" class="node"><title>sourcefile~jacobian_transpose_submodule.f90</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node40"><a xlink:href="../sourcefile/jacobian_transpose_submodule.f90.html" xlink:title="jacobian_transpose_submodule.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="628,-209 446,-209 446,-185 628,-185 628,-209"/>
<text text-anchor="middle" x="537" y="-194.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">jacobian_transpose_submodule.F90</text>
</a>
</g>
</g>
<!-- sourcefile~ccsd_class.f90&#45;&gt;sourcefile~jacobian_transpose_submodule.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge32" class="edge"><title>sourcefile~ccsd_class.f90&#45;&gt;sourcefile~jacobian_transpose_submodule.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M361.647,-195.386C382.751,-195.581 409.374,-195.828 435.419,-196.069"/>
<polygon fill="#000000" stroke="#000000" points="435.714,-199.571 445.746,-196.164 435.779,-192.572 435.714,-199.571"/>
</g>
<!-- sourcefile~omega_submodule.f90~4 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node41" class="node"><title>sourcefile~omega_submodule.f90~4</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node41"><a xlink:href="../sourcefile/omega_submodule.f90%7E4.html" xlink:title="omega_submodule.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="598.5,-167 475.5,-167 475.5,-143 598.5,-143 598.5,-167"/>
<text text-anchor="middle" x="537" y="-152.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">omega_submodule.F90</text>
</a>
</g>
</g>
<!-- sourcefile~ccsd_class.f90&#45;&gt;sourcefile~omega_submodule.f90~4 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge33" class="edge"><title>sourcefile~ccsd_class.f90&#45;&gt;sourcefile~omega_submodule.f90~4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M361.647,-187.288C390.992,-181.853 431.008,-174.443 465.302,-168.092"/>
<polygon fill="#000000" stroke="#000000" points="466.08,-171.508 475.275,-166.245 464.805,-164.625 466.08,-171.508"/>
</g>
<!-- sourcefile~cc3_class.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node42" class="node"><title>sourcefile~cc3_class.f90</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node42"><a xlink:href="../sourcefile/cc3_class.f90.html" xlink:title="cc3_class.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="577,-125 497,-125 497,-101 577,-101 577,-125"/>
<text text-anchor="middle" x="537" y="-110.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">cc3_class.F90</text>
</a>
</g>
</g>
<!-- sourcefile~ccsd_class.f90&#45;&gt;sourcefile~cc3_class.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge34" class="edge"><title>sourcefile~ccsd_class.f90&#45;&gt;sourcefile~cc3_class.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M361.859,-190.644C377.748,-187.642 395.495,-182.569 410,-174 430.592,-161.835 425.408,-146.165 446,-134 458.339,-126.711 473.024,-121.951 486.915,-118.844"/>
<polygon fill="#000000" stroke="#000000" points="487.725,-122.252 496.846,-116.861 486.354,-115.387 487.725,-122.252"/>
</g>
<!-- sourcefile~mlccsd_class.f90&#45;&gt;sourcefile~et_program.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge4" class="edge"><title>sourcefile~mlccsd_class.f90&#45;&gt;sourcefile~et_program.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M801.015,-732.003C815.78,-728.293 831.063,-721.916 842,-711 881.712,-671.364 854.939,-641.149 878,-590 898.565,-544.387 931.644,-495.876 950.85,-469.319"/>
<polygon fill="#000000" stroke="#000000" points="953.717,-471.329 956.794,-461.191 948.066,-467.197 953.717,-471.329"/>
</g>
<!-- sourcefile~jacobian_submodule.f90~2 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node25" class="node"><title>sourcefile~jacobian_submodule.f90~2</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node25"><a xlink:href="../sourcefile/jacobian_submodule.f90%7E2.html" xlink:title="jacobian_submodule.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1032,-875 902,-875 902,-851 1032,-851 1032,-875"/>
<text text-anchor="middle" x="967" y="-860.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">jacobian_submodule.F90</text>
</a>
</g>
</g>
<!-- sourcefile~mlccsd_class.f90&#45;&gt;sourcefile~jacobian_submodule.f90~2 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge1" class="edge"><title>sourcefile~mlccsd_class.f90&#45;&gt;sourcefile~jacobian_submodule.f90~2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M764.625,-749.165C784.562,-771.198 829.925,-817.674 878,-842 882.526,-844.29 887.311,-846.337 892.217,-848.165"/>
<polygon fill="#000000" stroke="#000000" points="891.171,-851.506 901.766,-851.418 893.428,-844.88 891.171,-851.506"/>
</g>
<!-- sourcefile~omega_submodule.f90~2 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node26" class="node"><title>sourcefile~omega_submodule.f90~2</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node26"><a xlink:href="../sourcefile/omega_submodule.f90%7E2.html" xlink:title="omega_submodule.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1028.5,-833 905.5,-833 905.5,-809 1028.5,-809 1028.5,-833"/>
<text text-anchor="middle" x="967" y="-818.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">omega_submodule.F90</text>
</a>
</g>
</g>
<!-- sourcefile~mlccsd_class.f90&#45;&gt;sourcefile~omega_submodule.f90~2 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge2" class="edge"><title>sourcefile~mlccsd_class.f90&#45;&gt;sourcefile~omega_submodule.f90~2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M773.958,-749.006C797.925,-762.977 839.696,-785.924 878,-800 883.998,-802.204 890.313,-804.238 896.692,-806.101"/>
<polygon fill="#000000" stroke="#000000" points="896.161,-809.586 906.732,-808.886 898.032,-802.84 896.161,-809.586"/>
</g>
<!-- sourcefile~ground_state_submodule.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node27" class="node"><title>sourcefile~ground_state_submodule.f90</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node27"><a xlink:href="../sourcefile/ground_state_submodule.f90.html" xlink:title="ground_state_submodule.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1043,-791 891,-791 891,-767 1043,-767 1043,-791"/>
<text text-anchor="middle" x="967" y="-776.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">ground_state_submodule.F90</text>
</a>
</g>
</g>
<!-- sourcefile~mlccsd_class.f90&#45;&gt;sourcefile~ground_state_submodule.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge3" class="edge"><title>sourcefile~mlccsd_class.f90&#45;&gt;sourcefile~ground_state_submodule.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M801.05,-746.321C828.788,-751.817 864.424,-758.876 895.47,-765.027"/>
<polygon fill="#000000" stroke="#000000" points="894.884,-768.479 905.373,-766.989 896.244,-761.612 894.884,-768.479"/>
</g>
<!-- sourcefile~cholesky_submodule.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node28" class="node"><title>sourcefile~cholesky_submodule.f90</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node28"><a xlink:href="../sourcefile/cholesky_submodule.f90.html" xlink:title="cholesky_submodule.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1033,-749 901,-749 901,-725 1033,-725 1033,-749"/>
<text text-anchor="middle" x="967" y="-734.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">cholesky_submodule.F90</text>
</a>
</g>
</g>
<!-- sourcefile~mlccsd_class.f90&#45;&gt;sourcefile~cholesky_submodule.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge5" class="edge"><title>sourcefile~mlccsd_class.f90&#45;&gt;sourcefile~cholesky_submodule.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M801.05,-737C827.463,-737 861.036,-737 890.989,-737"/>
<polygon fill="#000000" stroke="#000000" points="890.993,-740.5 900.993,-737 890.993,-733.5 890.993,-740.5"/>
</g>
<!-- sourcefile~excited_state_submodule.f90~2 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node29" class="node"><title>sourcefile~excited_state_submodule.f90~2</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node29"><a xlink:href="../sourcefile/excited_state_submodule.f90%7E2.html" xlink:title="excited_state_submodule.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1043.5,-707 890.5,-707 890.5,-683 1043.5,-683 1043.5,-707"/>
<text text-anchor="middle" x="967" y="-692.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">excited_state_submodule.F90</text>
</a>
</g>
</g>
<!-- sourcefile~mlccsd_class.f90&#45;&gt;sourcefile~excited_state_submodule.f90~2 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge6" class="edge"><title>sourcefile~mlccsd_class.f90&#45;&gt;sourcefile~excited_state_submodule.f90~2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M801.05,-727.679C828.788,-722.183 864.424,-715.124 895.47,-708.973"/>
<polygon fill="#000000" stroke="#000000" points="896.244,-712.388 905.373,-707.011 894.884,-705.521 896.244,-712.388"/>
</g>
<!-- sourcefile~input_reader_submodule.f90~2 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node30" class="node"><title>sourcefile~input_reader_submodule.f90~2</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node30"><a xlink:href="../sourcefile/input_reader_submodule.f90%7E2.html" xlink:title="input_reader_submodule.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1042,-665 892,-665 892,-641 1042,-641 1042,-665"/>
<text text-anchor="middle" x="967" y="-650.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">input_reader_submodule.F90</text>
</a>
</g>
</g>
<!-- sourcefile~mlccsd_class.f90&#45;&gt;sourcefile~input_reader_submodule.f90~2 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge7" class="edge"><title>sourcefile~mlccsd_class.f90&#45;&gt;sourcefile~input_reader_submodule.f90~2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M801.08,-727.858C814.883,-723.944 829.59,-718.493 842,-711 861.641,-699.141 858.051,-685.334 878,-674 881.435,-672.048 885.046,-670.277 888.763,-668.67"/>
<polygon fill="#000000" stroke="#000000" points="890.134,-671.892 898.185,-665.004 887.596,-665.369 890.134,-671.892"/>
</g>
<!-- sourcefile~orbital_partitioning_submodule.f90~2 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node31" class="node"><title>sourcefile~orbital_partitioning_submodule.f90~2</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node31"><a xlink:href="../sourcefile/orbital_partitioning_submodule.f90%7E2.html" xlink:title="orbital_partitioning_submodule.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1055.5,-623 878.5,-623 878.5,-599 1055.5,-599 1055.5,-623"/>
<text text-anchor="middle" x="967" y="-608.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">orbital_partitioning_submodule.F90</text>
</a>
</g>
</g>
<!-- sourcefile~mlccsd_class.f90&#45;&gt;sourcefile~orbital_partitioning_submodule.f90~2 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge8" class="edge"><title>sourcefile~mlccsd_class.f90&#45;&gt;sourcefile~orbital_partitioning_submodule.f90~2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M801.082,-730.861C815.511,-727.064 830.575,-720.925 842,-711 871.129,-685.696 848.211,-656.523 878,-632 879.592,-630.69 881.251,-629.459 882.968,-628.302"/>
<polygon fill="#000000" stroke="#000000" points="885.053,-631.14 891.974,-623.118 881.561,-625.073 885.053,-631.14"/>
</g>
<!-- sourcefile~cc3_class.f90&#45;&gt;sourcefile~et_program.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge24" class="edge"><title>sourcefile~cc3_class.f90&#45;&gt;sourcefile~et_program.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M754,-449C806.935,-455.906 867.939,-454.986 910.877,-452.892"/>
<polygon fill="#000000" stroke="#000000" points="911.312,-456.374 921.115,-452.354 910.945,-449.384 911.312,-456.374"/>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M577.125,-114.116C594.457,-116.475 614.037,-121.938 628,-134 741.855,-232.358 602.807,-429.537 752,-449"/>
</g>
<!-- sourcefile~omega_submodule.f90~3 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node43" class="node"><title>sourcefile~omega_submodule.f90~3</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node43"><a xlink:href="../sourcefile/omega_submodule.f90%7E3.html" xlink:title="omega_submodule.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="814.5,-125 691.5,-125 691.5,-101 814.5,-101 814.5,-125"/>
<text text-anchor="middle" x="753" y="-110.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">omega_submodule.F90</text>
</a>
</g>
</g>
<!-- sourcefile~cc3_class.f90&#45;&gt;sourcefile~omega_submodule.f90~3 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge23" class="edge"><title>sourcefile~cc3_class.f90&#45;&gt;sourcefile~omega_submodule.f90~3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M577.251,-113C606.244,-113 646.511,-113 681.085,-113"/>
<polygon fill="#000000" stroke="#000000" points="681.141,-116.5 691.141,-113 681.141,-109.5 681.141,-116.5"/>
</g>
<!-- sourcefile~ccsdpt_class.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node44" class="node"><title>sourcefile~ccsdpt_class.f90</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node44"><a xlink:href="../sourcefile/ccsdpt_class.f90.html" xlink:title="ccsdpt_class.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="800,-45 706,-45 706,-21 800,-21 800,-45"/>
<text text-anchor="middle" x="753" y="-30.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">ccsdpt_class.F90</text>
</a>
</g>
</g>
<!-- sourcefile~cc3_class.f90&#45;&gt;sourcefile~ccsdpt_class.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge25" class="edge"><title>sourcefile~cc3_class.f90&#45;&gt;sourcefile~ccsdpt_class.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M570.502,-100.85C607.956,-86.8484 669.585,-63.8093 710.481,-48.5213"/>
<polygon fill="#000000" stroke="#000000" points="711.752,-51.7826 719.893,-45.0025 709.301,-45.2258 711.752,-51.7826"/>
</g>
<!-- sourcefile~ccsdpt_class.f90&#45;&gt;sourcefile~et_program.f90 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge21" class="edge"><title>sourcefile~ccsdpt_class.f90&#45;&gt;sourcefile~et_program.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M800.441,-38.0016C815.338,-41.7039 830.848,-48.0747 842,-59 948.989,-163.811 963.858,-360.459 965.774,-426.626"/>
<polygon fill="#000000" stroke="#000000" points="962.278,-426.834 965.992,-436.756 969.276,-426.683 962.278,-426.834"/>
</g>
<!-- sourcefile~omega_submodule.f90~6 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node45" class="node"><title>sourcefile~omega_submodule.f90~6</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node45"><a xlink:href="../sourcefile/omega_submodule.f90%7E6.html" xlink:title="omega_submodule.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1028.5,-66 905.5,-66 905.5,-42 1028.5,-42 1028.5,-66"/>
<text text-anchor="middle" x="967" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">omega_submodule.F90</text>
</a>
</g>
</g>
<!-- sourcefile~ccsdpt_class.f90&#45;&gt;sourcefile~omega_submodule.f90~6 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge20" class="edge"><title>sourcefile~ccsdpt_class.f90&#45;&gt;sourcefile~omega_submodule.f90~6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M800.001,-37.5567C827.802,-40.3106 863.814,-43.8778 895.187,-46.9855"/>
<polygon fill="#000000" stroke="#000000" points="894.898,-50.4739 905.194,-47.9767 895.588,-43.508 894.898,-50.4739"/>
</g>
<!-- sourcefile~ground_state_submodule.f90~3 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_node46" class="node"><title>sourcefile~ground_state_submodule.f90~3</title>
<g id="a_sourcefile~~hf_class.f90~~AfferentGraph_node46"><a xlink:href="../sourcefile/ground_state_submodule.f90%7E3.html" xlink:title="ground_state_submodule.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1043,-24 891,-24 891,-0 1043,-0 1043,-24"/>
<text text-anchor="middle" x="967" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">ground_state_submodule.F90</text>
</a>
</g>
</g>
<!-- sourcefile~ccsdpt_class.f90&#45;&gt;sourcefile~ground_state_submodule.f90~3 -->
<g id="sourcefile~~hf_class.f90~~AfferentGraph_edge22" class="edge"><title>sourcefile~ccsdpt_class.f90&#45;&gt;sourcefile~ground_state_submodule.f90~3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M800.001,-28.4433C823.645,-26.1012 853.228,-23.1708 880.845,-20.4351"/>
<polygon fill="#000000" stroke="#000000" points="881.31,-23.9063 890.916,-19.4375 880.62,-16.9404 881.31,-23.9063"/>
</g>
</g>
</svg>
</div>
                <script>var pansourcefilehf_classf90AfferentGraph = svgPanZoom('#sourcefilehf_classf90AfferentGraph', {
                    zoomEnabled: true,
                    controlIconsEnabled: true,
                    fit: true,
                    center: true,});
                    </script>
                <div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div>
                <div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog">
                  <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="-graph-help-label">Graph Key</h4>
                      </div>
                      <div class="modal-body">
                        
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.36.0 (20140111.2315)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="188pt" height="32pt"
 viewBox="0.00 0.00 188.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 184,-28 184,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node"><title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="66,-24 0,-24 0,-0 66,-0 66,-24"/>
<text text-anchor="middle" x="33" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node"><title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="180,-24 84,-24 84,-0 180,-0 180,-24"/>
<text text-anchor="middle" x="132" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which depends upon it. A file 
    is dependent upon another if the latter must be compiled before the former
    can be.
    </p>
    
                      </div>
                    </div>
                  </div>
                </div>
                
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      






<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/hf_class.html">hf_class</a>
      
    </div>
  </div>
</div>















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/hf_class.f90.html#src">hf_class.F90</a>
  </div>
</div>


    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="k">module </span><span class="n">hf_class</span>
<a name="ln-2"></a><span class="c">!</span>
<a name="ln-3"></a><span class="c">!!</span>
<a name="ln-4"></a><span class="c">!!                      Hartree-Fock (HF) class module                                 </span>
<a name="ln-5"></a><span class="c">!!        Written by Sarai D. Folkestad and Eirik F. KjÃ¸nstad, Apr 2017         </span>
<a name="ln-6"></a><span class="c">!!                       </span>
<a name="ln-7"></a><span class="c">!                                                    </span>
<a name="ln-8"></a><span class="c">!  :::::::::::::::::::::::::::::::::::</span>
<a name="ln-9"></a><span class="c">!  -::- Modules used by the class -::-</span>
<a name="ln-10"></a><span class="c">!  :::::::::::::::::::::::::::::::::::</span>
<a name="ln-11"></a><span class="c">!</span>
<a name="ln-12"></a><span class="c">!  General tools</span>
<a name="ln-13"></a><span class="c">!</span>
<a name="ln-14"></a>   <span class="k">use </span><span class="n">types</span>
<a name="ln-15"></a>   <span class="k">use </span><span class="n">utils</span>
<a name="ln-16"></a>   <span class="k">use </span><span class="n">workspace</span>
<a name="ln-17"></a>   <span class="k">use </span><span class="n">input_output</span>
<a name="ln-18"></a>   <span class="k">use </span><span class="n">calc_tasks_class</span>
<a name="ln-19"></a>   <span class="k">use </span><span class="n">calc_settings_class</span>
<a name="ln-20"></a>   <span class="k">use </span><span class="n">ground_state_specs_class</span>
<a name="ln-21"></a>   <span class="k">use </span><span class="n">excited_state_specs_class</span>
<a name="ln-22"></a>   <span class="k">use </span><span class="n">core_excited_state_specs_class</span>
<a name="ln-23"></a>   <span class="k">use </span><span class="n">response_calc_specs_class</span>
<a name="ln-24"></a>   <span class="k">use </span><span class="n">memory_manager_class</span>
<a name="ln-25"></a><span class="c">!</span>
<a name="ln-26"></a>   <span class="k">implicit none</span>
<a name="ln-27"></a><span class="c">!</span>
<a name="ln-28"></a><span class="c">!  ::::::::::::::::::::::::::::::::::::</span>
<a name="ln-29"></a><span class="c">!  -::- Definition of the HF class -::-</span>
<a name="ln-30"></a><span class="c">!  ::::::::::::::::::::::::::::::::::::</span>
<a name="ln-31"></a><span class="c">!   </span>
<a name="ln-32"></a>   <span class="k">type</span> <span class="kd">::</span> <span class="n">hf</span>
<a name="ln-33"></a><span class="c">!</span>
<a name="ln-34"></a><span class="c">!     Model name </span>
<a name="ln-35"></a><span class="c">!</span>
<a name="ln-36"></a>      <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;HF&#39;</span>
<a name="ln-37"></a><span class="c">!</span>
<a name="ln-38"></a><span class="c">!     Orbital information variables</span>
<a name="ln-39"></a><span class="c">!</span>
<a name="ln-40"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n_o</span>  <span class="c">! Number of occupied orbitals</span>
<a name="ln-41"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n_v</span>  <span class="c">! Number of virtual orbitals</span>
<a name="ln-42"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n_ao</span> <span class="c">! Number of atomic orbitals (AOs)</span>
<a name="ln-43"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n_mo</span> <span class="c">! Number of molecular orbitals (MOs)</span>
<a name="ln-44"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n_J</span>  <span class="c">! Number of Cholesky vectors</span>
<a name="ln-45"></a><span class="c">!</span>
<a name="ln-46"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">mo_coef</span> <span class="c">! MO coefficient matrix</span>
<a name="ln-47"></a><span class="c">!</span>
<a name="ln-48"></a><span class="c">!     Fock matrix variables</span>
<a name="ln-49"></a><span class="c">!</span>
<a name="ln-50"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">fock_diagonal</span>  <span class="c">! diagonal vector</span>
<a name="ln-51"></a><span class="c">!</span>
<a name="ln-52"></a><span class="c">!     Energy variables</span>
<a name="ln-53"></a><span class="c">!</span>
<a name="ln-54"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">energy</span>            <span class="c">! Same as scf_energy for HF class, different for descendants</span>
<a name="ln-55"></a><span class="c">!</span>
<a name="ln-56"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nuclear_potential</span> <span class="c">! Nuclear potential energy term</span>
<a name="ln-57"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scf_energy</span>        <span class="c">! The Hartree-Fock (HF/SCF) energy</span>
<a name="ln-58"></a><span class="c">!</span>
<a name="ln-59"></a><span class="c">!     Calculation settings, tasks, and implemented methods</span>
<a name="ln-60"></a><span class="c">!</span>
<a name="ln-61"></a>      <span class="k">type</span><span class="p">(</span><span class="n">calc_settings</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">settings</span>
<a name="ln-62"></a><span class="c">!</span>
<a name="ln-63"></a>      <span class="k">type</span><span class="p">(</span><span class="n">calc_tasks</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tasks</span>
<a name="ln-64"></a>      <span class="k">type</span><span class="p">(</span><span class="n">calc_tasks</span><span class="p">)</span> <span class="kd">::</span> <span class="n">implemented</span>
<a name="ln-65"></a><span class="c">!</span>
<a name="ln-66"></a>      <span class="k">type</span><span class="p">(</span><span class="n">ground_state_specs</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">ground_state_specifications</span>
<a name="ln-67"></a>      <span class="k">type</span><span class="p">(</span><span class="n">excited_state_specs</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">excited_state_specifications</span>
<a name="ln-68"></a>      <span class="k">type</span><span class="p">(</span><span class="n">core_excited_state_specs</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">core_excited_state_specifications</span>
<a name="ln-69"></a>      <span class="k">type</span><span class="p">(</span><span class="n">response_calc_specs</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">response_specifications</span>
<a name="ln-70"></a><span class="c">!</span>
<a name="ln-71"></a><span class="c">!     Memory manager </span>
<a name="ln-72"></a><span class="c">!</span>
<a name="ln-73"></a>      <span class="k">type</span><span class="p">(</span><span class="n">memory_manager</span><span class="p">)</span> <span class="kd">::</span> <span class="n">mem</span> 
<a name="ln-74"></a><span class="c">!</span>
<a name="ln-75"></a>   <span class="k">contains</span>
<a name="ln-76"></a><span class="c">!</span>
<a name="ln-77"></a><span class="c">!     Initialization and driver routines</span>
<a name="ln-78"></a><span class="c">!</span>
<a name="ln-79"></a>      <span class="k">procedure</span> <span class="kd">::</span> <span class="n">init</span> <span class="o">=&gt;</span> <span class="n">init_hf</span>
<a name="ln-80"></a>      <span class="k">procedure</span> <span class="kd">::</span> <span class="n">drv</span>  <span class="o">=&gt;</span> <span class="n">drv_hf</span>
<a name="ln-81"></a><span class="c">!</span>
<a name="ln-82"></a><span class="c">!     Routines to read MO Cholesky vectors from file</span>
<a name="ln-83"></a><span class="c">!</span>
<a name="ln-84"></a>      <span class="k">procedure</span><span class="p">,</span> <span class="k">non_overridable</span> <span class="kd">::</span> <span class="n">read_cholesky_ij</span> <span class="o">=&gt;</span> <span class="n">read_cholesky_ij_hf</span> <span class="c">! occ-occ</span>
<a name="ln-85"></a>      <span class="k">procedure</span><span class="p">,</span> <span class="k">non_overridable</span> <span class="kd">::</span> <span class="n">read_cholesky_ia</span> <span class="o">=&gt;</span> <span class="n">read_cholesky_ia_hf</span> <span class="c">! occ-vir</span>
<a name="ln-86"></a>      <span class="k">procedure</span><span class="p">,</span> <span class="k">non_overridable</span> <span class="kd">::</span> <span class="n">read_cholesky_ai</span> <span class="o">=&gt;</span> <span class="n">read_cholesky_ai_hf</span> <span class="c">! vir-occ</span>
<a name="ln-87"></a>      <span class="k">procedure</span><span class="p">,</span> <span class="k">non_overridable</span> <span class="kd">::</span> <span class="n">read_cholesky_ab</span> <span class="o">=&gt;</span> <span class="n">read_cholesky_ab_hf</span> <span class="c">! vir-vir</span>
<a name="ln-88"></a><span class="c">!</span>
<a name="ln-89"></a><span class="c">!     Routines needed to initialize HF     </span>
<a name="ln-90"></a><span class="c">!</span>
<a name="ln-91"></a><span class="c">!     read_info                      : sets variables from file (n_o, n_v, scf_energy,...)</span>
<a name="ln-92"></a><span class="c">!     cholesky_density_decomposition : orbital localization routine</span>
<a name="ln-93"></a><span class="c">!     read_transform_cholesky        : reads AO Cholesky vectors, transforms to MO, and saves to file</span>
<a name="ln-94"></a><span class="c">!</span>
<a name="ln-95"></a>      <span class="k">procedure</span><span class="p">,</span> <span class="k">non_overridable</span> <span class="kd">::</span> <span class="n">read_hf_info</span>                <span class="o">=&gt;</span> <span class="n">read_hf_info_hf</span>
<a name="ln-96"></a>      <span class="k">procedure</span><span class="p">,</span> <span class="k">non_overridable</span> <span class="kd">::</span> <span class="n">read_transform_cholesky</span>     <span class="o">=&gt;</span> <span class="n">read_transform_cholesky_hf</span>
<a name="ln-97"></a>      <span class="k">procedure</span><span class="p">,</span> <span class="k">non_overridable</span> <span class="kd">::</span> <span class="n">construct_ao_fock</span>           <span class="o">=&gt;</span> <span class="n">construct_ao_fock_hf</span> 
<a name="ln-98"></a>      <span class="k">procedure</span><span class="p">,</span> <span class="k">non_overridable</span> <span class="kd">::</span> <span class="n">construct_ao_fock_new</span>       <span class="o">=&gt;</span> <span class="n">construct_ao_fock_new_hf</span> 
<a name="ln-99"></a>      <span class="k">procedure</span><span class="p">,</span> <span class="k">non_overridable</span> <span class="kd">::</span> <span class="n">construct_density_matrices</span>  <span class="o">=&gt;</span> <span class="n">construct_density_matrices_hf</span>
<a name="ln-100"></a>      <span class="k">procedure</span><span class="p">,</span> <span class="k">non_overridable</span> <span class="kd">::</span> <span class="n">construct_density_matrix</span>    <span class="o">=&gt;</span> <span class="n">construct_density_matrix_hf</span>
<a name="ln-101"></a>      <span class="k">procedure</span><span class="p">,</span> <span class="k">non_overridable</span> <span class="kd">::</span> <span class="n">construct_density_matrix_v</span>  <span class="o">=&gt;</span> <span class="n">construct_density_matrix_v_hf</span>
<a name="ln-102"></a><span class="c">!</span>
<a name="ln-103"></a>   <span class="k">end type </span><span class="n">hf</span>
<a name="ln-104"></a><span class="c">!</span>
<a name="ln-105"></a><span class="c">!</span>
<a name="ln-106"></a><span class="k">contains</span> 
<a name="ln-107"></a><span class="c">!</span>
<a name="ln-108"></a><span class="c">!  ::::::::::::::::::::::::::::::::::::::::::::</span>
<a name="ln-109"></a><span class="c">!  -::- Initialization and driver routines -::-</span>
<a name="ln-110"></a><span class="c">!  ::::::::::::::::::::::::::::::::::::::::::::</span>
<a name="ln-111"></a><span class="c">! </span>
<a name="ln-112"></a>   <span class="k">subroutine </span><span class="n">init_hf</span><span class="p">(</span><span class="n">wf</span><span class="p">)</span>
<a name="ln-113"></a><span class="c">!!</span>
<a name="ln-114"></a><span class="c">!!    Initialization of Hartree-Fock object</span>
<a name="ln-115"></a><span class="c">!!    Written by Sarai D. Folkestad and Eirik F. KjÃ¸nstad, Apr 2017</span>
<a name="ln-116"></a><span class="c">!!</span>
<a name="ln-117"></a><span class="c">!!    Performs the following tasks:</span>
<a name="ln-118"></a><span class="c">!!</span>
<a name="ln-119"></a><span class="c">!!    1. Sets HF orbital and energy information by reading from file</span>
<a name="ln-120"></a><span class="c">!!    2. Transforms AO Cholesky vectors to MO basis and saves to file</span>
<a name="ln-121"></a><span class="c">!!</span>
<a name="ln-122"></a>      <span class="k">implicit none</span>
<a name="ln-123"></a><span class="c">!</span>
<a name="ln-124"></a>      <span class="k">class</span><span class="p">(</span><span class="n">hf</span><span class="p">)</span> <span class="kd">::</span> <span class="n">wf</span>
<a name="ln-125"></a><span class="c">!</span>
<a name="ln-126"></a><span class="c">!     Initialize HF variables</span>
<a name="ln-127"></a><span class="c">!</span>
<a name="ln-128"></a>      <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">read_hf_info</span>        
<a name="ln-129"></a><span class="c">!</span>
<a name="ln-130"></a><span class="c">!     Initialize Cholesky vectors</span>
<a name="ln-131"></a><span class="c">!     </span>
<a name="ln-132"></a>      <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">read_transform_cholesky</span>
<a name="ln-133"></a><span class="c">!</span>
<a name="ln-134"></a>   <span class="k">end subroutine </span><span class="n">init_hf</span>
<a name="ln-135"></a><span class="c">!</span>
<a name="ln-136"></a><span class="c">!</span>
<a name="ln-137"></a>   <span class="k">subroutine </span><span class="n">drv_hf</span><span class="p">(</span><span class="n">wf</span><span class="p">)</span>
<a name="ln-138"></a><span class="c">!!</span>
<a name="ln-139"></a><span class="c">!!    Driver (HF)</span>
<a name="ln-140"></a><span class="c">!!    Written by Sarai D. Folkestad and Eirik F. KjÃ¸nstad, Apr 2017</span>
<a name="ln-141"></a><span class="c">!!</span>
<a name="ln-142"></a><span class="c">!!    Lets the user know there is no driver for Hartree-Fock and exits</span>
<a name="ln-143"></a><span class="c">!!    the program if called. The module reads Hartree-Fock information </span>
<a name="ln-144"></a><span class="c">!!    from files and contains no independent solver.</span>
<a name="ln-145"></a><span class="c">!!</span>
<a name="ln-146"></a>      <span class="k">implicit none</span> 
<a name="ln-147"></a><span class="c">!</span>
<a name="ln-148"></a>      <span class="k">class</span><span class="p">(</span><span class="n">hf</span><span class="p">)</span> <span class="kd">::</span> <span class="n">wf</span>
<a name="ln-149"></a><span class="c">!</span>
<a name="ln-150"></a>      <span class="k">write</span><span class="p">(</span><span class="n">unit_output</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Error: There is no driver for the Hartree-Fock class.&#39;</span>
<a name="ln-151"></a>      <span class="k">stop</span>
<a name="ln-152"></a><span class="c">!</span>
<a name="ln-153"></a>   <span class="k">end subroutine </span><span class="n">drv_hf</span>
<a name="ln-154"></a><span class="c">!</span>
<a name="ln-155"></a><span class="c">!  :::::::::::::::::::::::::::::::::::::::::</span>
<a name="ln-156"></a><span class="c">!  -::- Class subroutines and functions -::-</span>
<a name="ln-157"></a><span class="c">!  :::::::::::::::::::::::::::::::::::::::::</span>
<a name="ln-158"></a><span class="c">!</span>
<a name="ln-159"></a>   <span class="k">subroutine </span><span class="n">read_hf_info_hf</span><span class="p">(</span><span class="n">wf</span><span class="p">)</span>
<a name="ln-160"></a><span class="c">!!</span>
<a name="ln-161"></a><span class="c">!!    Read HF Info</span>
<a name="ln-162"></a><span class="c">!!    Written by Sarai D. Folkestad and Eirik F. KjÃ¸nstad, Apr 2017</span>
<a name="ln-163"></a><span class="c">!!</span>
<a name="ln-164"></a><span class="c">!!    Reads the file mlcc_hf_info and sets the following HF variables: </span>
<a name="ln-165"></a><span class="c">!!    n_o, n_v, n_mo, orbital_coef, and the fock_diagonal.</span>
<a name="ln-166"></a><span class="c">!!</span>
<a name="ln-167"></a><span class="c">!!    The file mlcc_hf_info is written in the mlcc_write_sirifc </span>
<a name="ln-168"></a><span class="c">!!    subroutine, which is called from the wr_sirifc subroutine in</span>
<a name="ln-169"></a><span class="c">!!    the siropt module of the DALTON suite.</span>
<a name="ln-170"></a><span class="c">!!</span>
<a name="ln-171"></a>      <span class="k">implicit none</span>
<a name="ln-172"></a><span class="c">!</span>
<a name="ln-173"></a>      <span class="k">class</span><span class="p">(</span><span class="n">hf</span><span class="p">)</span> <span class="kd">::</span> <span class="n">wf</span>
<a name="ln-174"></a><span class="c">!</span>
<a name="ln-175"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">unit_hf</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c">! Unit identifier for mlcc_hf_info file</span>
<a name="ln-176"></a><span class="c">!</span>
<a name="ln-177"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n_lambda</span> <span class="o">=</span> <span class="mi">0</span> <span class="c">! n_ao * n_mo, read but discarded</span>
<a name="ln-178"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-179"></a><span class="c">!</span>
<a name="ln-180"></a><span class="c">!     Open the file mlcc_hf_info</span>
<a name="ln-181"></a><span class="c">!</span>
<a name="ln-182"></a>      <span class="k">call </span><span class="n">generate_unit_identifier</span><span class="p">(</span><span class="n">unit_hf</span><span class="p">)</span>
<a name="ln-183"></a>      <span class="k">open</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">unit_hf</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;MLCC_HF_INFO&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;formatted&#39;</span><span class="p">)</span>
<a name="ln-184"></a>      <span class="k">rewind</span><span class="p">(</span><span class="n">unit_hf</span><span class="p">)</span>
<a name="ln-185"></a><span class="c">!</span>
<a name="ln-186"></a><span class="c">!     Read mlcc_hf_info into HF variables</span>
<a name="ln-187"></a><span class="c">!  </span>
<a name="ln-188"></a>      <span class="k">read</span><span class="p">(</span><span class="n">unit_hf</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_mo</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_o</span><span class="p">,</span> <span class="n">n_lambda</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-189"></a>                        <span class="n">wf</span><span class="p">%</span><span class="n">nuclear_potential</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">scf_energy</span>
<a name="ln-190"></a><span class="c">!</span>
<a name="ln-191"></a><span class="c">!     Set the energy equal to the read SCF energy</span>
<a name="ln-192"></a><span class="c">!</span>
<a name="ln-193"></a>      <span class="n">wf</span><span class="p">%</span><span class="n">energy</span> <span class="o">=</span> <span class="n">wf</span><span class="p">%</span><span class="n">scf_energy</span>
<a name="ln-194"></a><span class="c">!</span>
<a name="ln-195"></a><span class="c">!     Calculate the number of virtuals</span>
<a name="ln-196"></a><span class="c">!</span>
<a name="ln-197"></a>      <span class="n">wf</span><span class="p">%</span><span class="n">n_v</span> <span class="o">=</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_mo</span> <span class="o">-</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_o</span>
<a name="ln-198"></a><span class="c">!      </span>
<a name="ln-199"></a><span class="c">!     Allocate the Fock diagonal and the MO coefficients</span>
<a name="ln-200"></a><span class="c">!</span>
<a name="ln-201"></a>      <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">alloc</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">fock_diagonal</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_mo</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-202"></a>      <span class="n">wf</span><span class="p">%</span><span class="n">fock_diagonal</span> <span class="o">=</span> <span class="n">zero</span>
<a name="ln-203"></a><span class="c">!</span>
<a name="ln-204"></a>      <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">alloc</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">mo_coef</span><span class="p">,</span> <span class="n">n_lambda</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-205"></a>      <span class="n">wf</span><span class="p">%</span><span class="n">mo_coef</span> <span class="o">=</span> <span class="n">zero</span>
<a name="ln-206"></a><span class="c">!</span>
<a name="ln-207"></a><span class="c">!     Read in the Fock diagonal and MO coefficients</span>
<a name="ln-208"></a><span class="c">!</span>
<a name="ln-209"></a>      <span class="k">read</span><span class="p">(</span><span class="n">unit_hf</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">fock_diagonal</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_mo</span><span class="p">)</span>
<a name="ln-210"></a>      <span class="k">read</span><span class="p">(</span><span class="n">unit_hf</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">mo_coef</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_lambda</span><span class="p">)</span> 
<a name="ln-211"></a>      <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span> <span class="o">=</span> <span class="n">n_lambda</span><span class="o">/</span><span class="n">wf</span><span class="p">%</span><span class="n">n_mo</span>
<a name="ln-212"></a><span class="c">!</span>
<a name="ln-213"></a><span class="c">!     Close the mlcc_hf_info file</span>
<a name="ln-214"></a><span class="c">!    </span>
<a name="ln-215"></a>      <span class="k">close</span><span class="p">(</span><span class="n">unit_hf</span><span class="p">)</span>
<a name="ln-216"></a><span class="c">!</span>
<a name="ln-217"></a>   <span class="k">end subroutine </span><span class="n">read_hf_info_hf</span>
<a name="ln-218"></a><span class="c">!</span>
<a name="ln-219"></a><span class="c">!</span>
<a name="ln-220"></a>   <span class="k">subroutine </span><span class="n">read_transform_cholesky_hf</span><span class="p">(</span><span class="n">wf</span><span class="p">)</span>
<a name="ln-221"></a><span class="c">!!</span>
<a name="ln-222"></a><span class="c">!!    Read and Transform Cholesky</span>
<a name="ln-223"></a><span class="c">!!    Written by Sarai D. Folkestad and Eirik F. KjÃ¸nstad, 20 Apr 2017</span>
<a name="ln-224"></a><span class="c">!!</span>
<a name="ln-225"></a><span class="c">!!    Reads the AO Cholesky vectors from file, transforms the vectors </span>
<a name="ln-226"></a><span class="c">!!    to the MO basis, and saves the MO vectors to file</span>
<a name="ln-227"></a><span class="c">!!</span>
<a name="ln-228"></a>      <span class="k">implicit none</span>
<a name="ln-229"></a><span class="c">!</span>
<a name="ln-230"></a>      <span class="k">class</span><span class="p">(</span><span class="n">hf</span><span class="p">)</span> <span class="kd">::</span> <span class="n">wf</span>
<a name="ln-231"></a><span class="c">!</span>
<a name="ln-232"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">unit_chol_ao</span>    <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c">! Unit identifier for mlcc_cholesky file</span>
<a name="ln-233"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">unit_chol_mo_ij</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c">! cholesky_ij file</span>
<a name="ln-234"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">unit_chol_mo_ia</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c">! cholesky_ia file</span>
<a name="ln-235"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">unit_chol_mo_ab</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c">! cholesky_ab file</span>
<a name="ln-236"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">unit_chol_mo_ij_direct</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c">! cholesky_ij direct access file</span>
<a name="ln-237"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">unit_chol_mo_ia_direct</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c">! cholesky_ia direct access file</span>
<a name="ln-238"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">unit_chol_mo_ab_direct</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c">! cholesky_ab direct access file</span>
<a name="ln-239"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ioerror</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-240"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">throw_away_index</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-241"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">throw_away</span>
<a name="ln-242"></a><span class="c">!</span>
<a name="ln-243"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n_ao_sq_packed</span> <span class="o">=</span> <span class="mi">0</span> <span class="c">! Packed dimensionality of (n_ao x n_ao) matrix</span>
<a name="ln-244"></a><span class="c">!</span>
<a name="ln-245"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">chol_ao</span>    <span class="c">! Packed AO Cholesky vector</span>
<a name="ln-246"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">chol_ao_sq</span> <span class="c">! Unpacked AO Cholesky vector</span>
<a name="ln-247"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">chol_mo_sq</span> <span class="c">! Unpacked MO Cholesky vector</span>
<a name="ln-248"></a><span class="c">!</span>
<a name="ln-249"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">X</span> <span class="c">! An intermediate matrix</span>
<a name="ln-250"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">L_ij_J</span>
<a name="ln-251"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">L_ia_J</span>
<a name="ln-252"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">L_ab_J</span> 
<a name="ln-253"></a><span class="c">!</span>
<a name="ln-254"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">ij</span><span class="p">,</span><span class="n">ia</span><span class="p">,</span> <span class="n">ab</span>
<a name="ln-255"></a><span class="c">!</span>
<a name="ln-256"></a><span class="c">!     Timing variables </span>
<a name="ln-257"></a><span class="c">!</span>
<a name="ln-258"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">begin_timer</span><span class="p">,</span> <span class="n">end_timer</span> 
<a name="ln-259"></a><span class="c">!</span>
<a name="ln-260"></a><span class="c">!     Batching variables</span>
<a name="ln-261"></a><span class="c">!</span>
<a name="ln-262"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">b_batch</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">b_first</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">b_last</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">b_length</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-263"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">required</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">available</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n_batch</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">batch_dimension</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-264"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">max_batch_length</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-265"></a><span class="c">!</span>
<a name="ln-266"></a>      <span class="k">call </span><span class="nb">cpu_time</span><span class="p">(</span><span class="n">begin_timer</span><span class="p">)</span>
<a name="ln-267"></a><span class="c">!</span>
<a name="ln-268"></a><span class="c">!     Open Dalton file mlcc_cholesky (see mlcc_write_cholesky.F)</span>
<a name="ln-269"></a><span class="c">! </span>
<a name="ln-270"></a>      <span class="k">call </span><span class="n">generate_unit_identifier</span><span class="p">(</span><span class="n">unit_chol_ao</span><span class="p">)</span>
<a name="ln-271"></a>      <span class="k">open</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">unit_chol_ao</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;MLCC_CHOLESKY&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;formatted&#39;</span><span class="p">,</span> <span class="n">iostat</span> <span class="o">=</span> <span class="n">ioerror</span><span class="p">)</span>
<a name="ln-272"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ioerror</span> <span class="p">.</span><span class="n">ne</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-273"></a><span class="k">         write</span><span class="p">(</span><span class="n">unit_output</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;Erorr while opening file mlcc_cholesky. Error code&#39;</span><span class="p">,</span> <span class="n">ioerror</span>
<a name="ln-274"></a>         <span class="nb">flush</span><span class="p">(</span><span class="n">unit_output</span><span class="p">)</span>
<a name="ln-275"></a>      <span class="n">endif</span>
<a name="ln-276"></a>      <span class="k">rewind</span><span class="p">(</span><span class="n">unit_chol_ao</span><span class="p">)</span>
<a name="ln-277"></a><span class="c">!</span>
<a name="ln-278"></a><span class="c">!     Read the number of Cholesky vectors (n_J) and </span>
<a name="ln-279"></a><span class="c">!     the number of atomic orbitals (n_ao)</span>
<a name="ln-280"></a><span class="c">!</span>
<a name="ln-281"></a>      <span class="k">read</span><span class="p">(</span><span class="n">unit_chol_ao</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_J</span>
<a name="ln-282"></a><span class="c">!</span>
<a name="ln-283"></a><span class="c">!     Open files for MO Cholesky vectors </span>
<a name="ln-284"></a><span class="c">! </span>
<a name="ln-285"></a>      <span class="k">call </span><span class="n">generate_unit_identifier</span><span class="p">(</span><span class="n">unit_chol_mo_ij</span><span class="p">)</span>
<a name="ln-286"></a>      <span class="k">call </span><span class="n">generate_unit_identifier</span><span class="p">(</span><span class="n">unit_chol_mo_ia</span><span class="p">)</span>
<a name="ln-287"></a>      <span class="k">call </span><span class="n">generate_unit_identifier</span><span class="p">(</span><span class="n">unit_chol_mo_ab</span><span class="p">)</span>
<a name="ln-288"></a><span class="c">!</span>
<a name="ln-289"></a>      <span class="k">open</span><span class="p">(</span><span class="n">unit_chol_mo_ij</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;cholesky_ij&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;unformatted&#39;</span><span class="p">)</span>
<a name="ln-290"></a>      <span class="k">rewind</span><span class="p">(</span><span class="n">unit_chol_mo_ij</span><span class="p">)</span>
<a name="ln-291"></a><span class="c">!</span>
<a name="ln-292"></a>      <span class="k">open</span><span class="p">(</span><span class="n">unit_chol_mo_ia</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;cholesky_ia&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;unformatted&#39;</span><span class="p">)</span>
<a name="ln-293"></a>      <span class="k">rewind</span><span class="p">(</span><span class="n">unit_chol_mo_ia</span><span class="p">)</span>
<a name="ln-294"></a><span class="c">!</span>
<a name="ln-295"></a>      <span class="k">open</span><span class="p">(</span><span class="n">unit_chol_mo_ab</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;cholesky_ab&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;unformatted&#39;</span><span class="p">)</span>
<a name="ln-296"></a>      <span class="k">rewind</span><span class="p">(</span><span class="n">unit_chol_mo_ab</span><span class="p">)</span>
<a name="ln-297"></a><span class="c">!</span>
<a name="ln-298"></a><span class="c">!     Allocate packed and unpacked Cholesky AO, and </span>
<a name="ln-299"></a><span class="c">!     unpacked Cholesky MO vectors</span>
<a name="ln-300"></a><span class="c">!</span>
<a name="ln-301"></a>      <span class="n">n_ao_sq_packed</span> <span class="o">=</span> <span class="n">packed_size</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">)</span>
<a name="ln-302"></a><span class="c">!</span>
<a name="ln-303"></a>      <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">alloc</span><span class="p">(</span><span class="n">chol_ao</span><span class="p">,</span> <span class="n">n_ao_sq_packed</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-304"></a>      <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">alloc</span><span class="p">(</span><span class="n">chol_ao_sq</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">)</span> 
<a name="ln-305"></a>      <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">alloc</span><span class="p">(</span><span class="n">chol_mo_sq</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_mo</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_mo</span><span class="p">)</span>
<a name="ln-306"></a><span class="c">!</span>
<a name="ln-307"></a>      <span class="n">chol_ao</span>    <span class="o">=</span> <span class="n">zero</span>
<a name="ln-308"></a>      <span class="n">chol_ao_sq</span> <span class="o">=</span> <span class="n">zero</span>
<a name="ln-309"></a>      <span class="n">chol_mo_sq</span> <span class="o">=</span> <span class="n">zero</span>
<a name="ln-310"></a><span class="c">!</span>
<a name="ln-311"></a><span class="c">!     Allocate an intermediate, X</span>
<a name="ln-312"></a><span class="c">!</span>
<a name="ln-313"></a>      <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">alloc</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_mo</span><span class="p">)</span>
<a name="ln-314"></a><span class="c">!</span>
<a name="ln-315"></a>      <span class="n">X</span> <span class="o">=</span> <span class="n">zero</span>
<a name="ln-316"></a><span class="c">!</span>
<a name="ln-317"></a><span class="c">!     Loop over the number of Cholesky vectors,</span>
<a name="ln-318"></a><span class="c">!     reading them one by one </span>
<a name="ln-319"></a><span class="c">!</span>
<a name="ln-320"></a>      <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_J</span>
<a name="ln-321"></a><span class="c">!</span>
<a name="ln-322"></a><span class="c">!        Read Cholesky AO vector</span>
<a name="ln-323"></a><span class="c">!</span>
<a name="ln-324"></a>         <span class="k">read</span><span class="p">(</span><span class="n">unit_chol_ao</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">chol_ao</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_ao_sq_packed</span><span class="p">)</span>
<a name="ln-325"></a><span class="c">!</span>
<a name="ln-326"></a><span class="c">!        Unpack/square up AO vector </span>
<a name="ln-327"></a><span class="c">!</span>
<a name="ln-328"></a>         <span class="k">call </span><span class="n">squareup</span><span class="p">(</span><span class="n">chol_ao</span><span class="p">,</span> <span class="n">chol_ao_sq</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">)</span>
<a name="ln-329"></a><span class="c">!</span>
<a name="ln-330"></a><span class="c">!        Transform the AO vectors to form the Cholesky MO vectors</span>
<a name="ln-331"></a><span class="c">!</span>
<a name="ln-332"></a>         <span class="k">call </span><span class="n">dgemm</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span>     <span class="p">&amp;</span>
<a name="ln-333"></a>                     <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span>    <span class="p">&amp;</span>
<a name="ln-334"></a>                     <span class="n">wf</span><span class="p">%</span><span class="n">n_mo</span><span class="p">,</span>    <span class="p">&amp;</span>
<a name="ln-335"></a>                     <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span>    <span class="p">&amp;</span>
<a name="ln-336"></a>                     <span class="n">one</span><span class="p">,</span>        <span class="p">&amp;</span>
<a name="ln-337"></a>                     <span class="n">chol_ao_sq</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-338"></a>                     <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span>    <span class="p">&amp;</span>
<a name="ln-339"></a>                     <span class="n">wf</span><span class="p">%</span><span class="n">mo_coef</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-340"></a>                     <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span>    <span class="p">&amp;</span>
<a name="ln-341"></a>                     <span class="n">zero</span><span class="p">,</span>       <span class="p">&amp;</span>
<a name="ln-342"></a>                     <span class="n">X</span><span class="p">,</span>          <span class="p">&amp;</span>
<a name="ln-343"></a>                     <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">)</span>
<a name="ln-344"></a><span class="c">!</span>
<a name="ln-345"></a>         <span class="k">call </span><span class="n">dgemm</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span>     <span class="p">&amp;</span>
<a name="ln-346"></a>                     <span class="n">wf</span><span class="p">%</span><span class="n">n_mo</span><span class="p">,</span>    <span class="p">&amp;</span>
<a name="ln-347"></a>                     <span class="n">wf</span><span class="p">%</span><span class="n">n_mo</span><span class="p">,</span>    <span class="p">&amp;</span>
<a name="ln-348"></a>                     <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span>    <span class="p">&amp;</span>
<a name="ln-349"></a>                     <span class="n">one</span><span class="p">,</span>        <span class="p">&amp;</span>
<a name="ln-350"></a>                     <span class="n">wf</span><span class="p">%</span><span class="n">mo_coef</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-351"></a>                     <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span>    <span class="p">&amp;</span>
<a name="ln-352"></a>                     <span class="n">X</span><span class="p">,</span>          <span class="p">&amp;</span>
<a name="ln-353"></a>                     <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span>    <span class="p">&amp;</span>
<a name="ln-354"></a>                     <span class="n">zero</span><span class="p">,</span>       <span class="p">&amp;</span>
<a name="ln-355"></a>                     <span class="n">chol_mo_sq</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-356"></a>                     <span class="n">wf</span><span class="p">%</span><span class="n">n_mo</span><span class="p">)</span>
<a name="ln-357"></a><span class="c">!</span>
<a name="ln-358"></a><span class="c">!        Write the MO vectors to files in blocks</span>
<a name="ln-359"></a><span class="c">!</span>
<a name="ln-360"></a>         <span class="k">write</span><span class="p">(</span><span class="n">unit_chol_mo_ij</span><span class="p">)</span> <span class="p">((</span><span class="n">chol_mo_sq</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">),</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_o</span><span class="p">)</span>
<a name="ln-361"></a>         <span class="k">write</span><span class="p">(</span><span class="n">unit_chol_mo_ia</span><span class="p">)</span> <span class="p">((</span><span class="n">chol_mo_sq</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">a</span><span class="p">),</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_o</span><span class="p">),</span> <span class="n">a</span> <span class="o">=</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_o</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_mo</span><span class="p">)</span>
<a name="ln-362"></a>         <span class="k">write</span><span class="p">(</span><span class="n">unit_chol_mo_ab</span><span class="p">)</span> <span class="p">((</span><span class="n">chol_mo_sq</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">),</span> <span class="n">b</span> <span class="o">=</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_o</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="p">),</span> <span class="n">a</span> <span class="o">=</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_o</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_mo</span><span class="p">)</span>
<a name="ln-363"></a><span class="c">!</span>
<a name="ln-364"></a>      <span class="n">enddo</span>
<a name="ln-365"></a><span class="c">!</span>
<a name="ln-366"></a><span class="c">!     Close files </span>
<a name="ln-367"></a><span class="c">!</span>
<a name="ln-368"></a>      <span class="k">close</span><span class="p">(</span><span class="n">unit_chol_ao</span><span class="p">)</span>
<a name="ln-369"></a>      <span class="k">close</span><span class="p">(</span><span class="n">unit_chol_mo_ij</span><span class="p">)</span>
<a name="ln-370"></a>      <span class="k">close</span><span class="p">(</span><span class="n">unit_chol_mo_ia</span><span class="p">)</span>
<a name="ln-371"></a>      <span class="k">close</span><span class="p">(</span><span class="n">unit_chol_mo_ab</span><span class="p">)</span>
<a name="ln-372"></a><span class="c">! </span>
<a name="ln-373"></a><span class="c">!     Rewrite to direct access file, delete sequential file</span>
<a name="ln-374"></a><span class="c">! </span>
<a name="ln-375"></a><span class="c">!     :: L_ij_J ::</span>
<a name="ln-376"></a><span class="c">!</span>
<a name="ln-377"></a>      <span class="k">call </span><span class="n">generate_unit_identifier</span><span class="p">(</span><span class="n">unit_chol_mo_ij</span><span class="p">)</span>
<a name="ln-378"></a>      <span class="k">open</span><span class="p">(</span><span class="n">unit_chol_mo_ij</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;cholesky_ij&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;unformatted&#39;</span><span class="p">)</span>
<a name="ln-379"></a>      <span class="k">rewind</span><span class="p">(</span><span class="n">unit_chol_mo_ij</span><span class="p">)</span>
<a name="ln-380"></a><span class="c">!</span>
<a name="ln-381"></a><span class="c">!     Read L_ij_J</span>
<a name="ln-382"></a><span class="c">!</span>
<a name="ln-383"></a>      <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">alloc</span><span class="p">(</span><span class="n">L_ij_J</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_o</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_o</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_J</span><span class="p">)</span>
<a name="ln-384"></a>      <span class="k">do </span><span class="n">J</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_J</span>
<a name="ln-385"></a>         <span class="k">read</span><span class="p">(</span><span class="n">unit_chol_mo_ij</span><span class="p">)</span> <span class="p">(</span><span class="n">L_ij_J</span><span class="p">(</span><span class="n">ij</span><span class="p">,</span> <span class="n">J</span><span class="p">),</span> <span class="n">ij</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_o</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_o</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-386"></a>      <span class="n">enddo</span>
<a name="ln-387"></a><span class="c">!</span>
<a name="ln-388"></a><span class="c">!     Close and delete file</span>
<a name="ln-389"></a><span class="c">!</span>
<a name="ln-390"></a>      <span class="k">close</span><span class="p">(</span><span class="n">unit_chol_mo_ij</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;delete&#39;</span><span class="p">)</span>
<a name="ln-391"></a><span class="c">!</span>
<a name="ln-392"></a>      <span class="k">call </span><span class="n">generate_unit_identifier</span><span class="p">(</span><span class="n">unit_chol_mo_ij_direct</span><span class="p">)</span>
<a name="ln-393"></a>      <span class="k">open</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">unit_chol_mo_ij_direct</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;cholesky_ij_direct&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;write&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-394"></a>           <span class="nb">access</span><span class="o">=</span><span class="s1">&#39;direct&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;unformatted&#39;</span><span class="p">,</span> <span class="n">recl</span><span class="o">=</span><span class="n">dp</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_J</span><span class="p">),</span> <span class="n">iostat</span><span class="o">=</span><span class="n">ioerror</span><span class="p">)</span>
<a name="ln-395"></a><span class="c">!</span>
<a name="ln-396"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_o</span>
<a name="ln-397"></a>         <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_o</span>
<a name="ln-398"></a>            <span class="n">ij</span> <span class="o">=</span> <span class="n">index_packed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a name="ln-399"></a>            <span class="k">write</span><span class="p">(</span><span class="n">unit_chol_mo_ij_direct</span><span class="p">,</span> <span class="n">rec</span><span class="o">=</span><span class="n">ij</span><span class="p">)</span> <span class="p">(</span><span class="n">L_ij_J</span><span class="p">(</span><span class="n">ij</span><span class="p">,</span><span class="n">j</span><span class="p">),</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_J</span><span class="p">)</span>
<a name="ln-400"></a>         <span class="n">enddo</span>
<a name="ln-401"></a>      <span class="n">enddo</span>
<a name="ln-402"></a><span class="c">!</span>
<a name="ln-403"></a>      <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">dealloc</span><span class="p">(</span><span class="n">L_ij_J</span><span class="p">,</span>  <span class="n">wf</span><span class="p">%</span><span class="n">n_o</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_o</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_J</span><span class="p">)</span>
<a name="ln-404"></a>      <span class="k">close</span><span class="p">(</span><span class="n">unit_chol_mo_ij_direct</span><span class="p">)</span>
<a name="ln-405"></a><span class="c">!</span>
<a name="ln-406"></a><span class="c">!     :: L_ia_J :: </span>
<a name="ln-407"></a><span class="c">!</span>
<a name="ln-408"></a>      <span class="k">call </span><span class="n">generate_unit_identifier</span><span class="p">(</span><span class="n">unit_chol_mo_ia</span><span class="p">)</span>
<a name="ln-409"></a>      <span class="k">open</span><span class="p">(</span><span class="n">unit_chol_mo_ia</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;cholesky_ia&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;unformatted&#39;</span><span class="p">)</span>
<a name="ln-410"></a>      <span class="k">rewind</span><span class="p">(</span><span class="n">unit_chol_mo_ia</span><span class="p">)</span>
<a name="ln-411"></a><span class="c">!</span>
<a name="ln-412"></a><span class="c">!     Read L_ia_J</span>
<a name="ln-413"></a><span class="c">!</span>
<a name="ln-414"></a>      <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">alloc</span><span class="p">(</span><span class="n">L_ia_J</span><span class="p">,</span> <span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_o</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_v</span><span class="p">),</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_J</span><span class="p">)</span>
<a name="ln-415"></a><span class="c">!</span>
<a name="ln-416"></a>      <span class="k">do </span><span class="n">J</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_J</span>
<a name="ln-417"></a>         <span class="k">read</span><span class="p">(</span><span class="n">unit_chol_mo_ia</span><span class="p">)</span> <span class="p">(</span><span class="n">L_ia_J</span><span class="p">(</span><span class="n">ia</span><span class="p">,</span> <span class="n">J</span><span class="p">),</span> <span class="n">ia</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_o</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_v</span><span class="p">))</span>
<a name="ln-418"></a>      <span class="n">enddo</span>
<a name="ln-419"></a><span class="c">!</span>
<a name="ln-420"></a><span class="c">!     Close and delete file</span>
<a name="ln-421"></a><span class="c">!</span>
<a name="ln-422"></a>      <span class="k">close</span><span class="p">(</span><span class="n">unit_chol_mo_ia</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;delete&#39;</span><span class="p">)</span>
<a name="ln-423"></a><span class="c">!</span>
<a name="ln-424"></a>      <span class="k">call </span><span class="n">generate_unit_identifier</span><span class="p">(</span><span class="n">unit_chol_mo_ia_direct</span><span class="p">)</span>
<a name="ln-425"></a>      <span class="k">open</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">unit_chol_mo_ia_direct</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;cholesky_ia_direct&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;write&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-426"></a>           <span class="nb">access</span><span class="o">=</span><span class="s1">&#39;direct&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;unformatted&#39;</span><span class="p">,</span> <span class="n">recl</span><span class="o">=</span><span class="n">dp</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_J</span><span class="p">),</span> <span class="n">iostat</span><span class="o">=</span><span class="n">ioerror</span><span class="p">)</span>
<a name="ln-427"></a><span class="c">!</span>
<a name="ln-428"></a>      <span class="k">do </span><span class="n">ia</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_o</span><span class="o">*</span><span class="n">wf</span><span class="p">%</span><span class="n">n_v</span>
<a name="ln-429"></a>            <span class="k">write</span><span class="p">(</span><span class="n">unit_chol_mo_ia_direct</span><span class="p">,</span> <span class="n">rec</span><span class="o">=</span><span class="n">ia</span><span class="p">)</span> <span class="p">(</span><span class="n">L_ia_J</span><span class="p">(</span><span class="n">ia</span><span class="p">,</span><span class="n">j</span><span class="p">),</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_J</span><span class="p">)</span>
<a name="ln-430"></a>      <span class="n">enddo</span>
<a name="ln-431"></a><span class="c">!</span>
<a name="ln-432"></a>      <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">dealloc</span><span class="p">(</span><span class="n">L_ia_J</span><span class="p">,</span> <span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_o</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_v</span><span class="p">),</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_J</span><span class="p">)</span>
<a name="ln-433"></a>      <span class="k">close</span><span class="p">(</span><span class="n">unit_chol_mo_ia_direct</span><span class="p">)</span>
<a name="ln-434"></a><span class="c">!</span>
<a name="ln-435"></a><span class="c">!     :: L_ab_J ::</span>
<a name="ln-436"></a><span class="c">!</span>
<a name="ln-437"></a>      <span class="k">call </span><span class="n">generate_unit_identifier</span><span class="p">(</span><span class="n">unit_chol_mo_ab</span><span class="p">)</span>
<a name="ln-438"></a>      <span class="k">open</span><span class="p">(</span><span class="n">unit_chol_mo_ab</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;cholesky_ab&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;unformatted&#39;</span><span class="p">)</span>
<a name="ln-439"></a>      <span class="k">rewind</span><span class="p">(</span><span class="n">unit_chol_mo_ab</span><span class="p">)</span>
<a name="ln-440"></a><span class="c">!</span>
<a name="ln-441"></a>      <span class="k">call </span><span class="n">generate_unit_identifier</span><span class="p">(</span><span class="n">unit_chol_mo_ab_direct</span><span class="p">)</span>
<a name="ln-442"></a>      <span class="k">open</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">unit_chol_mo_ab_direct</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;cholesky_ab_direct&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;write&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-443"></a>           <span class="nb">access</span><span class="o">=</span><span class="s1">&#39;direct&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;unformatted&#39;</span><span class="p">,</span> <span class="n">recl</span><span class="o">=</span><span class="n">dp</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_J</span><span class="p">),</span> <span class="n">iostat</span><span class="o">=</span><span class="n">ioerror</span><span class="p">)</span>
<a name="ln-444"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ioerror</span> <span class="p">.</span><span class="n">ne</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-445"></a><span class="k">            write</span><span class="p">(</span><span class="n">unit_output</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;WARNING: error while creating cholesky_ab_direct&#39;</span>
<a name="ln-446"></a>            <span class="k">stop</span>
<a name="ln-447"></a><span class="k">         </span><span class="n">endif</span>
<a name="ln-448"></a><span class="c">!</span>
<a name="ln-449"></a><span class="c">!     Read L_ab_J in batches over b</span>
<a name="ln-450"></a><span class="c">!</span>
<a name="ln-451"></a>      <span class="n">required</span> <span class="o">=</span> <span class="p">((</span><span class="n">wf</span><span class="p">%</span><span class="n">n_v</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_J</span><span class="p">)</span>
<a name="ln-452"></a><span class="c">!</span>
<a name="ln-453"></a>      <span class="n">required</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">required</span> <span class="c">! In words</span>
<a name="ln-454"></a>      <span class="n">available</span> <span class="o">=</span> <span class="n">get_available</span><span class="p">()</span>
<a name="ln-455"></a><span class="c">!</span>
<a name="ln-456"></a>      <span class="n">batch_dimension</span>  <span class="o">=</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_v</span> <span class="c">! Batch over the virtual index b</span>
<a name="ln-457"></a>      <span class="n">max_batch_length</span> <span class="o">=</span> <span class="mi">0</span>      <span class="c">! Initilization of unset variables </span>
<a name="ln-458"></a>      <span class="n">n_batch</span>          <span class="o">=</span> <span class="mi">0</span>
<a name="ln-459"></a><span class="c">!</span>
<a name="ln-460"></a>      <span class="k">call </span><span class="n">num_batch</span><span class="p">(</span><span class="n">required</span><span class="p">,</span> <span class="n">available</span><span class="p">,</span> <span class="n">max_batch_length</span><span class="p">,</span> <span class="n">n_batch</span><span class="p">,</span> <span class="n">batch_dimension</span><span class="p">)</span>           
<a name="ln-461"></a><span class="c">!</span>
<a name="ln-462"></a><span class="c">!     Loop over the number of a batches </span>
<a name="ln-463"></a><span class="c">!</span>
<a name="ln-464"></a>      <span class="k">do </span><span class="n">b_batch</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_batch</span>
<a name="ln-465"></a><span class="c">!</span>
<a name="ln-466"></a>         <span class="k">call </span><span class="n">batch_limits</span><span class="p">(</span><span class="n">b_first</span><span class="p">,</span> <span class="n">b_last</span><span class="p">,</span> <span class="n">b_batch</span><span class="p">,</span> <span class="n">max_batch_length</span><span class="p">,</span> <span class="n">batch_dimension</span><span class="p">)</span>
<a name="ln-467"></a>         <span class="n">b_length</span> <span class="o">=</span> <span class="n">b_last</span> <span class="o">-</span> <span class="n">b_first</span> <span class="o">+</span> <span class="mi">1</span> 
<a name="ln-468"></a><span class="c">!</span>
<a name="ln-469"></a>         <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">alloc</span><span class="p">(</span><span class="n">L_ab_J</span><span class="p">,</span> <span class="p">(((</span><span class="n">b_length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">b_length</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_v</span> <span class="o">-</span> <span class="n">b_length</span> <span class="o">-</span> <span class="n">b_first</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">b_length</span><span class="p">),</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_J</span><span class="p">)</span>
<a name="ln-470"></a><span class="c">!</span>
<a name="ln-471"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">b_first</span> <span class="p">.</span><span class="n">ne</span><span class="p">.</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-472"></a><span class="c">!  </span>
<a name="ln-473"></a><span class="c">!           Calculate index of last element to throw away</span>
<a name="ln-474"></a><span class="c">!  </span>
<a name="ln-475"></a>            <span class="n">throw_away_index</span> <span class="o">=</span> <span class="n">index_packed</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_v</span><span class="p">,</span> <span class="n">b_first</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-476"></a><span class="c">!  </span>
<a name="ln-477"></a><span class="c">!           Throw away all elements from 1 to throw_away_index, then read from batch start</span>
<a name="ln-478"></a><span class="c">!  </span>
<a name="ln-479"></a>            <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_J</span>
<a name="ln-480"></a><span class="c">!</span>
<a name="ln-481"></a>              <span class="k">read</span><span class="p">(</span><span class="n">unit_chol_mo_ab</span><span class="p">)</span> <span class="p">(</span><span class="n">throw_away</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">throw_away_index</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-482"></a>                                    <span class="p">(</span><span class="n">L_ab_J</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">j</span><span class="p">),</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,(((</span><span class="n">b_length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">b_length</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_v</span> <span class="o">-</span> <span class="n">b_length</span> <span class="o">-</span> <span class="n">b_first</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">b_length</span><span class="p">))</span>
<a name="ln-483"></a><span class="c">!</span>
<a name="ln-484"></a>            <span class="n">enddo</span>
<a name="ln-485"></a><span class="c">!</span>
<a name="ln-486"></a>         <span class="k">else</span>
<a name="ln-487"></a><span class="c">!  </span>
<a name="ln-488"></a><span class="c">!           Read from the start of each entry</span>
<a name="ln-489"></a><span class="c">!  </span>
<a name="ln-490"></a>            <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_J</span>
<a name="ln-491"></a><span class="c">!</span>
<a name="ln-492"></a>              <span class="k">read</span><span class="p">(</span><span class="n">unit_chol_mo_ab</span><span class="p">)</span> <span class="p">(</span><span class="n">L_ab_J</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">j</span><span class="p">),</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(((</span><span class="n">b_length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">b_length</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_v</span> <span class="o">-</span> <span class="n">b_length</span> <span class="o">-</span> <span class="n">b_first</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">b_length</span><span class="p">))</span>
<a name="ln-493"></a><span class="c">!</span>
<a name="ln-494"></a>            <span class="n">enddo</span>
<a name="ln-495"></a><span class="c">!</span>
<a name="ln-496"></a>         <span class="n">endif</span>
<a name="ln-497"></a><span class="c">!</span>
<a name="ln-498"></a>         <span class="k">do </span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_v</span>
<a name="ln-499"></a>            <span class="k">do </span><span class="n">b</span> <span class="o">=</span> <span class="n">b_first</span><span class="p">,</span> <span class="n">b_last</span>
<a name="ln-500"></a>               <span class="n">ab</span> <span class="o">=</span> <span class="n">index_packed</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<a name="ln-501"></a>               <span class="k">write</span><span class="p">(</span><span class="n">unit_chol_mo_ab_direct</span><span class="p">,</span> <span class="n">rec</span><span class="o">=</span><span class="n">ab</span><span class="p">)</span> <span class="p">(</span><span class="n">L_ab_J</span><span class="p">(</span><span class="n">ab</span><span class="p">,</span> <span class="n">J</span><span class="p">),</span> <span class="n">J</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_J</span><span class="p">)</span>
<a name="ln-502"></a>            <span class="n">enddo</span>
<a name="ln-503"></a>         <span class="n">enddo</span>
<a name="ln-504"></a><span class="c">!</span>
<a name="ln-505"></a>         <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">dealloc</span><span class="p">(</span><span class="n">L_ab_J</span><span class="p">,</span> <span class="p">(((</span><span class="n">b_length</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">b_length</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_v</span> <span class="o">-</span> <span class="n">b_length</span> <span class="o">-</span> <span class="n">b_first</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">b_length</span><span class="p">),</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_J</span><span class="p">)</span>
<a name="ln-506"></a><span class="c">!</span>
<a name="ln-507"></a>      <span class="n">enddo</span>
<a name="ln-508"></a>      <span class="k">close</span><span class="p">(</span><span class="n">unit_chol_mo_ab</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;delete&#39;</span><span class="p">)</span>
<a name="ln-509"></a>      <span class="k">close</span><span class="p">(</span><span class="n">unit_chol_mo_ab_direct</span><span class="p">)</span>
<a name="ln-510"></a><span class="c">!</span>
<a name="ln-511"></a><span class="c">!     Print timings </span>
<a name="ln-512"></a><span class="c">!   </span>
<a name="ln-513"></a>      <span class="k">call </span><span class="nb">cpu_time</span><span class="p">(</span><span class="n">end_timer</span><span class="p">)</span>
<a name="ln-514"></a><span class="c">!</span>
<a name="ln-515"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">settings</span><span class="p">%</span><span class="n">print_level</span> <span class="o">==</span> <span class="s1">&#39;developer&#39;</span><span class="p">)</span> <span class="k">then</span> 
<a name="ln-516"></a><span class="c">!</span>
<a name="ln-517"></a>         <span class="k">write</span><span class="p">(</span><span class="n">unit_output</span><span class="p">,</span><span class="s1">&#39;(/t3,a36,f14.8)&#39;</span><span class="p">)</span> <span class="s1">&#39;Time to store Cholesky (seconds):   &#39;</span><span class="p">,</span> <span class="n">end_timer</span> <span class="o">-</span> <span class="n">begin_timer</span>
<a name="ln-518"></a>         <span class="nb">flush</span><span class="p">(</span><span class="n">unit_output</span><span class="p">)</span>
<a name="ln-519"></a><span class="c">!</span>
<a name="ln-520"></a>      <span class="n">endif</span>
<a name="ln-521"></a><span class="c">!</span>
<a name="ln-522"></a>   <span class="k">end subroutine </span><span class="n">read_transform_cholesky_hf</span>
<a name="ln-523"></a><span class="c">!</span>
<a name="ln-524"></a><span class="c">!</span>
<a name="ln-525"></a>   <span class="k">subroutine </span><span class="n">read_cholesky_ij_hf</span><span class="p">(</span><span class="n">wf</span><span class="p">,</span> <span class="n">L_ij_J</span> <span class="p">,</span> <span class="n">i_first</span><span class="p">,</span> <span class="n">i_last</span><span class="p">,</span> <span class="n">j_first</span><span class="p">,</span> <span class="n">j_last</span><span class="p">)</span>
<a name="ln-526"></a><span class="c">!!</span>
<a name="ln-527"></a><span class="c">!!    Read Cholesky IJ </span>
<a name="ln-528"></a><span class="c">!!    Written by Sarai D. Folkestad and Eirik F. KjÃ¸nstad, Apr 2017</span>
<a name="ln-529"></a><span class="c">!!</span>
<a name="ln-530"></a><span class="c">!!    Reads the MO Cholesky IJ (occ-occ) vectors from file and </span>
<a name="ln-531"></a><span class="c">!!    places them in the incoming L_ij_J matrix</span>
<a name="ln-532"></a><span class="c">!!</span>
<a name="ln-533"></a><span class="c">!!    Optional arguments: i_first, i_last, j_first, j_last can be used in order to restrict indices</span>
<a name="ln-534"></a><span class="c">!!</span>
<a name="ln-535"></a>      <span class="k">implicit none</span>
<a name="ln-536"></a><span class="c">!</span>
<a name="ln-537"></a>      <span class="k">class</span><span class="p">(</span><span class="n">hf</span><span class="p">)</span>                <span class="kd">::</span> <span class="n">wf</span>
<a name="ln-538"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">),</span> <span class="k">optional</span>   <span class="kd">::</span> <span class="n">i_first</span><span class="p">,</span> <span class="n">j_first</span>     <span class="c">! First index (can differ from 1 when batching or for mlcc) </span>
<a name="ln-539"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">),</span> <span class="k">optional</span>   <span class="kd">::</span> <span class="n">i_last</span><span class="p">,</span> <span class="n">j_last</span>      <span class="c">! Last index (can differ from n_o when batching or for mlcc)   </span>
<a name="ln-540"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:)</span> <span class="kd">::</span> <span class="n">L_ij_J</span> <span class="c">! L_ij^J</span>
<a name="ln-541"></a><span class="c">!</span>
<a name="ln-542"></a><span class="c">!     Local routine variables </span>
<a name="ln-543"></a><span class="c">!</span>
<a name="ln-544"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">unit_chol_mo_ij</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c">! Unit identifier for cholesky_ij file</span>
<a name="ln-545"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ioerror</span>
<a name="ln-546"></a><span class="c">!</span>
<a name="ln-547"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ij</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ik</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ij_full</span>
<a name="ln-548"></a><span class="c">!</span>
<a name="ln-549"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i_length</span><span class="p">,</span> <span class="n">j_length</span> <span class="c">! number of i and j elements</span>
<a name="ln-550"></a><span class="c">!</span>
<a name="ln-551"></a><span class="c">!</span>
<a name="ln-552"></a>      <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">i_first</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">present</span><span class="p">(</span><span class="n">i_last</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">present</span><span class="p">(</span><span class="n">j_first</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">present</span><span class="p">(</span><span class="n">j_last</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-553"></a><span class="k">         </span><span class="n">i_length</span> <span class="o">=</span> <span class="n">i_last</span> <span class="o">-</span> <span class="n">i_first</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-554"></a>         <span class="n">j_length</span> <span class="o">=</span> <span class="n">j_last</span> <span class="o">-</span> <span class="n">j_first</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-555"></a><span class="c">!</span>
<a name="ln-556"></a><span class="c">!        Prepare for reading: generate unit idientifier, open file, and rewind</span>
<a name="ln-557"></a><span class="c">!</span>
<a name="ln-558"></a>         <span class="k">call </span><span class="n">generate_unit_identifier</span><span class="p">(</span><span class="n">unit_chol_mo_ij</span><span class="p">)</span>
<a name="ln-559"></a>         <span class="k">open</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">unit_chol_mo_ij</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;cholesky_ij_direct&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-560"></a>              <span class="nb">access</span><span class="o">=</span><span class="s1">&#39;direct&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;unformatted&#39;</span><span class="p">,</span> <span class="n">recl</span><span class="o">=</span><span class="n">dp</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_J</span><span class="p">),</span> <span class="n">iostat</span><span class="o">=</span><span class="n">ioerror</span><span class="p">)</span>
<a name="ln-561"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ioerror</span> <span class="p">.</span><span class="n">ne</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-562"></a><span class="k">            write</span><span class="p">(</span><span class="n">unit_output</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;WARNING: error while reading cholesky_ij_direct&#39;</span>
<a name="ln-563"></a>            <span class="k">stop</span>
<a name="ln-564"></a><span class="k">         </span><span class="n">endif</span>
<a name="ln-565"></a><span class="c">!</span>
<a name="ln-566"></a><span class="c">!        Read the Cholesky vectors into the L_ij_J matrix</span>
<a name="ln-567"></a><span class="c">!</span>
<a name="ln-568"></a>         <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i_length</span>
<a name="ln-569"></a>            <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j_length</span>
<a name="ln-570"></a><span class="c">!</span>
<a name="ln-571"></a>               <span class="n">ij_full</span> <span class="o">=</span> <span class="n">index_packed</span><span class="p">((</span><span class="n">i</span> <span class="o">+</span> <span class="n">i_first</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">j_first</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
<a name="ln-572"></a><span class="c">!</span>
<a name="ln-573"></a>               <span class="n">ij</span> <span class="o">=</span>  <span class="n">index_two</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">i_length</span><span class="p">)</span>
<a name="ln-574"></a><span class="c">!</span>
<a name="ln-575"></a>               <span class="k">read</span><span class="p">(</span><span class="n">unit_chol_mo_ij</span><span class="p">,</span> <span class="n">rec</span><span class="o">=</span><span class="n">ij_full</span><span class="p">)</span> <span class="p">(</span><span class="n">L_ij_J</span><span class="p">(</span><span class="n">ij</span><span class="p">,</span><span class="n">j</span><span class="p">),</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_J</span><span class="p">)</span>
<a name="ln-576"></a><span class="c">!</span>
<a name="ln-577"></a>            <span class="n">enddo</span>
<a name="ln-578"></a>         <span class="n">enddo</span>
<a name="ln-579"></a><span class="c">!</span>
<a name="ln-580"></a><span class="c">!        Close file</span>
<a name="ln-581"></a><span class="c">!</span>
<a name="ln-582"></a>         <span class="k">close</span><span class="p">(</span><span class="n">unit_chol_mo_ij</span><span class="p">)</span> 
<a name="ln-583"></a><span class="c">!</span>
<a name="ln-584"></a>      <span class="n">elseif</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">i_first</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">present</span><span class="p">(</span><span class="n">i_last</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">present</span><span class="p">(</span><span class="n">j_first</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">present</span><span class="p">(</span><span class="n">j_last</span><span class="p">)))</span> <span class="k">then</span>
<a name="ln-585"></a><span class="c">!</span>
<a name="ln-586"></a><span class="c">!        Prepare for reading: generate unit idientifier, open file, and rewind</span>
<a name="ln-587"></a><span class="c">!</span>
<a name="ln-588"></a>         <span class="k">call </span><span class="n">generate_unit_identifier</span><span class="p">(</span><span class="n">unit_chol_mo_ij</span><span class="p">)</span>
<a name="ln-589"></a>         <span class="k">open</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">unit_chol_mo_ij</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;cholesky_ij_direct&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-590"></a>              <span class="nb">access</span><span class="o">=</span><span class="s1">&#39;direct&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;unformatted&#39;</span><span class="p">,</span> <span class="n">recl</span><span class="o">=</span><span class="n">dp</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_J</span><span class="p">),</span> <span class="n">iostat</span><span class="o">=</span><span class="n">ioerror</span><span class="p">)</span>
<a name="ln-591"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ioerror</span> <span class="p">.</span><span class="n">ne</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-592"></a><span class="k">            write</span><span class="p">(</span><span class="n">unit_output</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;WARNING: error while reading cholesky_ij_direct&#39;</span>
<a name="ln-593"></a>            <span class="k">stop</span>
<a name="ln-594"></a><span class="k">         </span><span class="n">endif</span>
<a name="ln-595"></a><span class="c">!</span>
<a name="ln-596"></a><span class="c">!        Read the Cholesky vectors into the L_ij_J matrix</span>
<a name="ln-597"></a><span class="c">!</span>
<a name="ln-598"></a>         <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_o</span>
<a name="ln-599"></a>            <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_o</span>
<a name="ln-600"></a>               <span class="n">ij</span> <span class="o">=</span> <span class="n">index_two</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_o</span><span class="p">)</span>
<a name="ln-601"></a>               <span class="n">ik</span> <span class="o">=</span> <span class="n">index_packed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-602"></a>               <span class="k">read</span><span class="p">(</span><span class="n">unit_chol_mo_ij</span><span class="p">,</span> <span class="n">rec</span><span class="o">=</span><span class="n">ik</span><span class="p">)</span> <span class="p">(</span><span class="n">L_ij_J</span><span class="p">(</span><span class="n">ij</span><span class="p">,</span><span class="n">j</span><span class="p">),</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_J</span><span class="p">)</span>
<a name="ln-603"></a>            <span class="n">enddo</span>
<a name="ln-604"></a>         <span class="n">enddo</span>
<a name="ln-605"></a><span class="c">!</span>
<a name="ln-606"></a><span class="c">!        Close file</span>
<a name="ln-607"></a><span class="c">!</span>
<a name="ln-608"></a>         <span class="k">close</span><span class="p">(</span><span class="n">unit_chol_mo_ij</span><span class="p">)</span> 
<a name="ln-609"></a><span class="c">!</span>
<a name="ln-610"></a>      <span class="k">else</span>
<a name="ln-611"></a><span class="c">!</span>
<a name="ln-612"></a>         <span class="k">write</span><span class="p">(</span><span class="n">unit_output</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;WARNING: Error in call to read_cholesky_ij&#39;</span>
<a name="ln-613"></a>         <span class="k">stop</span>
<a name="ln-614"></a><span class="c">!</span>
<a name="ln-615"></a>      <span class="n">endif</span>   
<a name="ln-616"></a><span class="c">!</span>
<a name="ln-617"></a>   <span class="k">end subroutine </span><span class="n">read_cholesky_ij_hf</span>
<a name="ln-618"></a><span class="c">!</span>
<a name="ln-619"></a><span class="c">!</span>
<a name="ln-620"></a>   <span class="k">subroutine </span><span class="n">read_cholesky_ia_hf</span><span class="p">(</span><span class="n">wf</span><span class="p">,</span><span class="n">L_ia_J</span><span class="p">,</span> <span class="n">i_first</span><span class="p">,</span> <span class="n">i_last</span><span class="p">,</span> <span class="n">a_first</span><span class="p">,</span> <span class="n">a_last</span><span class="p">)</span>
<a name="ln-621"></a><span class="c">!!</span>
<a name="ln-622"></a><span class="c">!!    Read Cholesky IA </span>
<a name="ln-623"></a><span class="c">!!    Written by Sarai D. Folkestad and Eirik F. KjÃ¸nstad, Apr 2017</span>
<a name="ln-624"></a><span class="c">!!</span>
<a name="ln-625"></a><span class="c">!!    Reads the MO Cholesky IA (occ-vir) vectors from file and</span>
<a name="ln-626"></a><span class="c">!!    places them in the incoming L_ia_J matrix</span>
<a name="ln-627"></a><span class="c">!!</span>
<a name="ln-628"></a><span class="c">!!</span>
<a name="ln-629"></a><span class="c">!!    Optional arguments: i_first, i_last, a_first, a_last can be used in order to restrict indices</span>
<a name="ln-630"></a><span class="c">!!</span>
<a name="ln-631"></a>      <span class="k">implicit none</span>
<a name="ln-632"></a><span class="c">!</span>
<a name="ln-633"></a>      <span class="k">class</span><span class="p">(</span><span class="n">hf</span><span class="p">)</span>                <span class="kd">::</span> <span class="n">wf</span>    
<a name="ln-634"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">),</span> <span class="k">optional</span>   <span class="kd">::</span> <span class="n">i_first</span><span class="p">,</span> <span class="n">a_first</span>     <span class="c">! First index (can differ from 1 when batching or for mlcc) </span>
<a name="ln-635"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">),</span> <span class="k">optional</span>   <span class="kd">::</span> <span class="n">i_last</span><span class="p">,</span> <span class="n">a_last</span>      <span class="c">! Last index (can differ from n_o when batching or for mlcc) </span>
<a name="ln-636"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:)</span> <span class="kd">::</span> <span class="n">L_ia_J</span> <span class="c">! L_ia^J</span>
<a name="ln-637"></a><span class="c">!</span>
<a name="ln-638"></a><span class="c">!     Local routine variables</span>
<a name="ln-639"></a><span class="c">!</span>
<a name="ln-640"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">unit_chol_mo_ia</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c">! Unit identifier for cholesky_ia file</span>
<a name="ln-641"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ioerror</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-642"></a><span class="c">!</span>
<a name="ln-643"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ia</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ia_full</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-644"></a><span class="c">!</span>
<a name="ln-645"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i_length</span><span class="p">,</span> <span class="n">a_length</span>
<a name="ln-646"></a><span class="c">!</span>
<a name="ln-647"></a>      <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">i_first</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">present</span><span class="p">(</span><span class="n">i_last</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">present</span><span class="p">(</span><span class="n">a_first</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">present</span><span class="p">(</span><span class="n">a_last</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-648"></a><span class="k">         </span><span class="n">i_length</span> <span class="o">=</span> <span class="n">i_last</span> <span class="o">-</span> <span class="n">i_first</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-649"></a>         <span class="n">a_length</span> <span class="o">=</span> <span class="n">a_last</span> <span class="o">-</span> <span class="n">a_first</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-650"></a><span class="c">!</span>
<a name="ln-651"></a><span class="c">!        Prepare for reading: generate unit idientifier, open, and rewind file</span>
<a name="ln-652"></a><span class="c">!</span>
<a name="ln-653"></a>         <span class="k">call </span><span class="n">generate_unit_identifier</span><span class="p">(</span><span class="n">unit_chol_mo_ia</span><span class="p">)</span>
<a name="ln-654"></a>         <span class="k">open</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">unit_chol_mo_ia</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;cholesky_ia_direct&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-655"></a>              <span class="nb">access</span><span class="o">=</span><span class="s1">&#39;direct&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;unformatted&#39;</span><span class="p">,</span> <span class="n">recl</span><span class="o">=</span><span class="n">dp</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_J</span><span class="p">),</span> <span class="n">iostat</span><span class="o">=</span><span class="n">ioerror</span><span class="p">)</span>
<a name="ln-656"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ioerror</span> <span class="p">.</span><span class="n">ne</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-657"></a><span class="k">            write</span><span class="p">(</span><span class="n">unit_output</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;WARNING: error while reading cholesky_ij_direct&#39;</span>
<a name="ln-658"></a>            <span class="k">stop</span>
<a name="ln-659"></a><span class="k">         </span><span class="n">endif</span>
<a name="ln-660"></a><span class="c">!</span>
<a name="ln-661"></a><span class="c">!        Read Cholesky vectors into the L_ia_J matrix</span>
<a name="ln-662"></a><span class="c">!</span>
<a name="ln-663"></a>         <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i_length</span>
<a name="ln-664"></a>            <span class="k">do </span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a_length</span>
<a name="ln-665"></a><span class="c">!</span>
<a name="ln-666"></a>               <span class="n">ia_full</span> <span class="o">=</span> <span class="n">index_two</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">i_first</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span> <span class="o">+</span> <span class="n">a_first</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_o</span><span class="p">)</span>
<a name="ln-667"></a>               <span class="n">ia</span> <span class="o">=</span> <span class="n">index_two</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">i_length</span><span class="p">)</span>
<a name="ln-668"></a>               <span class="k">read</span><span class="p">(</span><span class="n">unit_chol_mo_ia</span><span class="p">,</span> <span class="n">rec</span><span class="o">=</span><span class="n">ia_full</span><span class="p">)</span> <span class="p">(</span><span class="n">L_ia_J</span><span class="p">(</span><span class="n">ia</span><span class="p">,</span><span class="n">j</span><span class="p">),</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_J</span><span class="p">)</span>
<a name="ln-669"></a><span class="c">!</span>
<a name="ln-670"></a>            <span class="n">enddo</span>
<a name="ln-671"></a>         <span class="n">enddo</span>
<a name="ln-672"></a><span class="c">!</span>
<a name="ln-673"></a><span class="c">!        Close file</span>
<a name="ln-674"></a><span class="c">!</span>
<a name="ln-675"></a>         <span class="k">close</span><span class="p">(</span><span class="n">unit_chol_mo_ia</span><span class="p">)</span>
<a name="ln-676"></a>
<a name="ln-677"></a>      <span class="n">elseif</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.(</span><span class="nb">present</span><span class="p">(</span><span class="n">i_first</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">present</span><span class="p">(</span><span class="n">i_last</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">present</span><span class="p">(</span><span class="n">a_first</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">present</span><span class="p">(</span><span class="n">a_last</span><span class="p">)))</span> <span class="k">then</span>
<a name="ln-678"></a><span class="c">!</span>
<a name="ln-679"></a><span class="c">!        Prepare for reading: generate unit idientifier, open, and rewind file</span>
<a name="ln-680"></a><span class="c">!</span>
<a name="ln-681"></a>         <span class="k">call </span><span class="n">generate_unit_identifier</span><span class="p">(</span><span class="n">unit_chol_mo_ia</span><span class="p">)</span>
<a name="ln-682"></a>         <span class="k">open</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">unit_chol_mo_ia</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;cholesky_ia_direct&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-683"></a>              <span class="nb">access</span><span class="o">=</span><span class="s1">&#39;direct&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;unformatted&#39;</span><span class="p">,</span> <span class="n">recl</span><span class="o">=</span><span class="n">dp</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_J</span><span class="p">),</span> <span class="n">iostat</span><span class="o">=</span><span class="n">ioerror</span><span class="p">)</span>
<a name="ln-684"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">ioerror</span> <span class="p">.</span><span class="n">ne</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-685"></a><span class="k">            write</span><span class="p">(</span><span class="n">unit_output</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;WARNING: error while reading cholesky_ij_direct&#39;</span>
<a name="ln-686"></a>            <span class="k">stop</span>
<a name="ln-687"></a><span class="k">         </span><span class="n">endif</span>
<a name="ln-688"></a><span class="c">!</span>
<a name="ln-689"></a><span class="c">!        Read Cholesky vectors into the L_ia_J matrix</span>
<a name="ln-690"></a><span class="c">!</span>
<a name="ln-691"></a>         <span class="k">do </span><span class="n">ia</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_v</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_o</span><span class="p">)</span>
<a name="ln-692"></a><span class="c">!</span>
<a name="ln-693"></a>               <span class="k">read</span><span class="p">(</span><span class="n">unit_chol_mo_ia</span><span class="p">,</span> <span class="n">rec</span><span class="o">=</span><span class="n">ia</span><span class="p">)</span> <span class="p">(</span><span class="n">L_ia_J</span><span class="p">(</span><span class="n">ia</span><span class="p">,</span><span class="n">j</span><span class="p">),</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_J</span><span class="p">)</span>
<a name="ln-694"></a><span class="c">!</span>
<a name="ln-695"></a>         <span class="n">enddo</span>
<a name="ln-696"></a><span class="c">!</span>
<a name="ln-697"></a><span class="c">!        Close file</span>
<a name="ln-698"></a><span class="c">!</span>
<a name="ln-699"></a>         <span class="k">close</span><span class="p">(</span><span class="n">unit_chol_mo_ia</span><span class="p">)</span>
<a name="ln-700"></a>      <span class="k">else</span>
<a name="ln-701"></a><span class="k">         write</span><span class="p">(</span><span class="n">unit_output</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;WARNING: Error in call to read_cholesky_ia&#39;</span>
<a name="ln-702"></a>            <span class="k">stop</span>
<a name="ln-703"></a><span class="k">      </span><span class="n">endif</span>    
<a name="ln-704"></a><span class="c">!   </span>
<a name="ln-705"></a>   <span class="k">end subroutine </span><span class="n">read_cholesky_ia_hf</span>
<a name="ln-706"></a><span class="c">!</span>
<a name="ln-707"></a><span class="c">!   </span>
<a name="ln-708"></a><span class="k">subroutine </span><span class="n">read_cholesky_ai_hf</span><span class="p">(</span><span class="n">wf</span><span class="p">,</span> <span class="n">L_ai_J</span><span class="p">,</span> <span class="n">a_first</span><span class="p">,</span> <span class="n">a_last</span><span class="p">,</span> <span class="n">i_first</span><span class="p">,</span> <span class="n">i_last</span><span class="p">)</span>
<a name="ln-709"></a><span class="c">!!</span>
<a name="ln-710"></a><span class="c">!!    Read Cholesky AI </span>
<a name="ln-711"></a><span class="c">!!    Written by Sarai D. Folkestad and Eirik F. KjÃ¸nstad, Apr 2017</span>
<a name="ln-712"></a><span class="c">!!</span>
<a name="ln-713"></a><span class="c">!!    Reads the MO Cholesky AI (vir-occ) vectors from file and</span>
<a name="ln-714"></a><span class="c">!!    places them in the incoming L_ai_J matrix</span>
<a name="ln-715"></a><span class="c">!!</span>
<a name="ln-716"></a><span class="c">!!    Optional arguments: i_first, i_last, a_first, a_last can be used in order to restrict indices</span>
<a name="ln-717"></a><span class="c">!!</span>
<a name="ln-718"></a>      <span class="k">implicit none</span>
<a name="ln-719"></a><span class="c">!</span>
<a name="ln-720"></a>      <span class="k">class</span><span class="p">(</span><span class="n">hf</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">wf</span>
<a name="ln-721"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">),</span> <span class="k">optional</span>    <span class="kd">::</span> <span class="n">i_first</span><span class="p">,</span> <span class="n">a_first</span>     <span class="c">! First index (can differ from 1 when batching or for mlcc) </span>
<a name="ln-722"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">),</span> <span class="k">optional</span>    <span class="kd">::</span> <span class="n">i_last</span><span class="p">,</span> <span class="n">a_last</span>      <span class="c">! Last index (can differ from n_o when batching or for mlcc) </span>
<a name="ln-723"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:)</span> <span class="kd">::</span> <span class="n">L_ai_J</span> <span class="c">! L_ai^J</span>
<a name="ln-724"></a><span class="c">!</span>
<a name="ln-725"></a><span class="c">!     Local routine variables</span>
<a name="ln-726"></a><span class="c">!</span>
<a name="ln-727"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">L_ia_J</span>       
<a name="ln-728"></a><span class="c">!</span>
<a name="ln-729"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ia</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ai</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-730"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i_length</span><span class="p">,</span> <span class="n">a_length</span>
<a name="ln-731"></a><span class="c">!</span>
<a name="ln-732"></a>      <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">i_first</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">present</span><span class="p">(</span><span class="n">i_last</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">present</span><span class="p">(</span><span class="n">a_first</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">present</span><span class="p">(</span><span class="n">a_last</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-733"></a><span class="k">         </span><span class="n">i_length</span> <span class="o">=</span> <span class="n">i_last</span> <span class="o">-</span> <span class="n">i_first</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-734"></a>         <span class="n">a_length</span> <span class="o">=</span> <span class="n">a_last</span> <span class="o">-</span> <span class="n">a_first</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-735"></a><span class="c">!</span>
<a name="ln-736"></a><span class="c">!        Allocation</span>
<a name="ln-737"></a><span class="c">!</span>
<a name="ln-738"></a>         <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">alloc</span><span class="p">(</span><span class="n">L_ia_J</span><span class="p">,</span> <span class="n">i_length</span><span class="o">*</span><span class="n">a_length</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_J</span><span class="p">)</span>
<a name="ln-739"></a>         <span class="n">L_ia_J</span> <span class="o">=</span> <span class="n">zero</span>
<a name="ln-740"></a><span class="c">!        </span>
<a name="ln-741"></a><span class="c">!        Get Cholesky IA vector </span>
<a name="ln-742"></a><span class="c">!</span>
<a name="ln-743"></a>         <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">read_cholesky_ia</span><span class="p">(</span><span class="n">L_ia_J</span><span class="p">,</span> <span class="n">i_first</span><span class="p">,</span> <span class="n">i_last</span><span class="p">,</span> <span class="n">a_first</span><span class="p">,</span> <span class="n">a_last</span><span class="p">)</span>
<a name="ln-744"></a><span class="c">!</span>
<a name="ln-745"></a><span class="c">!        Reorder and save in AI vector </span>
<a name="ln-746"></a><span class="c">!         </span>
<a name="ln-747"></a>         <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i_length</span>
<a name="ln-748"></a>            <span class="k">do </span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a_length</span>
<a name="ln-749"></a><span class="c">!</span>
<a name="ln-750"></a><span class="c">!              Needed indices</span>
<a name="ln-751"></a><span class="c">!</span>
<a name="ln-752"></a>               <span class="n">ai</span> <span class="o">=</span> <span class="n">index_two</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">a_length</span><span class="p">)</span>
<a name="ln-753"></a>               <span class="n">ia</span> <span class="o">=</span> <span class="n">index_two</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">i_length</span><span class="p">)</span>
<a name="ln-754"></a><span class="c">!</span>
<a name="ln-755"></a>               <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_J</span>
<a name="ln-756"></a><span class="c">!</span>
<a name="ln-757"></a>                  <span class="n">L_ai_J</span><span class="p">(</span><span class="n">ai</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">L_ia_J</span><span class="p">(</span><span class="n">ia</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
<a name="ln-758"></a><span class="c">!</span>
<a name="ln-759"></a>               <span class="n">enddo</span>
<a name="ln-760"></a><span class="c">!</span>
<a name="ln-761"></a>            <span class="n">enddo</span>
<a name="ln-762"></a>         <span class="n">enddo</span>
<a name="ln-763"></a><span class="c">!</span>
<a name="ln-764"></a><span class="c">!        Deallocate temporary vector </span>
<a name="ln-765"></a><span class="c">!</span>
<a name="ln-766"></a>         <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">dealloc</span><span class="p">(</span><span class="n">L_ia_J</span><span class="p">,</span> <span class="n">a_length</span><span class="o">*</span><span class="n">i_length</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_J</span><span class="p">)</span>   
<a name="ln-767"></a>
<a name="ln-768"></a>      <span class="n">elseif</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.(</span><span class="nb">present</span><span class="p">(</span><span class="n">i_first</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">present</span><span class="p">(</span><span class="n">i_last</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">present</span><span class="p">(</span><span class="n">a_first</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">present</span><span class="p">(</span><span class="n">a_last</span><span class="p">)))</span> <span class="k">then</span>
<a name="ln-769"></a><span class="c">!</span>
<a name="ln-770"></a><span class="c">!        Allocation</span>
<a name="ln-771"></a><span class="c">!</span>
<a name="ln-772"></a>         <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">alloc</span><span class="p">(</span><span class="n">L_ia_J</span><span class="p">,</span> <span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_o</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_v</span><span class="p">),</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_J</span><span class="p">)</span>
<a name="ln-773"></a>         <span class="n">L_ia_J</span> <span class="o">=</span> <span class="n">zero</span>
<a name="ln-774"></a><span class="c">!        </span>
<a name="ln-775"></a><span class="c">!        Get Cholesky IA vector </span>
<a name="ln-776"></a><span class="c">!</span>
<a name="ln-777"></a>         <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">read_cholesky_ia</span><span class="p">(</span><span class="n">L_ia_J</span><span class="p">)</span>
<a name="ln-778"></a><span class="c">!</span>
<a name="ln-779"></a><span class="c">!        Reorder and save in AI vector </span>
<a name="ln-780"></a><span class="c">!         </span>
<a name="ln-781"></a>         <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_o</span>
<a name="ln-782"></a>            <span class="k">do </span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_v</span>
<a name="ln-783"></a><span class="c">!</span>
<a name="ln-784"></a><span class="c">!              Needed indices</span>
<a name="ln-785"></a><span class="c">!</span>
<a name="ln-786"></a>               <span class="n">ai</span> <span class="o">=</span> <span class="n">index_two</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_v</span><span class="p">)</span>
<a name="ln-787"></a>               <span class="n">ia</span> <span class="o">=</span> <span class="n">index_two</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_o</span><span class="p">)</span>
<a name="ln-788"></a><span class="c">!</span>
<a name="ln-789"></a>               <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_J</span>
<a name="ln-790"></a><span class="c">!</span>
<a name="ln-791"></a>                  <span class="n">L_ai_J</span><span class="p">(</span><span class="n">ai</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">L_ia_J</span><span class="p">(</span><span class="n">ia</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
<a name="ln-792"></a><span class="c">!</span>
<a name="ln-793"></a>               <span class="n">enddo</span>
<a name="ln-794"></a><span class="c">!</span>
<a name="ln-795"></a>            <span class="n">enddo</span>
<a name="ln-796"></a>         <span class="n">enddo</span>
<a name="ln-797"></a><span class="c">!</span>
<a name="ln-798"></a><span class="c">!        Deallocate temporary vector </span>
<a name="ln-799"></a><span class="c">!</span>
<a name="ln-800"></a>         <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">dealloc</span><span class="p">(</span><span class="n">L_ia_J</span><span class="p">,</span> <span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_o</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_v</span><span class="p">),</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_J</span><span class="p">)</span>   
<a name="ln-801"></a>      <span class="k">else</span>
<a name="ln-802"></a><span class="k">         write</span><span class="p">(</span><span class="n">unit_output</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="s1">&#39;WARNING: Error in call to read_cholesky_ia&#39;</span>
<a name="ln-803"></a>            <span class="k">stop</span>
<a name="ln-804"></a><span class="k">      </span><span class="n">endif</span>    
<a name="ln-805"></a><span class="c">!</span>
<a name="ln-806"></a>   <span class="k">end subroutine </span><span class="n">read_cholesky_ai_hf</span>
<a name="ln-807"></a><span class="c">!</span>
<a name="ln-808"></a><span class="c">!</span>
<a name="ln-809"></a>    <span class="k">subroutine </span><span class="n">read_cholesky_ab_hf</span><span class="p">(</span><span class="n">wf</span><span class="p">,</span> <span class="n">L_ab_J</span><span class="p">,</span> <span class="n">a_first</span><span class="p">,</span> <span class="n">a_last</span><span class="p">,</span> <span class="n">b_first</span><span class="p">,</span> <span class="n">b_last</span><span class="p">)</span>
<a name="ln-810"></a><span class="c">!!</span>
<a name="ln-811"></a><span class="c">!!    Read Cholesky AB </span>
<a name="ln-812"></a><span class="c">!!    Written by Sarai D. Folkestad and Eirik F. KjÃ¸nstad, Apr 2017</span>
<a name="ln-813"></a><span class="c">!!</span>
<a name="ln-814"></a><span class="c">!!    Reads the MO Cholesky AB (vir-vir) vectors from file and</span>
<a name="ln-815"></a><span class="c">!!    places them in the incoming L_ab_J matrix, with batching </span>
<a name="ln-816"></a><span class="c">!!    if necessary</span>
<a name="ln-817"></a><span class="c">!!</span>
<a name="ln-818"></a><span class="c">!!    Optional arguments: b_first, b_last, a_first, a_last can be used in order to restrict indices</span>
<a name="ln-819"></a><span class="c">!!</span>
<a name="ln-820"></a>      <span class="k">implicit none</span>
<a name="ln-821"></a><span class="c">!</span>
<a name="ln-822"></a>      <span class="k">class</span><span class="p">(</span><span class="n">hf</span><span class="p">)</span>                <span class="kd">::</span> <span class="n">wf</span>
<a name="ln-823"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">a_first</span><span class="p">,</span> <span class="n">b_first</span>   <span class="c">! First index (can differ from 1 when batching  or for mlcc)</span>
<a name="ln-824"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">a_last</span><span class="p">,</span> <span class="n">b_last</span>    <span class="c">! Last index  (can differ from n_v when batching or for mlcc)</span>
<a name="ln-825"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(((</span><span class="n">a_last</span> <span class="o">-</span> <span class="n">a_first</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">b_last</span> <span class="o">-</span> <span class="n">b_first</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_J</span><span class="p">)</span> <span class="kd">::</span> <span class="n">L_ab_J</span> <span class="c">! L_ab^J</span>
<a name="ln-826"></a><span class="c">!</span>
<a name="ln-827"></a><span class="c">!</span>
<a name="ln-828"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">unit_chol_mo_ab_direct</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c">! Unit identifier for cholesky_ab file</span>
<a name="ln-829"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ioerror</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-830"></a><span class="c">!</span>
<a name="ln-831"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ab</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ab_full</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-832"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">a_length</span><span class="p">,</span> <span class="n">b_length</span>
<a name="ln-833"></a><span class="c">!</span>
<a name="ln-834"></a>      <span class="n">a_length</span> <span class="o">=</span> <span class="n">a_last</span> <span class="o">-</span> <span class="n">a_first</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-835"></a>      <span class="n">b_length</span> <span class="o">=</span> <span class="n">b_last</span> <span class="o">-</span> <span class="n">b_first</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-836"></a>
<a name="ln-837"></a><span class="c">!</span>
<a name="ln-838"></a><span class="c">!     Prepare for reading: generate unit identifier, open, and rewind file</span>
<a name="ln-839"></a><span class="c">!  </span>
<a name="ln-840"></a>      <span class="k">call </span><span class="n">generate_unit_identifier</span><span class="p">(</span><span class="n">unit_chol_mo_ab_direct</span><span class="p">)</span>
<a name="ln-841"></a>      <span class="k">open</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">unit_chol_mo_ab_direct</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;cholesky_ab_direct&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-842"></a>            <span class="nb">access</span><span class="o">=</span><span class="s1">&#39;direct&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;unformatted&#39;</span><span class="p">,</span> <span class="n">recl</span><span class="o">=</span><span class="n">dp</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_J</span><span class="p">),</span> <span class="n">iostat</span><span class="o">=</span><span class="n">ioerror</span><span class="p">)</span>
<a name="ln-843"></a>
<a name="ln-844"></a><span class="c">!</span>
<a name="ln-845"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ioerror</span> <span class="p">.</span><span class="n">ne</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-846"></a><span class="k">         write</span><span class="p">(</span><span class="n">unit_output</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;WARNING: error while reading cholesky_ab_direct.&#39;</span><span class="p">,</span> <span class="n">ioerror</span>
<a name="ln-847"></a>         <span class="k">stop</span>
<a name="ln-848"></a><span class="k">      </span><span class="n">endif</span>
<a name="ln-849"></a><span class="c">!</span>
<a name="ln-850"></a>         <span class="k">do </span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a_length</span>
<a name="ln-851"></a>            <span class="k">do </span><span class="n">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b_length</span>
<a name="ln-852"></a>               <span class="n">ab_full</span> <span class="o">=</span> <span class="n">index_packed</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">a_first</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">b</span> <span class="o">+</span> <span class="n">b_first</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-853"></a>               <span class="n">ab</span> <span class="o">=</span> <span class="n">index_two</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a_length</span><span class="p">)</span>
<a name="ln-854"></a>               <span class="k">read</span><span class="p">(</span><span class="n">unit_chol_mo_ab_direct</span><span class="p">,</span> <span class="n">rec</span><span class="o">=</span><span class="n">ab_full</span><span class="p">)</span> <span class="p">(</span><span class="n">L_ab_J</span><span class="p">(</span><span class="n">ab</span><span class="p">,</span> <span class="n">J</span><span class="p">),</span> <span class="n">J</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_J</span><span class="p">)</span>
<a name="ln-855"></a>            <span class="n">enddo</span>
<a name="ln-856"></a>         <span class="n">enddo</span>
<a name="ln-857"></a><span class="c">!</span>
<a name="ln-858"></a><span class="c">!        Close file</span>
<a name="ln-859"></a><span class="c">!        </span>
<a name="ln-860"></a>      <span class="k">close</span><span class="p">(</span><span class="n">unit_chol_mo_ab_direct</span><span class="p">)</span>
<a name="ln-861"></a><span class="c">!</span>
<a name="ln-862"></a><span class="c">!</span>
<a name="ln-863"></a>   <span class="k">end subroutine </span><span class="n">read_cholesky_ab_hf</span>
<a name="ln-864"></a><span class="c">!</span>
<a name="ln-865"></a>   <span class="k">subroutine </span><span class="n">construct_ao_fock_hf</span><span class="p">(</span><span class="n">wf</span><span class="p">,</span> <span class="n">ao_fock</span><span class="p">)</span>
<a name="ln-866"></a><span class="c">!!</span>
<a name="ln-867"></a><span class="c">!!</span>
<a name="ln-868"></a>   <span class="k">implicit none</span>
<a name="ln-869"></a><span class="c">!</span>
<a name="ln-870"></a>      <span class="k">class</span><span class="p">(</span><span class="n">hf</span><span class="p">)</span> <span class="kd">::</span> <span class="n">wf</span>
<a name="ln-871"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ao_fock</span>
<a name="ln-872"></a><span class="c">!</span>
<a name="ln-873"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">density</span>
<a name="ln-874"></a><span class="c">!</span>
<a name="ln-875"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">h1ao</span>
<a name="ln-876"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">chol_ao</span>
<a name="ln-877"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">chol_ao_sq</span>
<a name="ln-878"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">g_J_mn_ps</span>
<a name="ln-879"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">L_J_mn_ps</span>
<a name="ln-880"></a><span class="c">!</span>
<a name="ln-881"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">J</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-882"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">mn</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ps</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pn</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-883"></a><span class="c">!</span>
<a name="ln-884"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">unit_identifier_ao_integrals</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">unit_chol_ao</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-885"></a><span class="c">!</span>
<a name="ln-886"></a>      <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">alloc</span><span class="p">(</span><span class="n">h1ao</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-887"></a>      <span class="n">h1ao</span> <span class="o">=</span> <span class="n">zero</span>
<a name="ln-888"></a><span class="c">!</span>
<a name="ln-889"></a><span class="c">!     Open mlcc_aoint file</span>
<a name="ln-890"></a><span class="c">!</span>
<a name="ln-891"></a>      <span class="k">call </span><span class="n">generate_unit_identifier</span><span class="p">(</span><span class="n">unit_identifier_ao_integrals</span><span class="p">)</span>
<a name="ln-892"></a>      <span class="k">open</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">unit_identifier_ao_integrals</span><span class="p">,</span><span class="k">file</span><span class="o">=</span><span class="s1">&#39;MLCC_AOINT&#39;</span><span class="p">,</span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">,</span><span class="n">form</span><span class="o">=</span><span class="s1">&#39;formatted&#39;</span><span class="p">)</span>
<a name="ln-893"></a>      <span class="k">rewind</span><span class="p">(</span><span class="n">unit_identifier_ao_integrals</span><span class="p">)</span>
<a name="ln-894"></a><span class="c">!</span>
<a name="ln-895"></a><span class="c">!     Read in one-electron AO integrals</span>
<a name="ln-896"></a><span class="c">!</span>
<a name="ln-897"></a>      <span class="k">read</span><span class="p">(</span><span class="n">unit_identifier_ao_integrals</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">h1ao</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-898"></a><span class="c">!</span>
<a name="ln-899"></a><span class="c">!     Close mlcc_aoint</span>
<a name="ln-900"></a><span class="c">!</span>
<a name="ln-901"></a>      <span class="k">close</span><span class="p">(</span><span class="n">unit_identifier_ao_integrals</span><span class="p">)</span>
<a name="ln-902"></a><span class="c">!</span>
<a name="ln-903"></a><span class="c">!     Allocate the AO Fock matrix and add the one-electron contributions</span>
<a name="ln-904"></a><span class="c">!</span>
<a name="ln-905"></a>      <span class="n">ao_fock</span> <span class="o">=</span> <span class="n">zero</span>
<a name="ln-906"></a><span class="c">!</span>
<a name="ln-907"></a>      <span class="k">call </span><span class="n">squareup</span><span class="p">(</span><span class="n">h1ao</span><span class="p">,</span> <span class="n">ao_fock</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">)</span>  
<a name="ln-908"></a><span class="c">!</span>
<a name="ln-909"></a><span class="c">!     Deallocation of one-electron AO integrals</span>
<a name="ln-910"></a><span class="c">!   </span>
<a name="ln-911"></a>      <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">dealloc</span><span class="p">(</span><span class="n">h1ao</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-912"></a><span class="c">!</span>
<a name="ln-913"></a><span class="c">!     Read Cholesky in ao basis</span>
<a name="ln-914"></a><span class="c">!</span>
<a name="ln-915"></a>      <span class="k">call </span><span class="n">generate_unit_identifier</span><span class="p">(</span><span class="n">unit_chol_ao</span><span class="p">)</span>
<a name="ln-916"></a>      <span class="k">open</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">unit_chol_ao</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;MLCC_CHOLESKY&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;formatted&#39;</span><span class="p">)</span>
<a name="ln-917"></a>      <span class="k">rewind</span><span class="p">(</span><span class="n">unit_chol_ao</span><span class="p">)</span>
<a name="ln-918"></a><span class="c">!</span>
<a name="ln-919"></a><span class="c">!     Read the number of Cholesky vectors (n_J) and </span>
<a name="ln-920"></a><span class="c">!     the number of atomic orbitals (n_ao)</span>
<a name="ln-921"></a><span class="c">!</span>
<a name="ln-922"></a>      <span class="k">read</span><span class="p">(</span><span class="n">unit_chol_ao</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_J</span>
<a name="ln-923"></a><span class="c">!</span>
<a name="ln-924"></a>      <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">alloc</span><span class="p">(</span><span class="n">chol_ao</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_J</span><span class="p">)</span>    
<a name="ln-925"></a><span class="c">!</span>
<a name="ln-926"></a>         <span class="n">chol_ao</span>    <span class="o">=</span> <span class="n">zero</span>
<a name="ln-927"></a><span class="c">!</span>
<a name="ln-928"></a><span class="c">!        Read Cholesky AO vector</span>
<a name="ln-929"></a><span class="c">!</span>
<a name="ln-930"></a>         <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_J</span>
<a name="ln-931"></a>            <span class="k">read</span><span class="p">(</span><span class="n">unit_chol_ao</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">chol_ao</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">),</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-932"></a>         <span class="n">enddo</span>
<a name="ln-933"></a>         
<a name="ln-934"></a><span class="c">!</span>
<a name="ln-935"></a><span class="c">!</span>
<a name="ln-936"></a>      <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">alloc</span><span class="p">(</span><span class="n">g_J_mn_ps</span><span class="p">,</span> <span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-937"></a><span class="c">!</span>
<a name="ln-938"></a><span class="c">!</span>
<a name="ln-939"></a>            <span class="k">call </span><span class="n">dgemm</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-940"></a>                     <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-941"></a>                     <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-942"></a>                     <span class="n">wf</span><span class="p">%</span><span class="n">n_J</span><span class="p">,</span>                <span class="p">&amp;</span>
<a name="ln-943"></a>                     <span class="n">one</span><span class="p">,</span>                   <span class="p">&amp;</span>
<a name="ln-944"></a>                     <span class="n">chol_ao</span><span class="p">,</span>               <span class="p">&amp;</span>
<a name="ln-945"></a>                     <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-946"></a>                     <span class="n">chol_ao</span><span class="p">,</span>               <span class="p">&amp;</span>
<a name="ln-947"></a>                     <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-948"></a>                     <span class="n">zero</span><span class="p">,</span>                  <span class="p">&amp;</span>
<a name="ln-949"></a>                     <span class="n">g_J_mn_ps</span><span class="p">,</span>             <span class="p">&amp;</span>
<a name="ln-950"></a>                     <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-951"></a><span class="c">!</span>
<a name="ln-952"></a>            <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">dealloc</span><span class="p">(</span><span class="n">chol_ao</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_J</span><span class="p">)</span>
<a name="ln-953"></a>            <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">alloc</span><span class="p">(</span><span class="n">density</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">)</span>
<a name="ln-954"></a>            <span class="n">density</span> <span class="o">=</span> <span class="n">zero</span>     
<a name="ln-955"></a><span class="c">!</span>
<a name="ln-956"></a>            <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">construct_density_matrix</span><span class="p">(</span><span class="n">density</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">mo_coef</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_o</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_v</span><span class="p">)</span> 
<a name="ln-957"></a><span class="c">!</span>
<a name="ln-958"></a>            <span class="k">do </span><span class="n">m</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span>
<a name="ln-959"></a>               <span class="k">do </span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span>
<a name="ln-960"></a><span class="c">!</span>
<a name="ln-961"></a>                  <span class="n">mn</span> <span class="o">=</span> <span class="n">index_packed</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a name="ln-962"></a><span class="c">!</span>
<a name="ln-963"></a>                  <span class="k">do </span><span class="n">p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span> 
<a name="ln-964"></a><span class="c">!</span>
<a name="ln-965"></a>                     <span class="n">pn</span> <span class="o">=</span> <span class="n">index_packed</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a name="ln-966"></a><span class="c">!</span>
<a name="ln-967"></a>                     <span class="k">do </span><span class="n">s</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span> 
<a name="ln-968"></a><span class="c">!                    </span>
<a name="ln-969"></a>                        <span class="n">ms</span> <span class="o">=</span> <span class="n">index_packed</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
<a name="ln-970"></a><span class="c">!</span>
<a name="ln-971"></a>                        <span class="n">ps</span> <span class="o">=</span> <span class="n">index_packed</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>                                         
<a name="ln-972"></a><span class="c">!</span>
<a name="ln-973"></a>                        <span class="n">ao_fock</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="o">=</span> <span class="n">ao_fock</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">two</span><span class="o">*</span><span class="n">g_J_mn_ps</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span><span class="n">ps</span><span class="p">)</span> <span class="o">-</span> <span class="n">g_J_mn_ps</span><span class="p">(</span><span class="n">ms</span><span class="p">,</span> <span class="n">pn</span><span class="p">))</span><span class="o">*</span><span class="n">density</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>    
<a name="ln-974"></a><span class="c">!     </span>
<a name="ln-975"></a>                     <span class="n">enddo</span>
<a name="ln-976"></a>                  <span class="n">enddo</span>
<a name="ln-977"></a>               <span class="n">enddo</span>
<a name="ln-978"></a>            <span class="n">enddo</span>
<a name="ln-979"></a><span class="c">!</span>
<a name="ln-980"></a>         <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">dealloc</span><span class="p">(</span><span class="n">g_J_mn_ps</span><span class="p">,</span> <span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-981"></a>         <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">dealloc</span><span class="p">(</span><span class="n">density</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">)</span>
<a name="ln-982"></a><span class="c">!</span>
<a name="ln-983"></a>      <span class="k">close</span><span class="p">(</span><span class="n">unit_chol_ao</span><span class="p">)</span>
<a name="ln-984"></a>      <span class="k">close</span><span class="p">(</span><span class="n">unit_identifier_ao_integrals</span><span class="p">)</span>
<a name="ln-985"></a><span class="c">!</span>
<a name="ln-986"></a>   <span class="k">end subroutine </span><span class="n">construct_ao_fock_hf</span>
<a name="ln-987"></a>   <span class="k">subroutine </span><span class="n">construct_ao_fock_new_hf</span><span class="p">(</span><span class="n">wf</span><span class="p">,</span> <span class="n">ao_fock</span><span class="p">)</span>
<a name="ln-988"></a><span class="c">!!</span>
<a name="ln-989"></a><span class="c">!!</span>
<a name="ln-990"></a>      <span class="k">implicit none</span>
<a name="ln-991"></a><span class="c">!</span>
<a name="ln-992"></a>      <span class="k">class</span><span class="p">(</span><span class="n">hf</span><span class="p">)</span> <span class="kd">::</span> <span class="n">wf</span>
<a name="ln-993"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ao_fock</span>
<a name="ln-994"></a><span class="c">!</span>
<a name="ln-995"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,</span> <span class="p">:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">density</span>
<a name="ln-996"></a><span class="c">!</span>
<a name="ln-997"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">h1ao</span>
<a name="ln-998"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">chol_ao</span>
<a name="ln-999"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">chol_ao_sq</span>
<a name="ln-1000"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">Y</span>
<a name="ln-1001"></a><span class="c">!</span>
<a name="ln-1002"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">X</span>
<a name="ln-1003"></a><span class="c">!</span>
<a name="ln-1004"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">J</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1005"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">mn</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ps</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pn</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1006"></a><span class="c">!</span>
<a name="ln-1007"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">unit_identifier_ao_integrals</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">unit_chol_ao</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1008"></a><span class="c">!</span>
<a name="ln-1009"></a><span class="c">!     Batching variables</span>
<a name="ln-1010"></a><span class="c">!</span>
<a name="ln-1011"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">m_batch</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">m_first</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">m_last</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">m_length</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1012"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">required</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">available</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n_batch</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">batch_dimension</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1013"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">max_batch_length</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1014"></a><span class="c">!</span>
<a name="ln-1015"></a><span class="c">!</span>
<a name="ln-1016"></a>      <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">alloc</span><span class="p">(</span><span class="n">h1ao</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-1017"></a>      <span class="n">h1ao</span> <span class="o">=</span> <span class="n">zero</span>
<a name="ln-1018"></a><span class="c">!</span>
<a name="ln-1019"></a><span class="c">!     Open mlcc_aoint file</span>
<a name="ln-1020"></a><span class="c">!</span>
<a name="ln-1021"></a>      <span class="k">call </span><span class="n">generate_unit_identifier</span><span class="p">(</span><span class="n">unit_identifier_ao_integrals</span><span class="p">)</span>
<a name="ln-1022"></a>      <span class="k">open</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">unit_identifier_ao_integrals</span><span class="p">,</span><span class="k">file</span><span class="o">=</span><span class="s1">&#39;MLCC_AOINT&#39;</span><span class="p">,</span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">,</span><span class="n">form</span><span class="o">=</span><span class="s1">&#39;formatted&#39;</span><span class="p">)</span>
<a name="ln-1023"></a>      <span class="k">rewind</span><span class="p">(</span><span class="n">unit_identifier_ao_integrals</span><span class="p">)</span>
<a name="ln-1024"></a><span class="c">!</span>
<a name="ln-1025"></a><span class="c">!     Read in one-electron AO integrals</span>
<a name="ln-1026"></a><span class="c">!</span>
<a name="ln-1027"></a>      <span class="k">read</span><span class="p">(</span><span class="n">unit_identifier_ao_integrals</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">h1ao</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-1028"></a><span class="c">!</span>
<a name="ln-1029"></a><span class="c">!     Close mlcc_aoint</span>
<a name="ln-1030"></a><span class="c">!</span>
<a name="ln-1031"></a>      <span class="k">close</span><span class="p">(</span><span class="n">unit_identifier_ao_integrals</span><span class="p">)</span>
<a name="ln-1032"></a><span class="c">!</span>
<a name="ln-1033"></a><span class="c">!     Allocate the AO Fock matrix and add the one-electron contributions</span>
<a name="ln-1034"></a><span class="c">!</span>
<a name="ln-1035"></a>      <span class="n">ao_fock</span> <span class="o">=</span> <span class="n">zero</span>
<a name="ln-1036"></a><span class="c">!</span>
<a name="ln-1037"></a>      <span class="k">call </span><span class="n">squareup</span><span class="p">(</span><span class="n">h1ao</span><span class="p">,</span> <span class="n">ao_fock</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">)</span> 
<a name="ln-1038"></a><span class="c">!</span>
<a name="ln-1039"></a><span class="c">!     Deallocation of one-electron AO integrals</span>
<a name="ln-1040"></a><span class="c">!   </span>
<a name="ln-1041"></a>      <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">dealloc</span><span class="p">(</span><span class="n">h1ao</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-1042"></a><span class="c">!</span>
<a name="ln-1043"></a><span class="c">!     Read Cholesky in ao basis</span>
<a name="ln-1044"></a><span class="c">!</span>
<a name="ln-1045"></a>      <span class="k">call </span><span class="n">generate_unit_identifier</span><span class="p">(</span><span class="n">unit_chol_ao</span><span class="p">)</span>
<a name="ln-1046"></a>      <span class="k">open</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">unit_chol_ao</span><span class="p">,</span> <span class="k">file</span><span class="o">=</span><span class="s1">&#39;MLCC_CHOLESKY&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s1">&#39;formatted&#39;</span><span class="p">)</span>
<a name="ln-1047"></a>      <span class="k">rewind</span><span class="p">(</span><span class="n">unit_chol_ao</span><span class="p">)</span>
<a name="ln-1048"></a><span class="c">!</span>
<a name="ln-1049"></a><span class="c">!     Read the number of Cholesky vectors (n_J) and </span>
<a name="ln-1050"></a><span class="c">!     the number of atomic orbitals (n_ao)</span>
<a name="ln-1051"></a><span class="c">!</span>
<a name="ln-1052"></a>      <span class="k">read</span><span class="p">(</span><span class="n">unit_chol_ao</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_J</span>
<a name="ln-1053"></a><span class="c">!</span>
<a name="ln-1054"></a>      <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_J</span>
<a name="ln-1055"></a><span class="c">!</span>
<a name="ln-1056"></a>         <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">alloc</span><span class="p">(</span><span class="n">chol_ao</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>    
<a name="ln-1057"></a><span class="c">!</span>
<a name="ln-1058"></a>         <span class="n">chol_ao</span>    <span class="o">=</span> <span class="n">zero</span>
<a name="ln-1059"></a><span class="c">!</span>
<a name="ln-1060"></a><span class="c">!        Read Cholesky AO vector</span>
<a name="ln-1061"></a><span class="c">!</span>
<a name="ln-1062"></a>         <span class="k">read</span><span class="p">(</span><span class="n">unit_chol_ao</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">chol_ao</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-1063"></a><span class="c">!</span>
<a name="ln-1064"></a>         <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">alloc</span><span class="p">(</span><span class="n">chol_ao_sq</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">)</span>
<a name="ln-1065"></a>         <span class="n">chol_ao_sq</span> <span class="o">=</span> <span class="n">zero</span>
<a name="ln-1066"></a><span class="c">!</span>
<a name="ln-1067"></a>         <span class="k">call </span><span class="n">squareup</span><span class="p">(</span><span class="n">chol_ao</span><span class="p">,</span> <span class="n">chol_ao_sq</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">)</span>
<a name="ln-1068"></a><span class="c">!</span>
<a name="ln-1069"></a>         <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">dealloc</span><span class="p">(</span><span class="n">chol_ao</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">*</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> 
<a name="ln-1070"></a>
<a name="ln-1071"></a>         <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">alloc</span><span class="p">(</span><span class="n">density</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">)</span>
<a name="ln-1072"></a>         <span class="n">density</span> <span class="o">=</span> <span class="n">zero</span>   
<a name="ln-1073"></a><span class="c">!</span>
<a name="ln-1074"></a><span class="c">!        Coulomb term: sum_Jps 2 * L^J_ps * D_p,s * L^J_mn</span>
<a name="ln-1075"></a><span class="c">!</span>
<a name="ln-1076"></a>         <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">construct_density_matrix</span><span class="p">(</span><span class="n">density</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">mo_coef</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_o</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_v</span><span class="p">)</span>
<a name="ln-1077"></a><span class="c">!</span>
<a name="ln-1078"></a>         <span class="k">call </span><span class="n">dgemm</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span>    <span class="p">&amp;</span>
<a name="ln-1079"></a>                     <span class="mi">1</span><span class="p">,</span>          <span class="p">&amp;</span>
<a name="ln-1080"></a>                     <span class="mi">1</span><span class="p">,</span>          <span class="p">&amp;</span>
<a name="ln-1081"></a>                     <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1082"></a>                     <span class="n">two</span><span class="p">,</span>        <span class="p">&amp;</span>
<a name="ln-1083"></a>                     <span class="n">chol_ao_sq</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1084"></a>                     <span class="mi">1</span><span class="p">,</span>          <span class="p">&amp;</span>
<a name="ln-1085"></a>                     <span class="n">density</span><span class="p">,</span>    <span class="p">&amp;</span>
<a name="ln-1086"></a>                     <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1087"></a>                     <span class="n">zero</span><span class="p">,</span>       <span class="p">&amp;</span>
<a name="ln-1088"></a>                     <span class="n">X</span><span class="p">,</span>          <span class="p">&amp;</span>
<a name="ln-1089"></a>                     <span class="mi">1</span><span class="p">)</span>
<a name="ln-1090"></a><span class="c">!</span>
<a name="ln-1091"></a>         <span class="k">call </span><span class="n">daxpy</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">chol_ao_sq</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ao_fock</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-1092"></a>         
<a name="ln-1093"></a><span class="c">!</span>
<a name="ln-1094"></a><span class="c">!        Exchange term: - sum_Jps  L^J_ms * D_p,s * L^J_pn</span>
<a name="ln-1095"></a><span class="c">!</span>
<a name="ln-1096"></a>         <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">alloc</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">)</span>
<a name="ln-1097"></a><span class="c">!</span>
<a name="ln-1098"></a>         <span class="k">call </span><span class="n">dgemm</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1099"></a>                     <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1100"></a>                     <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1101"></a>                     <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1102"></a>                     <span class="n">one</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1103"></a>                     <span class="n">chol_ao_sq</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1104"></a>                     <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1105"></a>                     <span class="n">density</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1106"></a>                     <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1107"></a>                     <span class="n">zero</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1108"></a>                     <span class="n">Y</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1109"></a>                     <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">)</span>
<a name="ln-1110"></a><span class="c">!</span>
<a name="ln-1111"></a>         <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">dealloc</span><span class="p">(</span><span class="n">density</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">)</span>
<a name="ln-1112"></a><span class="c">!</span>
<a name="ln-1113"></a>         <span class="k">call </span><span class="n">dgemm</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1114"></a>                     <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1115"></a>                     <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1116"></a>                     <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1117"></a>                     <span class="o">-</span><span class="n">one</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1118"></a>                     <span class="n">Y</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1119"></a>                     <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1120"></a>                     <span class="n">chol_ao_sq</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1121"></a>                     <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1122"></a>                     <span class="n">one</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1123"></a>                     <span class="n">ao_fock</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1124"></a>                     <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">)</span>
<a name="ln-1125"></a><span class="c">!</span>
<a name="ln-1126"></a>         <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">dealloc</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">)</span>
<a name="ln-1127"></a>         <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">dealloc</span><span class="p">(</span><span class="n">chol_ao_sq</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">)</span> 
<a name="ln-1128"></a><span class="c">!</span>
<a name="ln-1129"></a>      <span class="n">enddo</span> <span class="c">! looping over J</span>
<a name="ln-1130"></a><span class="c">!</span>
<a name="ln-1131"></a>      <span class="k">close</span><span class="p">(</span><span class="n">unit_chol_ao</span><span class="p">)</span>
<a name="ln-1132"></a>      <span class="k">close</span><span class="p">(</span><span class="n">unit_identifier_ao_integrals</span><span class="p">)</span>
<a name="ln-1133"></a><span class="c">!</span>
<a name="ln-1134"></a>   <span class="k">end subroutine </span><span class="n">construct_ao_fock_new_hf</span>
<a name="ln-1135"></a><span class="c">!</span>
<a name="ln-1136"></a>   <span class="k">subroutine </span><span class="n">construct_density_matrices_hf</span><span class="p">(</span><span class="n">wf</span><span class="p">,</span> <span class="n">density_o</span><span class="p">,</span> <span class="n">density_v</span><span class="p">,</span> <span class="n">C_matrix</span><span class="p">,</span> <span class="n">n_o</span><span class="p">,</span> <span class="n">n_v</span><span class="p">)</span>
<a name="ln-1137"></a><span class="c">!!</span>
<a name="ln-1138"></a><span class="c">!!</span>
<a name="ln-1139"></a><span class="c">!!</span>
<a name="ln-1140"></a>      <span class="k">implicit none</span>
<a name="ln-1141"></a><span class="c">!</span>
<a name="ln-1142"></a>      <span class="k">class</span><span class="p">(</span><span class="n">hf</span><span class="p">)</span> <span class="kd">::</span> <span class="n">wf</span>
<a name="ln-1143"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">density_o</span>
<a name="ln-1144"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">density_v</span>
<a name="ln-1145"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span> <span class="n">n_o</span> <span class="o">+</span> <span class="n">n_v</span><span class="p">)</span> <span class="kd">::</span> <span class="n">C_matrix</span>
<a name="ln-1146"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span>                            <span class="kd">::</span> <span class="n">n_o</span><span class="p">,</span> <span class="n">n_v</span>
<a name="ln-1147"></a><span class="c">!</span>
<a name="ln-1148"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">C</span>
<a name="ln-1149"></a><span class="c">!</span>
<a name="ln-1150"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ij</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1151"></a><span class="c">!      </span>
<a name="ln-1152"></a>      <span class="k">call </span><span class="n">dgemm</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span>    <span class="p">&amp;</span>
<a name="ln-1153"></a>                  <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span>    <span class="p">&amp;</span>
<a name="ln-1154"></a>                  <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span>    <span class="p">&amp;</span>
<a name="ln-1155"></a>                  <span class="n">n_o</span><span class="p">,</span>        <span class="p">&amp;</span>
<a name="ln-1156"></a>                  <span class="n">one</span><span class="p">,</span>        <span class="p">&amp;</span>
<a name="ln-1157"></a>                  <span class="n">C_matrix</span><span class="p">,</span>   <span class="p">&amp;</span>
<a name="ln-1158"></a>                  <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span>    <span class="p">&amp;</span>
<a name="ln-1159"></a>                  <span class="n">C_matrix</span><span class="p">,</span>   <span class="p">&amp;</span>
<a name="ln-1160"></a>                  <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span>    <span class="p">&amp;</span>
<a name="ln-1161"></a>                  <span class="n">zero</span><span class="p">,</span>       <span class="p">&amp;</span>
<a name="ln-1162"></a>                  <span class="n">density_o</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-1163"></a>                  <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">)</span>
<a name="ln-1164"></a><span class="c">!</span>
<a name="ln-1165"></a>      <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">alloc</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span> <span class="n">n_v</span><span class="p">)</span>
<a name="ln-1166"></a><span class="c">!</span>
<a name="ln-1167"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span>
<a name="ln-1168"></a>         <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_v</span>
<a name="ln-1169"></a>            <span class="n">ij</span> <span class="o">=</span> <span class="n">index_two</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="n">n_o</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">)</span>
<a name="ln-1170"></a>            <span class="n">C</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">C_matrix</span><span class="p">(</span><span class="n">ij</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1171"></a>         <span class="n">enddo</span>
<a name="ln-1172"></a>      <span class="n">enddo</span>
<a name="ln-1173"></a><span class="c">!</span>
<a name="ln-1174"></a>      <span class="k">call </span><span class="n">dgemm</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span>                   <span class="p">&amp;</span>
<a name="ln-1175"></a>                  <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span>                   <span class="p">&amp;</span>
<a name="ln-1176"></a>                  <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span>                   <span class="p">&amp;</span>
<a name="ln-1177"></a>                  <span class="n">n_v</span><span class="p">,</span>                       <span class="p">&amp;</span>
<a name="ln-1178"></a>                  <span class="n">one</span><span class="p">,</span>                       <span class="p">&amp;</span>
<a name="ln-1179"></a>                  <span class="n">C</span><span class="p">,</span>                         <span class="p">&amp;</span>
<a name="ln-1180"></a>                  <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span>                   <span class="p">&amp;</span>
<a name="ln-1181"></a>                  <span class="n">C</span><span class="p">,</span>                         <span class="p">&amp;</span>
<a name="ln-1182"></a>                  <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span>                   <span class="p">&amp;</span>
<a name="ln-1183"></a>                  <span class="n">zero</span><span class="p">,</span>                      <span class="p">&amp;</span>
<a name="ln-1184"></a>                  <span class="n">density_v</span><span class="p">,</span>                 <span class="p">&amp;</span>
<a name="ln-1185"></a>                  <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">)</span>
<a name="ln-1186"></a><span class="c">!</span>
<a name="ln-1187"></a>      <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">dealloc</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span> <span class="n">n_v</span><span class="p">)</span>
<a name="ln-1188"></a><span class="c">!</span>
<a name="ln-1189"></a>   <span class="k">end subroutine </span><span class="n">construct_density_matrices_hf</span>
<a name="ln-1190"></a><span class="c">!</span>
<a name="ln-1191"></a>   <span class="k">subroutine </span><span class="n">construct_density_matrix_hf</span><span class="p">(</span><span class="n">wf</span><span class="p">,</span> <span class="n">density_o</span><span class="p">,</span> <span class="n">C_matrix</span><span class="p">,</span> <span class="n">n_o</span><span class="p">,</span> <span class="n">n_v</span><span class="p">)</span>
<a name="ln-1192"></a><span class="c">!!</span>
<a name="ln-1193"></a><span class="c">!!</span>
<a name="ln-1194"></a>      <span class="k">implicit none</span>
<a name="ln-1195"></a><span class="c">!</span>
<a name="ln-1196"></a>      <span class="k">class</span><span class="p">(</span><span class="n">hf</span><span class="p">)</span> <span class="kd">::</span> <span class="n">wf</span>
<a name="ln-1197"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">density_o</span>
<a name="ln-1198"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span> <span class="n">n_o</span> <span class="o">+</span> <span class="n">n_v</span><span class="p">)</span> <span class="kd">::</span> <span class="n">C_matrix</span>
<a name="ln-1199"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span>                            <span class="kd">::</span> <span class="n">n_o</span><span class="p">,</span> <span class="n">n_v</span>
<a name="ln-1200"></a><span class="c">!      </span>
<a name="ln-1201"></a>      <span class="k">call </span><span class="n">dgemm</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span>    <span class="p">&amp;</span>
<a name="ln-1202"></a>                  <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span>    <span class="p">&amp;</span>
<a name="ln-1203"></a>                  <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span>    <span class="p">&amp;</span>
<a name="ln-1204"></a>                  <span class="n">n_o</span><span class="p">,</span>        <span class="p">&amp;</span>
<a name="ln-1205"></a>                  <span class="n">one</span><span class="p">,</span>        <span class="p">&amp;</span>
<a name="ln-1206"></a>                  <span class="n">C_matrix</span><span class="p">,</span>   <span class="p">&amp;</span>
<a name="ln-1207"></a>                  <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span>    <span class="p">&amp;</span>
<a name="ln-1208"></a>                  <span class="n">C_matrix</span><span class="p">,</span>   <span class="p">&amp;</span>
<a name="ln-1209"></a>                  <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span>    <span class="p">&amp;</span>
<a name="ln-1210"></a>                  <span class="n">zero</span><span class="p">,</span>       <span class="p">&amp;</span>
<a name="ln-1211"></a>                  <span class="n">density_o</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-1212"></a>                  <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">)</span>
<a name="ln-1213"></a><span class="c">!</span>
<a name="ln-1214"></a>   <span class="k">end subroutine </span><span class="n">construct_density_matrix_hf</span>
<a name="ln-1215"></a><span class="c">!</span>
<a name="ln-1216"></a>   <span class="k">subroutine </span><span class="n">construct_density_matrix_v_hf</span><span class="p">(</span><span class="n">wf</span><span class="p">,</span> <span class="n">density_v</span><span class="p">,</span> <span class="n">C_matrix</span><span class="p">,</span>  <span class="n">n_o</span><span class="p">,</span> <span class="n">n_v</span><span class="p">)</span>
<a name="ln-1217"></a><span class="c">!!</span>
<a name="ln-1218"></a><span class="c">!!</span>
<a name="ln-1219"></a><span class="c">!!</span>
<a name="ln-1220"></a>      <span class="k">implicit none</span>
<a name="ln-1221"></a><span class="c">!</span>
<a name="ln-1222"></a>      <span class="k">class</span><span class="p">(</span><span class="n">hf</span><span class="p">)</span> <span class="kd">::</span> <span class="n">wf</span>
<a name="ln-1223"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">density_v</span>
<a name="ln-1224"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span> <span class="n">n_o</span> <span class="o">+</span> <span class="n">n_v</span><span class="p">)</span> <span class="kd">::</span> <span class="n">C_matrix</span>
<a name="ln-1225"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span>                            <span class="kd">::</span> <span class="n">n_v</span><span class="p">,</span> <span class="n">n_o</span>
<a name="ln-1226"></a>      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:,:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">C</span>
<a name="ln-1227"></a><span class="c">!</span>
<a name="ln-1228"></a>      <span class="kt">integer</span><span class="p">(</span><span class="n">i15</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ij</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1229"></a><span class="c">!</span>
<a name="ln-1230"></a>      <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">alloc</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span> <span class="n">n_v</span><span class="p">)</span>
<a name="ln-1231"></a><span class="c">!</span>
<a name="ln-1232"></a>      <span class="n">C</span><span class="p">(:,</span><span class="mi">1</span><span class="p">:</span><span class="n">n_v</span><span class="p">)</span> <span class="o">=</span> <span class="n">C_matrix</span><span class="p">(:,</span><span class="mi">1</span> <span class="o">+</span> <span class="n">n_o</span> <span class="p">:</span> <span class="n">n_o</span> <span class="o">+</span> <span class="n">n_v</span><span class="p">)</span>
<a name="ln-1233"></a><span class="c">!</span>
<a name="ln-1234"></a>      <span class="k">call </span><span class="n">dgemm</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span>                   <span class="p">&amp;</span>
<a name="ln-1235"></a>                  <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span>                   <span class="p">&amp;</span>
<a name="ln-1236"></a>                  <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span>                   <span class="p">&amp;</span>
<a name="ln-1237"></a>                  <span class="n">n_v</span><span class="p">,</span>                       <span class="p">&amp;</span>
<a name="ln-1238"></a>                  <span class="n">one</span><span class="p">,</span>                       <span class="p">&amp;</span>
<a name="ln-1239"></a>                  <span class="n">C</span><span class="p">,</span>                         <span class="p">&amp;</span>
<a name="ln-1240"></a>                  <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span>                   <span class="p">&amp;</span>
<a name="ln-1241"></a>                  <span class="n">C</span><span class="p">,</span>                         <span class="p">&amp;</span>
<a name="ln-1242"></a>                  <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span>                   <span class="p">&amp;</span>
<a name="ln-1243"></a>                  <span class="n">zero</span><span class="p">,</span>                      <span class="p">&amp;</span>
<a name="ln-1244"></a>                  <span class="n">density_v</span><span class="p">,</span>                 <span class="p">&amp;</span>
<a name="ln-1245"></a>                  <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">)</span>
<a name="ln-1246"></a><span class="c">!</span>
<a name="ln-1247"></a>      <span class="k">call </span><span class="n">wf</span><span class="p">%</span><span class="n">mem</span><span class="p">%</span><span class="n">dealloc</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">wf</span><span class="p">%</span><span class="n">n_ao</span><span class="p">,</span> <span class="n">n_v</span><span class="p">)</span>
<a name="ln-1248"></a><span class="c">!</span>
<a name="ln-1249"></a>   <span class="k">end subroutine </span><span class="n">construct_density_matrix_v_hf</span>
<a name="ln-1250"></a><span class="c">!</span>
<a name="ln-1251"></a><span class="k">end module </span><span class="n">hf_class</span>
</pre></div>

    </section>
    </div>
  </div>

  <section class="visible-xs visible-sm hidden-md">
    <hr>
    

<div class="panel panel-default">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#allfiles-1">All Source Files</a></h3></div>
  <div id="allfiles-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../sourcefile/batching_index_class.f90.html">batching_index_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/calc_procedures_class.f90.html">calc_procedures_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/calc_settings_class.f90.html">calc_settings_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/calc_tasks_class.f90.html">calc_tasks_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/cc2_class.f90.html">cc2_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/cc3_class.f90.html">cc3_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/ccs_class.f90.html">ccs_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/ccsd_class.f90.html">ccsd_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/ccsdpt_class.f90.html">ccsdpt_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/cholesky_submodule.f90.html">cholesky_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/cholesky_submodule.f90%7E2.html">cholesky_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/core_excited_state_specs_class.f90.html">core_excited_state_specs_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/cvs_submodule.f90.html">cvs_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/cvs_submodule.f90%7E2.html">cvs_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/et_program.f90.html">eT_program.F90</a>
      
      <a class="list-group-item" href="../sourcefile/excited_state_specs_class.f90.html">excited_state_specs_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/excited_state_submodule.f90.html">excited_state_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/excited_state_submodule.f90%7E2.html">excited_state_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/excited_state_submodule.f90%7E3.html">excited_state_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/excited_state_submodule.f90%7E4.html">excited_state_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/excited_state_submodule.f90%7E5.html">excited_state_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/fock_submodule.f90.html">fock_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/ground_state_specs_class.f90.html">ground_state_specs_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/ground_state_submodule.f90.html">ground_state_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/ground_state_submodule.f90%7E2.html">ground_state_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/ground_state_submodule.f90%7E3.html">ground_state_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/ground_state_submodule.f90%7E4.html">ground_state_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/hf_class.f90.html">hf_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/input_output.f90.html">input_output.F90</a>
      
      <a class="list-group-item" href="../sourcefile/input_reader.f90.html">input_reader.F90</a>
      
      <a class="list-group-item" href="../sourcefile/input_reader_submodule.f90.html">input_reader_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/input_reader_submodule.f90%7E2.html">input_reader_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/input_reader_submodule.f90%7E3.html">input_reader_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/integrals_submodule.f90.html">integrals_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/ionized_state_submodule.f90.html">ionized_state_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/ionized_state_submodule.f90%7E2.html">ionized_state_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/jacobian_submodule.f90.html">jacobian_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/jacobian_submodule.f90%7E2.html">jacobian_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/jacobian_submodule.f90%7E3.html">jacobian_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/jacobian_submodule.f90%7E4.html">jacobian_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/jacobian_submodule.f90%7E5.html">jacobian_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/jacobian_transpose_submodule.f90.html">jacobian_transpose_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/jacobian_transpose_submodule.f90%7E2.html">jacobian_transpose_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/memory_manager_class.f90.html">memory_manager_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/mlcc2_class.f90.html">mlcc2_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/mlcc_calculation_settings_class.f90.html">mlcc_calculation_settings_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/mlcc_orbitals_class.f90.html">mlcc_orbitals_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/mlccsd_class.f90.html">mlccsd_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/mp2_class.f90.html">mp2_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/omega_submodule.f90.html">omega_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/omega_submodule.f90%7E2.html">omega_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/omega_submodule.f90%7E3.html">omega_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/omega_submodule.f90%7E4.html">omega_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/omega_submodule.f90%7E5.html">omega_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/omega_submodule.f90%7E6.html">omega_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/orbital_partitioning_submodule.f90.html">orbital_partitioning_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/orbital_partitioning_submodule.f90%7E2.html">orbital_partitioning_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/response_calc_specs_class.f90.html">response_calc_specs_class.F90</a>
      
      <a class="list-group-item" href="../sourcefile/response_submodule.f90.html">response_submodule.F90</a>
      
      <a class="list-group-item" href="../sourcefile/types.f90.html">types.F90</a>
      
      <a class="list-group-item" href="../sourcefile/utils.f90.html">utils.F90</a>
      
      <a class="list-group-item" href="../sourcefile/workspace.f90.html">workspace.F90</a>
      
    </div>
  </div>
</div>


  </section>
  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2017 </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
            
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> The eT program was developed by Eirik F. KjÃ¸nstad and Sarai D. Folkestad</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js'],
        'HTML-CSS': { 
           styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: '#000000 ! important'} }
        }
      });
    </script>
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  </body>
</html>